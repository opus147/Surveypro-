<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<meta name="description" content="SurveyPro Elite â€” Nigeria's #1 Professional Land Surveying Platform. GPS, Coordinate Conversion, GIS Tools, Equipment Rental, Training & C of O Verification. SURCON-Aligned. WGS84 Â· UTM 31â€“33N Â· NNO.">
<meta name="keywords" content="land survey Nigeria, GPS surveying, coordinate conversion, GIS tools, survey equipment rental, C of O verification, SURCON, boundary survey, cadastral survey, topographic survey, Arnold Opusunju, SurveyPro Elite">
<meta name="author" content="Arnold Opusunju â€” SurveyPro Elite">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#0f172a">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SurveyPro Elite">
<!-- Open Graph -->
<meta property="og:title" content="SurveyPro Elite | Nigeria's #1 Professional Surveying Platform">
<meta property="og:description" content="Professional GPS survey, coordinate conversion, GIS tools, equipment rental, training & C of O verification. Commercial-grade. SURCON-aligned.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://opus147.github.io/Surveypro-">
<meta property="og:image" content="https://opus147.github.io/Surveypro-">
<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="SurveyPro Elite | Nigeria's #1 Surveying Platform">
<meta name="twitter:description" content="GPS, Coordinates, GIS, Equipment Rental & Training for Nigerian surveyors.">
<title>SurveyPro Elite | Nigeria's #1 Professional Surveying Platform</title>
<link rel="canonical" href="https://opus147.github.io/Surveypro-">
<!-- Fonts â€” async load so blank screen never happens -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@700;800&display=swap"></noscript>
<noscript><link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet"></noscript>
<!-- QR Code Library â€” async, with fallback -->
<script>
// Inline critical font fallback so page NEVER shows blank
document.documentElement.style.setProperty('--ff-body', "'Space Grotesk', 'Segoe UI', system-ui, -apple-system, sans-serif");
document.documentElement.style.setProperty('--ff-mono', "'JetBrains Mono', 'Courier New', monospace");
document.documentElement.style.setProperty('--ff-display', "'Syne', 'Arial Black', sans-serif");
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script async src="https://js.paystack.co/v1/inline.js"></script>
<style>
/* CRITICAL: Ensure page is always visible regardless of external resource loading */
html, body { opacity: 1 !important; visibility: visible !important; }
/* System font fallbacks active from millisecond 0 */
body { font-family: 'Space Grotesk', 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
.display, h1, h2, h3 { font-family: 'Syne', 'Arial Black', 'Impact', sans-serif; }
.mono, code, input[class*="mono"] { font-family: 'JetBrains Mono', 'Courier New', Courier, monospace; }
</style>
<!-- Structured Data (SEO) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "SurveyPro Elite",
  "description": "Nigeria's #1 Professional Land Surveying Platform",
  "url": "https://opus147.github.io/Surveypro-",
  "telephone": "+2348117554948",
  "email": "opusarnold@gmail.com",
  "address": {"@type": "PostalAddress", "addressCountry": "NG"},
  "priceRange": "â‚¦â‚¦â€“â‚¦â‚¦â‚¦",
  "serviceType": "Land Surveying Services"
}
</script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --primary: #0f172a;
  --accent: #16a34a;
  --accent2: #1d4ed8;
  --gold: #ca8a04;
  --surface: #ffffff;
  --surface2: #f0fdf4;
  --surface3: #eff6ff;
  --border: #e2e8f0;
  --text: #0f172a;
  --text2: #475569;
  --text3: #94a3b8;
  --success: #16a34a;
  --warning: #d97706;
  --danger: #dc2626;
  --info: #0284c7;
  --radius: 14px;
  --shadow: 0 4px 24px rgba(15,23,42,0.08);
  --shadow-lg: 0 20px 60px rgba(15,23,42,0.14);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:var(--ff-body,'Space Grotesk','Segoe UI',system-ui,sans-serif);background:#f8fafc;color:var(--text);min-height:100vh;line-height:1.6;}
.mono{font-family:var(--ff-mono,'JetBrains Mono','Courier New',monospace);}
.display{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);}
/* CRITICAL: Ensure body is always visible */
body{opacity:1 !important;visibility:visible !important;display:block !important;}
::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:#f1f5f9;}
::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}

/* â•â•â• TOP BANNER â•â•â• */
.top-banner{background:linear-gradient(90deg,#16a34a,#1d4ed8);color:#fff;font-size:0.82rem;font-weight:600;display:none;position:relative;z-index:200;}
.top-banner.show{display:block;}
.banner-inner{max-width:1280px;margin:0 auto;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;gap:10px;}

/* â•â•â• TOAST â•â•â• */
.toast-wrap{position:fixed;bottom:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:8px;}
.toast{background:#0f172a;color:#fff;padding:12px 18px;border-radius:10px;font-size:0.84rem;font-weight:600;opacity:0;transform:translateX(20px);transition:.35s;max-width:320px;box-shadow:0 8px 24px rgba(0,0,0,0.25);}
.toast.show{opacity:1;transform:translateX(0);}
.toast.t-success{background:#15803d;}
.toast.t-warning{background:#b45309;}
.toast.t-error{background:#dc2626;}
.toast.t-info{background:#0284c7;}

/* â•â•â• HEADER â•â•â• */
header{background:linear-gradient(135deg,#0f172a 0%,#1e3a5f 60%,#064e3b 100%);color:#fff;position:sticky;top:0;z-index:100;box-shadow:0 2px 20px rgba(0,0,0,0.3);}
.header-inner{max-width:1280px;margin:0 auto;padding:14px 20px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;}
.logo-block h1{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.6rem;font-weight:800;letter-spacing:-0.02em;}
.logo-block h1 span{color:#4ade80;}
.logo-sub{font-size:0.7rem;opacity:0.7;margin-top:1px;letter-spacing:0.04em;}
.header-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.eco-badge{display:flex;align-items:center;gap:5px;background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3);color:#4ade80;padding:4px 10px;border-radius:20px;font-size:0.72rem;font-weight:600;}
.gps-pill{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.1);padding:6px 14px;border-radius:20px;font-size:0.8rem;cursor:pointer;transition:.2s;}
.gps-pill:hover{background:rgba(255,255,255,0.2);}
.gps-dot{width:9px;height:9px;border-radius:50%;background:#ef4444;flex-shrink:0;}
.gps-dot.active{background:#4ade80;box-shadow:0 0 8px #4ade80;animation:blink 1.5s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.4;}}
.hdr-btn{background:rgba(255,255,255,0.12);border:none;color:#fff;padding:7px 13px;border-radius:10px;font-size:0.8rem;cursor:pointer;transition:.2s;font-family:inherit;}
.hdr-btn:hover{background:rgba(255,255,255,0.22);}
select.hdr-btn{appearance:none;cursor:pointer;}

/* â•â•â• NAVIGATION â•â•â• */
.nav-wrap{max-width:1280px;margin:0 auto;padding:10px 20px;}
.nav-bar{background:#fff;border-radius:16px;padding:6px;display:flex;gap:4px;overflow-x:auto;box-shadow:var(--shadow);}
.nav-bar::-webkit-scrollbar{height:0;}
.nav-btn{display:flex;align-items:center;gap:6px;padding:9px 16px;border:none;border-radius:11px;font-size:0.8rem;font-weight:600;white-space:nowrap;cursor:pointer;transition:.2s;background:transparent;color:var(--text2);font-family:inherit;}
.nav-btn:hover{background:#f1f5f9;color:var(--text);}
.nav-btn.active{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;box-shadow:0 4px 14px rgba(15,23,42,0.25);}
.nav-btn .nb-icon{font-size:1.1rem;}

/* â•â•â• MAIN â•â•â• */
main{max-width:1280px;margin:0 auto;padding:20px 20px 120px;}
.tab-content{display:none;animation:fadeUp .35s ease;}
.tab-content.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* â•â•â• CARDS â•â•â• */
.card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;margin-bottom:20px;border:1px solid var(--border);}
.card-header{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
.card-header h2{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.1rem;font-weight:700;}
.card-icon{font-size:1.4rem;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;}
.card-hover{transition:.25s;}
.card-hover:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg);}

/* â•â•â• FORMS â•â•â• */
.form-group{margin-bottom:14px;}
.form-group label{display:block;font-size:0.8rem;font-weight:600;color:var(--text2);margin-bottom:5px;}
.form-group label .req{color:var(--danger);}
input,select,textarea{width:100%;padding:11px 14px;border:2px solid var(--border);border-radius:10px;font-size:0.88rem;font-family:inherit;color:var(--text);background:#fff;transition:.2s;outline:none;}
input:focus,select:focus,textarea:focus{border-color:var(--accent2);box-shadow:0 0 0 3px rgba(29,78,216,0.1);}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.form-row.three{grid-template-columns:1fr 1fr 1fr;}
@media(max-width:640px){.form-row,.form-row.three{grid-template-columns:1fr;}}

/* â•â•â• BUTTONS â•â•â• */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:11px 20px;border:none;border-radius:10px;font-size:0.88rem;font-weight:700;cursor:pointer;transition:.2s;font-family:inherit;text-decoration:none;}
.btn:hover{transform:translateY(-1px);}
.btn:active{transform:translateY(0);}
.btn-primary{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;box-shadow:0 4px 14px rgba(15,23,42,0.2);}
.btn-primary:hover{box-shadow:0 8px 24px rgba(15,23,42,0.3);}
.btn-green{background:linear-gradient(135deg,#16a34a,#15803d);color:#fff;box-shadow:0 4px 14px rgba(22,163,74,0.25);}
.btn-green:hover{box-shadow:0 8px 24px rgba(22,163,74,0.35);}
.btn-blue{background:linear-gradient(135deg,#1d4ed8,#1e40af);color:#fff;}
.btn-red{background:#dc2626;color:#fff;}
.btn-red:hover{background:#b91c1c;}
.btn-orange{background:linear-gradient(135deg,#d97706,#b45309);color:#fff;}
.btn-gray{background:#e2e8f0;color:var(--text2);}
.btn-gray:hover{background:#cbd5e1;}
.btn-outline{background:transparent;color:var(--accent);border:2px solid var(--accent);}
.btn-sm{padding:7px 14px;font-size:0.8rem;}
.btn-lg{padding:15px 28px;font-size:1rem;}
.btn-full{width:100%;}
.btn-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.btn-grid.three{grid-template-columns:1fr 1fr 1fr;}
.btn-grid.four{grid-template-columns:1fr 1fr 1fr 1fr;}
@media(max-width:640px){.btn-grid.four{grid-template-columns:1fr 1fr;}.btn-grid.three{grid-template-columns:1fr 1fr;}}

/* â•â•â• GPS & STATS â•â•â• */
.gps-box{padding:16px;background:var(--surface2);border:2px solid #bbf7d0;border-radius:12px;font-size:0.85rem;}
.gps-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:10px;}
.gps-info-item{background:#fff;border-radius:8px;padding:10px;border:1px solid var(--border);}
.gps-info-item .label{font-size:0.72rem;color:var(--text3);font-weight:600;}
.gps-info-item .val{font-family:var(--ff-mono,'JetBrains Mono','Courier New',monospace);font-weight:700;font-size:0.9rem;margin-top:2px;}
.stat-row{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:16px 0;}
@media(max-width:640px){.stat-row{grid-template-columns:repeat(3,1fr);}}
.stat-chip{text-align:center;padding:14px 8px;border-radius:12px;border:2px solid transparent;}
.stat-chip .sv{font-family:var(--ff-mono,'JetBrains Mono','Courier New',monospace);font-size:1.2rem;font-weight:700;line-height:1;}
.stat-chip .sk{font-size:0.68rem;font-weight:600;margin-top:4px;opacity:0.85;}
.sc-dark{background:#0f172a;color:#fff;}
.sc-green{background:#f0fdf4;border-color:#bbf7d0;color:#15803d;}
.sc-blue{background:#eff6ff;border-color:#bfdbfe;color:#1d4ed8;}
.sc-orange{background:#fffbeb;border-color:#fde68a;color:#b45309;}
.sc-purple{background:#faf5ff;border-color:#e9d5ff;color:#7c3aed;}

/* â•â•â• TABLE â•â•â• */
.data-table{width:100%;border-collapse:collapse;font-size:0.8rem;}
.data-table th{background:#0f172a;color:#fff;padding:10px 12px;text-align:left;font-weight:600;letter-spacing:0.03em;}
.data-table th:first-child{border-radius:8px 0 0 8px;}
.data-table th:last-child{border-radius:0 8px 8px 0;}
.data-table td{padding:9px 12px;border-bottom:1px solid var(--border);}
.data-table tr:hover td{background:#f8fafc;}
.data-table tr:last-child td{border-bottom:none;}

/* â•â•â• CANVAS â•â•â• */
canvas#plotCanvas{width:100%;border:2px solid #e2e8f0;border-radius:12px;background:#fff;cursor:crosshair;display:block;}

/* â•â•â• COORD / SUB TABS â•â•â• */
.sub-tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:20px;}
.sub-tab{padding:8px 16px;border-radius:8px;font-size:0.8rem;font-weight:600;cursor:pointer;border:2px solid var(--border);background:#fff;color:var(--text2);transition:.2s;font-family:inherit;}
.sub-tab.active{background:var(--accent2);color:#fff;border-color:var(--accent2);}
.coord-pane{display:none;}
.coord-pane.active{display:block;animation:fadeUp .3s ease;}
.result-box{background:#f8fafc;border:2px solid #e2e8f0;border-radius:10px;padding:14px;font-family:var(--ff-mono,'JetBrains Mono','Courier New',monospace);font-size:0.85rem;margin-top:12px;display:none;}
.result-box.show{display:block;}
.result-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid #f1f5f9;}
.result-row:last-child{border-bottom:none;}
.result-row .rk{color:var(--text2);font-family:var(--ff-body,'Space Grotesk','Segoe UI',sans-serif);}

/* â•â•â• MANUAL INPUT BOX â•â•â• */
.manual-box{background:#f0f9ff;border:2px dashed #93c5fd;border-radius:12px;padding:18px;margin-bottom:14px;display:none;}
.manual-box.open{display:block;animation:fadeUp .3s ease;}

/* â•â•â• EQUIPMENT â•â•â• */
.equip-card{border:2px solid var(--border);border-radius:var(--radius);padding:22px;background:#fff;transition:.25s;}
.equip-card:hover{border-color:var(--accent);box-shadow:0 8px 30px rgba(22,163,74,0.12);transform:translateY(-3px);}
.equip-top{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px;}
.equip-icon{font-size:2.5rem;}
.equip-price{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:2rem;font-weight:800;color:var(--accent);line-height:1;}
.equip-earn{display:inline-block;background:#f0fdf4;border:2px solid #bbf7d0;color:#15803d;padding:5px 12px;border-radius:20px;font-size:0.78rem;font-weight:700;margin:6px 0;}
.equip-features{list-style:none;margin:10px 0;display:flex;flex-direction:column;gap:3px;}
.equip-features li{font-size:0.82rem;color:var(--text2);}

/* â•â•â• REVENUE SPLIT â•â•â• */
.rev-split{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;border-radius:var(--radius);padding:24px;margin-bottom:20px;}
.rev-split h3{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.1rem;margin-bottom:14px;text-align:center;}
.split-row{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.1);border-radius:10px;padding:14px 18px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.15);}
.split-pct{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:2rem;font-weight:800;color:#4ade80;}
.split-label{font-size:0.85rem;opacity:0.85;}
.split-detail{font-size:0.75rem;opacity:0.65;margin-top:2px;}

/* â•â•â• COURSE CARD â•â•â• */
.course-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;background:#fff;transition:.25s;}
.course-card:hover{border-color:var(--accent2);box-shadow:var(--shadow);}
.course-level{display:inline-block;padding:3px 10px;border-radius:20px;font-size:0.72rem;font-weight:700;}
.level-beg{background:#f0fdf4;color:#15803d;}
.level-int{background:#eff6ff;color:#1d4ed8;}
.level-adv{background:#faf5ff;color:#7c3aed;}
.course-price{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.6rem;font-weight:800;color:var(--accent);}
.course-earn{background:#f0fdf4;border:1px solid #bbf7d0;color:#15803d;padding:4px 10px;border-radius:20px;font-size:0.75rem;font-weight:700;display:inline-block;}

/* â•â•â• HISTORY CARD â•â•â• */
.hist-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:14px;transition:.2s;}
.hist-card:hover{border-color:var(--accent);}
.hist-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;}
.hist-code{font-family:var(--ff-mono,'JetBrains Mono','Courier New',monospace);font-size:0.75rem;font-weight:700;background:#f0fdf4;color:#15803d;padding:4px 10px;border-radius:20px;}
.hist-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:10px;}
.hist-stat{text-align:center;padding:8px;border-radius:8px;background:#f8fafc;}
.hist-stat .hk{font-size:0.68rem;color:var(--text3);}
.hist-stat .hv{font-weight:800;font-size:0.95rem;}

/* â•â•â• VERIFY â•â•â• */
.verify-success{background:#f0fdf4;border:2px solid #86efac;border-radius:var(--radius);padding:20px;}
.verify-fail{background:#fef2f2;border:2px solid #fca5a5;border-radius:var(--radius);padding:20px;text-align:center;}

/* â•â•â• GIS CARD â•â•â• */
.gis-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;background:#fff;transition:.25s;}
.gis-card:hover{transform:translateY(-3px);box-shadow:var(--shadow);}

/* â•â•â• ECO SECTION â•â•â• */
.eco-banner{background:linear-gradient(135deg,#064e3b,#065f46,#047857);color:#fff;border-radius:var(--radius);padding:20px;text-align:center;margin-bottom:20px;}
.eco-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px;}
.eco-stat{background:rgba(255,255,255,0.15);border-radius:10px;padding:12px;text-align:center;}
.eco-stat .ev{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.4rem;font-weight:800;color:#4ade80;}
.eco-stat .ek{font-size:0.72rem;opacity:0.85;}

/* â•â•â• MODAL â•â•â• */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:500;padding:16px;backdrop-filter:blur(4px);}
.modal-bg.open{display:flex;}
.modal-box{background:#fff;border-radius:20px;padding:28px;max-width:480px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-lg);}

/* â•â•â• FOOTER â•â•â• */
footer{background:linear-gradient(135deg,#0f172a,#1e293b);color:#fff;padding:40px 0 20px;}
.footer-inner{max-width:1280px;margin:0 auto;padding:0 20px;}
.footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:30px;margin-bottom:30px;}
@media(max-width:768px){.footer-grid{grid-template-columns:1fr 1fr;gap:20px;}}
@media(max-width:480px){.footer-grid{grid-template-columns:1fr;}}
.footer-brand p{font-size:0.85rem;opacity:0.7;margin-top:8px;line-height:1.7;}
.footer-links h4,.footer-contact h4{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;font-size:0.9rem;margin-bottom:12px;color:#4ade80;}
.footer-links ul{list-style:none;}
.footer-links li{font-size:0.82rem;opacity:0.65;margin-bottom:5px;}
.footer-contact p{font-size:0.85rem;opacity:0.75;margin-bottom:5px;}
.footer-bottom{border-top:1px solid rgba(255,255,255,0.1);padding-top:20px;text-align:center;font-size:0.78rem;opacity:0.5;}

/* â•â•â• DARK MODE â•â•â• */
body.dark{background:#080e1a;color:#e2e8f0;}
body.dark .card{background:#0f172a;border-color:#1e293b;}
body.dark .nav-bar{background:#0f172a;}
body.dark .nav-btn{color:#94a3b8;}
body.dark .nav-btn:hover{background:#1e293b;}
body.dark input,body.dark select,body.dark textarea{background:#1e293b;border-color:#334155;color:#e2e8f0;}
body.dark .sub-tab{background:#1e293b;border-color:#334155;color:#94a3b8;}
body.dark .result-box,.dark .gps-box{background:#1e293b;border-color:#334155;}
body.dark .equip-card,body.dark .course-card,body.dark .gis-card,body.dark .hist-card,body.dark .modal-box{background:#0f172a;border-color:#1e293b;}
body.dark .data-table td{border-color:#1e293b;}
body.dark .data-table tr:hover td{background:#1e293b;}
body.dark .hist-stat{background:#1e293b;}
body.dark .manual-box{background:#0a1f12;border-color:#1a4a2a;}
body.dark [style*="background:#f0f9ff"],body.dark [style*="background:#f0fdf4"],body.dark [style*="background:#faf5ff"],body.dark [style*="background:#fffbeb"],body.dark [style*="background:#f0fdfa"],body.dark [style*="background:#fef9f0"],body.dark [style*="background:#fef9f0"]{background:#1e293b !important;}

/* â•â•â• RESPONSIVE â•â•â• */
@media(max-width:768px){
  .logo-block h1{font-size:1.2rem;}
  .stat-row{grid-template-columns:repeat(3,1fr);}
  main{padding:14px 14px 120px;}
  .card{padding:16px;}
  .equip-price{font-size:1.5rem;}
  .hist-stats{grid-template-columns:repeat(2,1fr);}
  .header-right{gap:6px;}
}
@media(max-width:480px){
  .stat-row{grid-template-columns:repeat(2,1fr);}
  .stat-chip:nth-child(5){grid-column:span 2;}
}

/* â•â•â• SPINNER â•â•â• */
.spinner{width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;display:inline-block;}
@keyframes spin{to{transform:rotate(360deg);}}

/* â•â•â• BADGE â•â•â• */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:0.72rem;font-weight:700;}
.badge-green{background:#f0fdf4;color:#15803d;}
.badge-blue{background:#eff6ff;color:#1d4ed8;}
.badge-gold{background:#fffbeb;color:#92400e;}

/* â•â•â• CONTACT FORM (Formspree) â•â•â• */
.contact-form-card{background:linear-gradient(135deg,#0f172a,#1e3a5f);border-radius:var(--radius);padding:28px;color:#fff;}
.contact-form-card label{color:rgba(255,255,255,0.8);}
.contact-form-card input,.contact-form-card select,.contact-form-card textarea{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.2);color:#fff;}
.contact-form-card input::placeholder,.contact-form-card textarea::placeholder{color:rgba(255,255,255,0.4);}
.contact-form-card input:focus,.contact-form-card select:focus,.contact-form-card textarea:focus{border-color:#4ade80;background:rgba(255,255,255,0.15);}

/* â•â•â• HERO SECTION â•â•â• */
.hero-section{background:linear-gradient(135deg,#0f172a 0%,#1e3a5f 50%,#064e3b 100%);color:#fff;border-radius:var(--radius);padding:48px 32px;text-align:center;margin-bottom:24px;position:relative;overflow:hidden;}
.hero-section::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h60v60H0z' fill='none'/%3E%3Ccircle cx='30' cy='30' r='1' fill='rgba(255,255,255,0.05)'/%3E%3C/svg%3E") repeat;pointer-events:none;}
.hero-title{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:2.8rem;font-weight:800;line-height:1.15;margin-bottom:16px;}
@media(max-width:640px){.hero-title{font-size:1.8rem;}}
.hero-sub{font-size:1rem;opacity:0.8;max-width:600px;margin:0 auto 28px;}
.hero-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:28px;}
@media(max-width:640px){.hero-stats{grid-template-columns:repeat(2,1fr);}}
.hero-stat{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);border-radius:12px;padding:16px;}
.hero-stat .hv{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.8rem;font-weight:800;color:#4ade80;}
.hero-stat .hk{font-size:0.75rem;opacity:0.75;margin-top:2px;}

/* â•â•â• PRICING HIGHLIGHT â•â•â• */
.price-popular{border:3px solid var(--accent);background:var(--surface2);position:relative;}
.price-badge{position:absolute;top:-13px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:4px 16px;border-radius:20px;font-size:0.75rem;font-weight:700;white-space:nowrap;}
.price-box{border:2px solid var(--border);border-radius:var(--radius);padding:28px;text-align:center;transition:.25s;}
.price-box:hover{box-shadow:var(--shadow-lg);transform:translateY(-3px);}

/* â•â•â• AUTH NOTICE BANNER â•â•â• */
.auth-notice{background:linear-gradient(90deg,#1d4ed8,#7c3aed);color:#fff;border-radius:12px;padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;gap:14px;flex-wrap:wrap;}

/* â•â•â• PWA INSTALL BAR â•â•â• */
#installBar{display:none;position:fixed;bottom:0;left:0;right:0;z-index:2000;background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;padding:14px 20px;align-items:center;justify-content:space-between;gap:12px;box-shadow:0 -4px 20px rgba(0,0,0,0.4);flex-wrap:wrap;}

/* â•â•â• ADVANCED COMMERCIAL ADDITIONS â•â•â• */
/* Formspree form styling */
.form-baas{background:var(--surface2);border:2px solid #bbf7d0;border-radius:var(--radius);padding:24px;margin-bottom:20px;}
.form-baas h3{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:16px;font-size:1rem;}
.form-baas .status-msg{padding:10px 14px;border-radius:8px;font-size:0.85rem;font-weight:600;margin-top:12px;display:none;}
.form-baas .status-msg.show{display:block;}
.form-baas .status-msg.success{background:#f0fdf4;color:#15803d;border:1px solid #86efac;}
.form-baas .status-msg.error{background:#fef2f2;color:#dc2626;border:1px solid #fca5a5;}

/* Auth modal styles */
.auth-tabs{display:flex;gap:0;margin-bottom:20px;border:2px solid var(--border);border-radius:10px;overflow:hidden;}
.auth-tab{flex:1;padding:10px;border:none;background:#f8fafc;font-weight:600;cursor:pointer;font-family:inherit;font-size:0.85rem;transition:.2s;}
.auth-tab.active{background:#0f172a;color:#fff;}
.auth-pane{display:none;}
.auth-pane.active{display:block;}
.auth-divider{text-align:center;position:relative;margin:16px 0;}
.auth-divider::before{content:'';position:absolute;left:0;top:50%;width:100%;height:1px;background:var(--border);}
.auth-divider span{background:#fff;padding:0 12px;font-size:0.78rem;color:var(--text3);position:relative;}

/* Stripe payment button */
.stripe-btn{background:linear-gradient(135deg,#635bff,#4b44cc);color:#fff;border:none;border-radius:10px;padding:13px 22px;font-weight:700;cursor:pointer;font-family:inherit;font-size:0.9rem;width:100%;display:flex;align-items:center;justify-content:center;gap:8px;transition:.2s;}
.stripe-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(99,91,255,0.35);}
.paystack-btn{background:linear-gradient(135deg,#00c3f7,#0084cc);color:#fff;border:none;border-radius:10px;padding:13px 22px;font-weight:700;cursor:pointer;font-family:inherit;font-size:0.9rem;width:100%;display:flex;align-items:center;justify-content:center;gap:8px;transition:.2s;margin-top:8px;}
.paystack-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,132,204,0.35);}

/* Dashboard section (logged-in state) */
.user-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.4);color:#4ade80;padding:6px 14px;border-radius:20px;font-size:0.8rem;font-weight:600;cursor:pointer;}
.plan-badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:0.72rem;font-weight:700;}
.plan-free{background:#f0fdf4;color:#15803d;}
.plan-basic{background:#eff6ff;color:#1d4ed8;}
.plan-pro{background:#fdf4ff;color:#7c3aed;}
.plan-ent{background:#fff7ed;color:#c2410c;}

/* Advanced stats dashboard */
.stats-dash{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:20px;}
.stats-dash .sd-card{background:#fff;border:2px solid var(--border);border-radius:12px;padding:16px;text-align:center;}
.stats-dash .sd-card .sd-num{font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.8rem;font-weight:800;color:var(--accent);}
.stats-dash .sd-card .sd-label{font-size:0.72rem;color:var(--text3);font-weight:600;margin-top:3px;}

/* Directory listing */
.directory-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;background:#fff;transition:.25s;}
.directory-card:hover{border-color:var(--accent2);box-shadow:var(--shadow);}
.surveyor-rating{display:flex;align-items:center;gap:4px;font-size:0.82rem;color:var(--gold);}
.verification-badge{display:inline-flex;align-items:center;gap:4px;background:#f0fdf4;border:1px solid #86efac;color:#15803d;padding:3px 8px;border-radius:6px;font-size:0.72rem;font-weight:700;}
.specialization-tag{display:inline-block;background:#eff6ff;color:#1d4ed8;padding:3px 8px;border-radius:6px;font-size:0.72rem;font-weight:600;margin:2px;}

/* Job board */
.job-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;background:#fff;transition:.25s;margin-bottom:12px;}
.job-card:hover{border-color:var(--accent);box-shadow:var(--shadow);}
.job-urgency{display:inline-block;padding:3px 10px;border-radius:20px;font-size:0.72rem;font-weight:700;}
.urgency-low{background:#f0fdf4;color:#15803d;}
.urgency-med{background:#fffbeb;color:#b45309;}
.urgency-high{background:#fef2f2;color:#dc2626;}
.urgency-urg{background:#0f172a;color:#fff;}

/* State directory dropdown enhanced */
.state-filter{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px;}
@media(max-width:640px){.state-filter{grid-template-columns:1fr;}}

/* Notification dot */
.notif-dot{display:inline-block;width:8px;height:8px;background:#ef4444;border-radius:50%;margin-left:4px;animation:blink 2s infinite;}

</style>

<body>

<!-- TOP BANNER -->
<div class="top-banner" id="topBanner">
  <div class="banner-inner">
    <span id="bannerMsg">ğŸ‰ Welcome to SurveyPro Elite â€” Nigeria's #1 Professional Surveying Platform</span>
    <button onclick="closeBanner()" style="background:rgba(255,255,255,0.2);border:none;color:#fff;padding:5px 12px;border-radius:8px;cursor:pointer;font-family:inherit;font-weight:700;">âœ•</button>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- MODAL -->
<div class="modal-bg" id="modalBg" onclick="if(event.target===this)closeModal()">
  <div class="modal-box" id="modalBox">
    <div id="modalContent"></div>
  </div>
</div>

<!-- â•â•â• HEADER â•â•â• -->
<header>
  <div class="header-inner">
    <div class="logo-block">
      <h1 class="display">ğŸ¯ SurveyPro <span>Elite</span></h1>
      <div class="logo-sub">NIGERIA'S #1 PROFESSIONAL SURVEYING PLATFORM Â· WGS84 Â· UTM 31â€“33N Â· NNO Â· SURCON ALIGNED</div>
    </div>
    <div class="header-right">
      <div class="eco-badge">ğŸŒ¿ Eco-Certified</div>
      <div class="gps-pill" onclick="showTab('survey')">
        <span class="gps-dot" id="gpsDot"></span>
        <span id="gpsLabel">GPS Off</span>
      </div>
      <select class="hdr-btn" id="langSelect" onchange="setLang(this.value)">
        <option value="en">ğŸ‡³ğŸ‡¬ English</option>
        <option value="ha">Hausa</option>
        <option value="yo">Yoruba</option>
        <option value="ig">Igbo</option>
        <option value="fr">FranÃ§ais</option>
      </select>
      <button class="hdr-btn" onclick="toggleDark()" id="darkBtn">ğŸŒ™ Dark</button>
      <button class="hdr-btn" onclick="showTab('pricing')">ğŸ’ Pricing</button>
      <button class="hdr-btn" onclick="showTab('contact')" style="background:rgba(74,222,128,0.25);border:1px solid rgba(74,222,128,0.4);">ğŸ“© Contact</button>
    </div>
  
      <!-- Auth Buttons -->
      <div style="display:flex;align-items:center;gap:8px;">
        <button class="hdr-btn" id="loginBtn" onclick="openAuthModal('login')" style="background:rgba(74,222,128,0.2);border:1px solid rgba(74,222,128,0.4);color:#4ade80;">ğŸ” Sign In</button>
        <div id="userMenu" style="display:none;align-items:center;gap:8px;">
          <div class="user-badge" onclick="showTab('history')">
            <span>ğŸ‘¤</span>
            <span id="userName">User</span>
            <span id="userPlan" class="plan-badge plan-free">FREE</span>
          </div>
          <button class="hdr-btn" onclick="logoutUser()" style="font-size:0.72rem;">Sign Out</button>
        </div>
      </div>
      </div>
</header>

<!-- â•â•â• NAVIGATION â•â•â• -->
<div class="nav-wrap">
  <nav class="nav-bar" role="navigation" aria-label="Main navigation">
    <button class="nav-btn active" id="nb-home" onclick="showTab('home')"><span class="nb-icon">ğŸ </span>Home</button>
    <button class="nav-btn" id="nb-survey" onclick="showTab('survey')"><span class="nb-icon">ğŸ“Š</span>Survey</button>
    <button class="nav-btn" id="nb-coords" onclick="showTab('coords')"><span class="nb-icon">ğŸŒ</span>Coordinates</button>
    <button class="nav-btn" id="nb-plot" onclick="showTab('plot')"><span class="nb-icon">ğŸ“</span>Plot Layout</button>
    <button class="nav-btn" id="nb-gis" onclick="showTab('gis')"><span class="nb-icon">ğŸ—ºï¸</span>GIS Tools</button>
    <button class="nav-btn" id="nb-verify" onclick="showTab('verify')"><span class="nb-icon">ğŸ”’</span>C of O</button>
    <button class="nav-btn" id="nb-equipment" onclick="showTab('equipment')"><span class="nb-icon">âš™ï¸</span>Equipment</button>
    <button class="nav-btn" id="nb-training" onclick="showTab('training')"><span class="nb-icon">ğŸ“</span>Training</button>
    <button class="nav-btn" id="nb-jobs" onclick="showTab('jobs')"><span class="nb-icon">ğŸ’¼</span>Jobs</button>
    <button class="nav-btn" id="nb-directory" onclick="showTab('directory')"><span class="nb-icon">ğŸ—‚ï¸</span>Directory</button>
    <button class="nav-btn" id="nb-history" onclick="showTab('history')"><span class="nb-icon">ğŸ“</span>History</button>
    <button class="nav-btn" id="nb-reports" onclick="showTab('reports')"><span class="nb-icon">ğŸ“„</span>Reports</button>
    <button class="nav-btn" id="nb-pricing" onclick="showTab('pricing')"><span class="nb-icon">ğŸ’</span>Pricing</button>
    <button class="nav-btn" id="nb-contact" onclick="showTab('contact')"><span class="nb-icon">ğŸ“©</span>Contact</button>
    <button class="nav-btn" id="nb-tools" onclick="showTab('tools')"><span class="nb-icon">ğŸ”§</span>Adv Tools</button>
  </nav>
</div>

<main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOME TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content active" id="tab-home">

  <!-- HERO -->
  <div class="hero-section">
    <div style="display:inline-block;background:rgba(74,222,128,0.2);border:1px solid rgba(74,222,128,0.4);color:#4ade80;padding:6px 18px;border-radius:20px;font-size:0.78rem;font-weight:700;margin-bottom:16px;letter-spacing:0.05em;">ğŸ‡³ğŸ‡¬ MADE FOR NIGERIA Â· SURCON ALIGNED Â· ISO 14001</div>
    <h2 class="hero-title">Nigeria's Most Advanced<br>Land Surveying Platform</h2>
    <p class="hero-sub">Professional GPS survey tools, coordinate conversion, GIS referrals, equipment rental & training â€” all in one platform. Commercial-ready. Market-proven.</p>
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
      <button class="btn btn-green btn-lg" onclick="showTab('survey')">ğŸ“¡ Start Surveying Now</button>
      <button class="btn btn-outline btn-lg" style="color:#fff;border-color:rgba(255,255,255,0.5);" onclick="showTab('pricing')">ğŸ’ View Plans</button>
    </div>
    <div class="hero-stats">
      <div class="hero-stat"><div class="hv">10K+</div><div class="hk">Surveys Completed</div></div>
      <div class="hero-stat"><div class="hv">36</div><div class="hk">States Covered</div></div>
      <div class="hero-stat"><div class="hv">Â±8mm</div><div class="hk">RTK Accuracy</div></div>
      <div class="hero-stat"><div class="hv">50%</div><div class="hk">Your Commission</div></div>
    </div>
  </div>

  <!-- DEPLOYMENT GUIDE NOTICE -->
  <div style="background:linear-gradient(135deg,#1e3a5f,#0f172a);color:#fff;border-radius:14px;padding:18px 20px;margin-bottom:20px;border:1px solid rgba(74,222,128,0.3);" id="deployGuide">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;">
      <div>
        <div style="font-size:0.72rem;font-weight:700;color:#4ade80;letter-spacing:1px;margin-bottom:6px;">ğŸš€ YOUR PLATFORM URL</div>
        <div style="font-size:1rem;font-weight:800;margin-bottom:4px;">https://opus147.github.io/Surveypro-</div>
        <div style="font-size:0.72rem;opacity:0.7;"></div>
      </div>
      <button onclick="document.getElementById('deployGuide').style.display='none'" style="background:rgba(255,255,255,0.15);border:none;color:#fff;border-radius:6px;padding:4px 10px;cursor:pointer;font-size:0.75rem;">âœ•</button>
    </div>
    <div style="margin-top:12px;padding-top:10px;border-top:1px solid rgba(255,255,255,0.15);font-size:0.75rem;opacity:0.8;">
      âš™ï¸ <strong>GitHub Pages Setup:</strong> Go to your repo Settings â†’ Pages â†’ Source: Deploy from branch â†’ main/root â†’ Enable HTTPS âœ…
    </div>
  </div>

  <!-- FEATURE CARDS -->
  <div class="card-grid" style="margin-bottom:20px;">
    <div class="card card-hover" onclick="showTab('survey')" style="cursor:pointer;border-left:4px solid var(--accent);">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸ“¡</div>
      <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:6px;">GPS Survey Tool</h3>
      <p style="font-size:0.85rem;color:var(--text2);">Real-time GPS capture, manual point entry, CSV import. Calculate area, perimeter, plots. Complete + save reports.</p>
      <div class="badge badge-green" style="margin-top:12px;">Free Â· Always</div>
    </div>
    <div class="card card-hover" onclick="showTab('coords')" style="cursor:pointer;border-left:4px solid var(--accent2);">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸŒ</div>
      <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:6px;">Coordinate Conversion</h3>
      <p style="font-size:0.85rem;color:var(--text2);">Lat/Lon â†” UTM, Bearing & Distance, Traverse computation, Area Calculator, Inverse Calculation. Multi-format output.</p>
      <div class="badge badge-blue" style="margin-top:12px;">WGS84 Â· UTM 31â€“33N</div>
    </div>
    <div class="card card-hover" onclick="showTab('gis')" style="cursor:pointer;border-left:4px solid var(--gold);">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸ—ºï¸</div>
      <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:6px;">GIS Referral Income</h3>
      <p style="font-size:0.85rem;color:var(--text2);">Refer clients to satellite imagery, urban planning, drone photogrammetry & more. Earn 50% on every referral.</p>
      <div class="badge badge-gold" style="margin-top:12px;">Up to â‚¦36,000 per referral</div>
    </div>
    <div class="card card-hover" onclick="showTab('equipment')" style="cursor:pointer;border-left:4px solid #7c3aed;">
      <div style="font-size:2.5rem;margin-bottom:10px;">âš™ï¸</div>
      <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:6px;">Equipment Marketplace</h3>
      <p style="font-size:0.85rem;color:var(--text2);">Book Total Stations, RTK GNSS, drones, 3D scanners & more. Earn 50% commission on every rental.</p>
      <div class="badge" style="background:#faf5ff;color:#7c3aed;margin-top:12px;">â‚¦3Kâ€“â‚¦50K/day</div>
    </div>
    <div class="card card-hover" onclick="showTab('training')" style="cursor:pointer;border-left:4px solid #0284c7;">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸ“</div>
      <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:6px;">Training Hub</h3>
      <p style="font-size:0.85rem;color:var(--text2);">GIS, drone surveying, AutoCAD, RTK/GNSS, C of O law & more. Industry-certified courses. 50% per enrollment.</p>
      <div class="badge badge-blue" style="margin-top:12px;">â‚¦18Kâ€“â‚¦45K per course</div>
    </div>
    <div class="card card-hover" onclick="showTab('verify')" style="cursor:pointer;border-left:4px solid var(--accent);">
      <div style="font-size:2.5rem;margin-bottom:10px;">ğŸ”’</div>
      <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:6px;">C of O Verification</h3>
      <p style="font-size:0.85rem;color:var(--text2);">Verify SurveyPro-generated codes instantly. QR scanning. Professional C of O documentation assistance.</p>
      <div class="badge badge-green" style="margin-top:12px;">Instant Verification</div>
    </div>
  </div>

  <!-- WHY US -->
  <div class="card" style="background:linear-gradient(135deg,#f0fdf4,#eff6ff);border:2px solid #bbf7d0;">
    <div class="card-header"><span class="card-icon">ğŸ†</span><h2>Why SurveyPro Elite?</h2></div>
    <div class="card-grid">
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.8rem;">ğŸ“±</span>
        <div><strong>Works Offline (PWA)</strong><p style="font-size:0.82rem;color:var(--text2);margin-top:3px;">Install on any device, works without internet in the field.</p></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.8rem;">ğŸ”</span>
        <div><strong>Secure & Private</strong><p style="font-size:0.82rem;color:var(--text2);margin-top:3px;">All data stored locally. No account required to get started.</p></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.8rem;">ğŸ’°</span>
        <div><strong>50% Commission Model</strong><p style="font-size:0.82rem;color:var(--text2);margin-top:3px;">Earn real money on equipment, courses & GIS referrals.</p></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.8rem;">ğŸ‡³ğŸ‡¬</span>
        <div><strong>Built for Nigeria</strong><p style="font-size:0.82rem;color:var(--text2);margin-top:3px;">WGS84, UTM 31-33N, NNO/Minna datum. All 36 states.</p></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.8rem;">âš¡</span>
        <div><strong>Lightning Fast</strong><p style="font-size:0.82rem;color:var(--text2);margin-top:3px;">Static front-end = blazing speed. Ranks higher on Google.</p></div>
      </div>
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <span style="font-size:1.8rem;">ğŸŒ¿</span>
        <div><strong>Eco-Certified</strong><p style="font-size:0.82rem;color:var(--text2);margin-top:3px;">100% paperless. ISO 14001 aligned. 500+ trees saved/year.</p></div>
      </div>
    </div>
  
    <!-- â•â•â• FORMSPREE CONTACT (No Backend Needed) â•â•â• -->
    <div class="form-baas">
      <h3>ğŸ“© Send Us a Message</h3>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:16px;">Powered by Formspree â€” messages go directly to our inbox. No backend required.</p>
      <form id="contactForm" action="https://formspree.io/f/xpwzldjk" method="POST" onsubmit="submitContact(event)">
        <div class="form-row">
          <div class="form-group"><label>Full Name <span class="req">*</span></label><input type="text" name="name" required placeholder="Your full name"></div>
          <div class="form-group"><label>Email <span class="req">*</span></label><input type="email" name="email" required placeholder="your@email.com"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Phone</label><input type="tel" name="phone" placeholder="080XXXXXXXX"></div>
          <div class="form-group"><label>Service Interest</label>
            <select name="service">
              <option>Boundary Survey</option><option>Topographic Survey</option><option>C of O Processing</option>
              <option>Equipment Rental</option><option>Training Course</option><option>GIS Analysis</option><option>Other</option>
            </select>
          </div>
        </div>
        <div class="form-group"><label>State</label>
          <select name="state">
            <option value="">Select your state...</option>
            <option>Abia</option><option>Adamawa</option><option>Akwa Ibom</option><option>Anambra</option>
            <option>Bauchi</option><option>Bayelsa</option><option>Benue</option><option>Borno</option>
            <option>Cross River</option><option>Delta</option><option>Ebonyi</option><option>Edo</option>
            <option>Ekiti</option><option>Enugu</option><option>FCT - Abuja</option><option>Gombe</option>
            <option>Imo</option><option>Jigawa</option><option>Kaduna</option><option>Kano</option>
            <option>Katsina</option><option>Kebbi</option><option>Kogi</option><option>Kwara</option>
            <option>Lagos</option><option>Nasarawa</option><option>Niger</option><option>Ogun</option>
            <option>Ondo</option><option>Osun</option><option>Oyo</option><option>Plateau</option>
            <option>Rivers</option><option>Sokoto</option><option>Taraba</option><option>Yobe</option><option>Zamfara</option>
          </select>
        </div>
        <div class="form-group"><label>Message <span class="req">*</span></label><textarea name="message" rows="4" required placeholder="Describe your surveying needs, land size, location, budget..."></textarea></div>
        <input type="hidden" name="_subject" value="New SurveyPro Elite Inquiry">
        <input type="hidden" name="_next" value="https://opus147.github.io/Surveypro-">
        <button class="btn btn-green btn-lg btn-full" type="submit">ğŸ“¨ Send Message â€” We Reply Within 2 Hours</button>
        <div class="status-msg" id="contactStatus"></div>
      </form>
    </div>

</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SURVEY TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-survey">

  <!-- ECO BANNER -->
  <div class="eco-banner">
    <div style="font-size:1.4rem;margin-bottom:6px;">ğŸŒ¿ SurveyPro Elite â€” Green & Carbon-Neutral Platform</div>
    <div style="font-size:0.82rem;opacity:0.85;">Paperless reports Â· Digital submissions Â· Energy-efficient cloud processing Â· ISO 14001 aligned</div>
    <div class="eco-stats">
      <div class="eco-stat"><div class="ev">98%</div><div class="ek">Paperless Operations</div></div>
      <div class="eco-stat"><div class="ev">Zero</div><div class="ek">Carbon Emissions</div></div>
      <div class="eco-stat"><div class="ev">500+</div><div class="ek">Trees Saved / Year</div></div>
    </div>
  </div>

  <!-- GPS PANEL -->
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“¡</span><h2>GPS & Live Location</h2></div>
    <div class="gps-box" id="gpsInfoBox">
      <p style="color:var(--text2);font-size:0.85rem;">Click <strong>Enable GPS</strong> to start real-time positioning for your survey. Works best outdoors with clear sky view.</p>
    </div>
    <div class="btn-grid four" style="margin-top:14px;">
      <button class="btn btn-green" onclick="enableGPS()">ğŸ“¡ Enable GPS</button>
      <button class="btn btn-red" onclick="stopGPS()">â›” Stop GPS</button>
      <button class="btn btn-blue" onclick="addGPSPoint()">â• Add GPS Point</button>
      <button class="btn btn-gray" onclick="getCurrentLocationInfo()">ğŸ“ My Location</button>
    </div>
    <div id="gpsInfoGrid" class="gps-info-grid" style="display:none;margin-top:12px;"></div>
  </div>

  <!-- CLIENT DETAILS -->
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ‘¤</span><h2>Client & Project Details</h2></div>
    <div class="form-row">
      <div class="form-group"><label>Client Name <span class="req">*</span></label><input id="clientName" type="text" placeholder="Full legal name" autocomplete="name"></div>
      <div class="form-group"><label>Phone <span class="req">*</span></label><input id="clientPhone" type="tel" placeholder="080XXXXXXXX" autocomplete="tel"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Email</label><input id="clientEmail" type="email" placeholder="client@email.com" autocomplete="email"></div>
      <div class="form-group"><label>NIN / ID Number</label><input id="clientNIN" type="text" placeholder="National ID Number"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Project Name <span class="req">*</span></label><input id="projectName" type="text" placeholder="Project / Survey name"></div>
      <div class="form-group"><label>Location <span class="req">*</span></label><input id="location" type="text" placeholder="Survey site address"></div>
    </div>
    <div class="form-row three">
      <div class="form-group"><label>File Number</label><input id="fileNumber" type="text" placeholder="LD/123/2026"></div>
      <div class="form-group"><label>Survey Type</label>
        <select id="surveyType">
          <option>Boundary Survey</option><option>Topographic Survey</option>
          <option>Cadastral Survey</option><option>Engineering Survey</option>
          <option>Construction Survey</option><option>Hydrographic Survey</option>
          <option>Route Survey</option><option>Photogrammetric Survey</option>
          <option>Drone/Aerial Survey</option><option>Mining Survey</option>
        </select>
      </div>
      <div class="form-group"><label>Coordinate System</label>
        <select id="coordSys">
          <option>WGS 84 / UTM Zone 31N</option><option>WGS 84 / UTM Zone 32N</option>
          <option>WGS 84 / UTM Zone 33N</option><option>Minna / UTM Zone 31N (NNO)</option>
          <option>ETRS89 / UTM</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Horizontal Datum</label>
        <select id="hDatum"><option>WGS84</option><option>Minna (NNO)</option><option>Clarke 1880</option></select>
      </div>
      <div class="form-group"><label>Vertical Datum</label>
        <select id="vDatum"><option>Mean Sea Level (MSL)</option><option>Ellipsoidal Height</option><option>Geoid Height (EGM2008)</option></select>
      </div>
    </div>
    <div class="form-group"><label>Survey Notes / Remarks</label>
      <textarea id="surveyNotes" rows="2" placeholder="Additional notes, obstructions, access issues..."></textarea>
    </div>
  </div>

  <!-- SURVEY CONTROLS -->
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“</span><h2>Survey Controls</h2></div>
    <div class="btn-grid four" style="margin-bottom:14px;">
      <button class="btn btn-green" onclick="addManualPointToggle()">âœï¸ Manual Point</button>
      <button class="btn btn-orange" onclick="undoPoint()">â†©ï¸ Undo Last</button>
      <button class="btn btn-blue" onclick="importCSVPoints()">ğŸ“‚ Import CSV</button>
      <button class="btn btn-red" onclick="clearSurvey()">ğŸ—‘ï¸ Clear All</button>
    </div>

    <!-- Manual Input -->
    <div class="manual-box" id="manualBox">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:8px;">
        <div style="font-size:0.82rem;font-weight:700;color:var(--accent2);">âœï¸ Enter Manual Point Coordinates</div>
        <div style="display:flex;gap:6px;">
          <button class="btn btn-sm" id="manModeNE" style="background:var(--accent);color:#fff;font-size:0.72rem;padding:3px 10px;" onclick="setManualMode('ne')">ğŸ“ N/E</button>
          <button class="btn btn-sm" id="manModeLL" style="background:var(--border);color:var(--text);font-size:0.72rem;padding:3px 10px;" onclick="setManualMode('latlon')">ğŸ“Œ Lat/Lon</button>
        </div>
      </div>
      <div class="form-row three">
        <div class="form-group"><label id="manField1Lbl">Northing (m)</label><input id="manualN" type="number" step="0.001" placeholder="857881.968" class="mono"></div>
        <div class="form-group"><label id="manField2Lbl">Easting (m)</label><input id="manualE" type="number" step="0.001" placeholder="707032.831" class="mono"></div>
        <div class="form-group"><label>Elevation (m)</label><input id="manualElev" type="number" step="0.001" placeholder="0.000" class="mono"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Point Description</label><input id="manualDesc" type="text" placeholder="e.g. TP1, CP, Boundary Pillar"></div>
        <div class="form-group" style="display:flex;align-items:flex-end;">
          <button class="btn btn-green btn-full" onclick="confirmManualPoint()">âœ… Add Point</button>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <div class="stat-row">
      <div class="stat-chip sc-dark"><div class="sv" id="ptCount">0</div><div class="sk">Points</div></div>
      <div class="stat-chip sc-green"><div class="sv" id="areaHa">0.0000</div><div class="sk">Hectares</div></div>
      <div class="stat-chip sc-blue"><div class="sv" id="areaAc">0.0000</div><div class="sk">Acres</div></div>
      <div class="stat-chip sc-orange"><div class="sv" id="areaSqm">0</div><div class="sk">Sq Metres</div></div>
      <div class="stat-chip sc-purple"><div class="sv" id="plotsCount">0.0</div><div class="sk">Plots(50Ã—100)</div></div>
    </div>
    <div class="stat-row" style="margin-top:0;">
      <div class="stat-chip sc-blue" style="grid-column:span 2"><div class="sv" id="perim">0.00</div><div class="sk">Perimeter (m)</div></div>
      <div class="stat-chip sc-green" style="grid-column:span 3"><div class="sv" id="bearingInfo" style="font-size:0.75rem;font-family:'Space Grotesk','Segoe UI',sans-serif';letter-spacing:0">â€”</div><div class="sk">Last Bearing / Distance</div></div>
    </div>

    <!-- Points Table -->
    <div id="pointsTableWrap" style="overflow-x:auto;margin-bottom:16px;"></div>

    <!-- Actions -->
    <div class="btn-grid" style="gap:10px;">
      <button class="btn btn-green btn-lg" onclick="completeSurvey()">âœ… Complete & Save Survey</button>
      <button class="btn btn-blue" onclick="emailSurvey()">ğŸ“§ Email Report</button>
      <button class="btn" style="background:#25D366;color:#fff;" onclick="whatsappSurvey()">ğŸ“± WhatsApp</button>
      <button class="btn btn-gray" onclick="printSurvey()">ğŸ–¨ï¸ Print Report</button>
      <button class="btn btn-primary" onclick="exportSurveyJSON()">â¬‡ï¸ Export JSON</button>
      <button class="btn btn-orange" onclick="generateQR()">ğŸ“± QR Code</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COORDINATES TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-coords">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸŒ</span><h2>Coordinate Conversion Tools</h2></div>
    <div class="sub-tabs">
      <button class="sub-tab active" id="ct-latutm" onclick="showCoord('latutm')">Lat/Lon â†” UTM</button>
      <button class="sub-tab" id="ct-bearing" onclick="showCoord('bearing')">Bearing & Distance</button>
      <button class="sub-tab" id="ct-multiformat" onclick="showCoord('multiformat')">Multi-Format</button>
      <button class="sub-tab" id="ct-traverse" onclick="showCoord('traverse')">Traverse Calc</button>
      <button class="sub-tab" id="ct-area" onclick="showCoord('area')">Area Calculator</button>
      <button class="sub-tab" id="ct-inverse" onclick="showCoord('inverse')">Inverse Calc</button>
    </div>

    <!-- Lat/UTM -->
    <div class="coord-pane active" id="cp-latutm">
      <div class="card-grid">
        <div style="background:#f0f9ff;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ Lat/Lon â†’ UTM</h4>
          <div class="form-group"><label>Latitude (Â°N or Â°S)</label><input id="ll-lat" type="number" step="0.0000001" placeholder="7.75771146" class="mono"></div>
          <div class="form-group"><label>Longitude (Â°E)</label><input id="ll-lon" type="number" step="0.0000001" placeholder="4.53887695" class="mono"></div>
          <div class="form-group"><label>UTM Zone (auto-detect or override)</label><input id="ll-zone" type="number" min="1" max="60" placeholder="31 (auto)" class="mono"></div>
          <button class="btn btn-blue btn-full" onclick="convLatToUTM()">Convert â†’</button>
          <div class="result-box" id="res-lltoutm"></div>
        </div>
        <div style="background:#f0fdf4;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ UTM â†’ Lat/Lon</h4>
          <div class="form-group"><label>UTM Zone</label><input id="utm-zone" type="number" min="1" max="60" placeholder="31" class="mono"></div>
          <div class="form-group"><label>Easting (m)</label><input id="utm-e" type="number" step="0.001" placeholder="707032.831" class="mono"></div>
          <div class="form-group"><label>Northing (m)</label><input id="utm-n" type="number" step="0.001" placeholder="857881.968" class="mono"></div>
          <div class="form-group"><label>Hemisphere</label><select id="utm-hemi"><option value="N">Northern</option><option value="S">Southern</option></select></div>
          <button class="btn btn-green btn-full" onclick="convUTMToLat()">Convert â†’</button>
          <div class="result-box" id="res-utmtoll"></div>
        </div>
      </div>
    </div>

    <!-- Bearing & Distance -->
    <div class="coord-pane" id="cp-bearing">
      <div style="background:#faf5ff;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ§­ Calculate Point from Bearing & Distance</h4>
        <div class="form-row">
          <div class="form-group"><label>Start Northing (m)</label><input id="bd-n" type="number" step="0.001" placeholder="857881.968" class="mono"></div>
          <div class="form-group"><label>Start Easting (m)</label><input id="bd-e" type="number" step="0.001" placeholder="707032.831" class="mono"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Bearing (0â€“360Â°)</label><input id="bd-bearing" type="number" step="0.0001" min="0" max="360" placeholder="45.0000" class="mono"></div>
          <div class="form-group"><label>Distance (m)</label><input id="bd-dist" type="number" step="0.001" placeholder="100.000" class="mono"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Vertical Angle (optional Â°)</label><input id="bd-va" type="number" step="0.001" placeholder="0 = horizontal" class="mono"></div>
          <div class="form-group"><label>Instrument HI (m)</label><input id="bd-hi" type="number" step="0.001" placeholder="1.500" class="mono"></div>
        </div>
        <button class="btn btn-primary btn-full" onclick="calcBearingDist()">Calculate Point</button>
        <div class="result-box" id="bd-result"></div>
      </div>
    </div>

    <!-- Multi Format -->
    <div class="coord-pane" id="cp-multiformat">
      <div class="card-grid">
        <div style="background:#fffbeb;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">Input Coordinates</h4>
          <div class="form-group"><label>Input Format</label>
            <select id="mf-format">
              <option value="dd">Decimal Degrees (e.g. 7.757)</option>
              <option value="dms">DMS (e.g. 7 45 25.5)</option>
              <option value="ddm">DDM (e.g. 7 45.425)</option>
            </select>
          </div>
          <div class="form-group"><label>Latitude</label><input id="mf-lat" placeholder="7.75771146" class="mono"></div>
          <div class="form-group"><label>Longitude</label><input id="mf-lon" placeholder="4.53887695" class="mono"></div>
          <button class="btn btn-orange btn-full" onclick="convertMultiFormat()">Convert All Formats â†’</button>
        </div>
        <div style="background:#f8fafc;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">All Output Formats</h4>
          <div id="mf-results" style="font-size:0.82rem;"></div>
        </div>
      </div>
    </div>

    <!-- Traverse -->
    <div class="coord-pane" id="cp-traverse">
      <div style="background:#f0fdfa;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:8px;">ğŸ“ Closed Traverse Computation</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:14px;">Bowditch/Compass rule adjustment applied. Enter traverse legs and start coordinates.</p>
        <div class="form-row">
          <div class="form-group"><label>Start Northing (m)</label><input id="trav-n0" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
          <div class="form-group"><label>Start Easting (m)</label><input id="trav-e0" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
        </div>
        <button class="btn btn-green btn-sm" onclick="addTravLeg()" style="margin-bottom:10px;">+ Add Leg</button>
        <div id="trav-legs" style="margin-bottom:12px;display:flex;flex-direction:column;gap:8px;"></div>
        <div class="btn-grid">
          <button class="btn btn-primary" onclick="computeTraverse()">Compute Traverse</button>
          <button class="btn btn-gray" onclick="clearTraverse()">Clear Legs</button>
        </div>
        <div class="result-box" id="trav-result" style="margin-top:12px;overflow-x:auto;"></div>
      </div>
    </div>

    <!-- Area Calculator -->
    <div class="coord-pane" id="cp-area">
      <div style="background:#faf5ff;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ Area from Coordinates (Shoelace Formula)</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Enter N, E coordinate pairs (one per line)</p>
        <div class="form-group"><label>Northing values (one per line)</label><textarea id="area-n" rows="6" placeholder="857881.968&#10;857882.000&#10;857800.000&#10;857799.000" class="mono"></textarea></div>
        <div class="form-group"><label>Easting values (one per line)</label><textarea id="area-e" rows="6" placeholder="707032.831&#10;707200.000&#10;707200.000&#10;707032.000" class="mono"></textarea></div>
        <button class="btn btn-primary btn-full" onclick="calcAreaFromCoords()">Calculate Area</button>
        <div class="result-box" id="area-result"></div>
      </div>
    </div>

    <!-- Inverse Calc -->
    <div class="coord-pane" id="cp-inverse">
      <div style="background:#fef9f0;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ”„ Inverse Calculation (Distance & Bearing)</h4>
        <div class="card-grid">
          <div>
            <h5 style="font-size:0.85rem;font-weight:700;margin-bottom:10px;">Point A</h5>
            <div class="form-group"><label>Northing A (m)</label><input id="inv-n1" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
            <div class="form-group"><label>Easting A (m)</label><input id="inv-e1" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
          </div>
          <div>
            <h5 style="font-size:0.85rem;font-weight:700;margin-bottom:10px;">Point B</h5>
            <div class="form-group"><label>Northing B (m)</label><input id="inv-n2" type="number" step="0.001" placeholder="1100.000" class="mono"></div>
            <div class="form-group"><label>Easting B (m)</label><input id="inv-e2" type="number" step="0.001" placeholder="1100.000" class="mono"></div>
          </div>
        </div>
        <button class="btn btn-orange btn-full" onclick="calcInverse()">Calculate Inverse</button>
        <div class="result-box" id="inv-result"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PLOT LAYOUT TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-plot">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“</span><h2>Professional Survey Plot Layout Generator</h2></div>
    <p style="font-size:0.85rem;color:var(--text2);margin-bottom:16px;">Generate a scaled plot diagram with survey coordinates, dimensions, and professional watermark. Export as PNG.</p>
    <div class="form-row">
      <div class="form-group"><label>Plot Owner / Title Holder</label><input id="plotOwner" type="text" placeholder="Full legal name"></div>
      <div class="form-group"><label>Plot Address / Survey Number</label><input id="plotAddress" type="text" placeholder="Plot address or survey description"></div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap;">
      <span style="font-size:0.8rem;color:var(--text2);font-weight:600;">Start Coordinate Mode:</span>
      <button class="btn btn-sm" id="plotModeLatLon" style="background:var(--accent);color:#fff;font-size:0.78rem;padding:4px 12px;" onclick="setPlotMode('latlon')">ğŸ“Œ Lat/Lon</button>
      <button class="btn btn-sm" id="plotModeNE" style="background:var(--border);color:var(--text);font-size:0.78rem;padding:4px 12px;" onclick="setPlotMode('ne')">ğŸ“ Northing/Easting</button>
    </div>
    <div class="form-row">
      <div class="form-group"><label id="plotField1Lbl">Start Latitude (Â°)</label><input id="plotLat" type="number" step="0.0000001" placeholder="7.75771146" class="mono"></div>
      <div class="form-group"><label id="plotField2Lbl">Start Longitude (Â°)</label><input id="plotLon" type="number" step="0.0000001" placeholder="4.53887695" class="mono"></div>
    </div>
    <div class="form-row three">
      <div class="form-group"><label>Plot Width (m)</label><input id="plotWidth" type="number" value="15" step="0.1"></div>
      <div class="form-group"><label>Plot Depth (m)</label><input id="plotDepth" type="number" value="30" step="0.1"></div>
      <div class="form-group"><label>Orientation (Â°)</label><input id="plotOrient" type="number" value="0" step="0.1" placeholder="0 = North"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Scale</label><select id="plotScale"><option value="500">1:500</option><option value="1000">1:1000</option><option value="2500">1:2500</option><option value="5000">1:5000</option></select></div>
      <div class="form-group"><label>Plot Title</label><input id="plotTitle" type="text" placeholder="e.g. Survey Plan Showing..."></div>
    </div>
    <div class="btn-grid" style="margin-bottom:14px;">
      <button class="btn btn-primary" onclick="generatePlot()">ğŸ“ Generate Layout</button>
      <button class="btn btn-blue" onclick="exportPlot()">ğŸ’¾ Export PNG</button>
      <button class="btn btn-green" onclick="calcCanvasArea()">ğŸ“Š Calculate Area</button>
      <button class="btn btn-gray" onclick="clearPlotCanvas()">ğŸ—‘ï¸ Clear</button>
    </div>
    <canvas id="plotCanvas" width="900" height="600"></canvas>
    <div class="result-box" id="plotAreaResult" style="margin-top:12px;"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GIS TOOLS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-gis">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ—ºï¸</span><h2>GIS & Remote Sensing Services</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:20px;">Refer clients to our licensed GIS partners. <strong>Earn 50% on every successful referral</strong> â€” your 50% paid to Opay: 8117554948 Â· partner 50% goes to the licensed GIS firm.</p>

    <div class="card-grid">
      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ›°ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Satellite Data Access</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Multispectral imagery, NDVI analysis, land cover classification, change detection (2mâ€“30m resolution).</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦15,000 Â· Your 50%: â‚¦7,500</div>
        <button class="btn btn-blue btn-full btn-sm" onclick="requestGIS('Satellite Data Access','15000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸŒ¾</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Agricultural Monitoring</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Crop health (NDVI/NDWI), yield prediction, irrigation optimization, precision farming reports.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦20,000 Â· Your 50%: â‚¦10,000</div>
        <button class="btn btn-green btn-full btn-sm" onclick="requestGIS('Agricultural Monitoring','20000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ™ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Urban Planning GIS</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Land use mapping, infrastructure planning, zoning analysis, urban growth modelling & visualizations.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦35,000 Â· Your 50%: â‚¦17,500</div>
        <button class="btn btn-primary btn-full btn-sm" onclick="requestGIS('Urban Planning GIS','35000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸŒŠ</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Flood Risk Assessment</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Hydrological modelling, DEM extraction, drainage analysis, flood susceptibility mapping (FEMA-aligned).</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦40,000 Â· Your 50%: â‚¦20,000</div>
        <button class="btn btn-blue btn-full btn-sm" onclick="requestGIS('Flood Risk Assessment','40000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ—‚ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Cadastral Mapping</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Property boundary delineation, title surveys, land registry GIS database, parcel indexing.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦25,000 Â· Your 50%: â‚¦12,500</div>
        <button class="btn btn-orange btn-full btn-sm" onclick="requestGIS('Cadastral Mapping','25000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸŒ¿</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Environmental Impact (EIA)</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Deforestation monitoring, biodiversity mapping, habitat analysis, NESREA-compliant EIA reports.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦50,000 Â· Your 50%: â‚¦25,000</div>
        <button class="btn btn-green btn-full btn-sm" onclick="requestGIS('Environmental Impact Assessment','50000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸš</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Drone Photogrammetry</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Aerial mapping, orthophoto, DSM/DTM generation, volumetric analysis, 3D point cloud.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦80,000 Â· Your 50%: â‚¦40,000</div>
        <button class="btn btn-primary btn-full btn-sm" onclick="requestGIS('Drone Photogrammetry','80000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ—ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">BIM & 3D Modelling</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Building Information Modelling, 3D laser scan to BIM, as-built documentation, clash detection.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦60,000 Â· Your 50%: â‚¦30,000</div>
        <button class="btn btn-blue btn-full btn-sm" onclick="requestGIS('BIM 3D Modelling','60000')">Request Service</button></div>
    </div>

    <div style="margin-top:20px;background:#0f172a;color:#fff;border-radius:var(--radius);padding:20px;text-align:center;">
      <p style="font-weight:700;font-size:1.05rem;">ğŸ“ Direct Contact: Arnold Opusunju</p>
      <p style="opacity:0.7;font-size:0.85rem;margin-top:6px;">+234-811-755-4948 Â· <a href="mailto:opusarnold@gmail.com" style="color:inherit;">opusarnold@gmail.com</a> Â· Opay: 8117554948</p>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     C of O VERIFY TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-verify">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ”’</span><h2>C of O Verification System</h2></div>
    <div style="background:#fffbeb;border-left:4px solid #d97706;border-radius:8px;padding:14px;margin-bottom:20px;font-size:0.85rem;">
      <strong>âš ï¸ Notice:</strong> This system verifies SurveyPro Elite-generated survey codes. For official government Certificate of Occupancy, contact your state land registry (Lagos, Abuja, etc.).
    </div>

    <div style="max-width:500px;">
      <div class="form-group">
        <label style="font-size:1rem;font-weight:700;">Enter Verification Code</label>
        <input id="verifyInput" type="text" placeholder="e.g. NGS-MLP6LZZD" class="mono" style="font-size:1.1rem;letter-spacing:0.08em;text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()">
      </div>
      <button class="btn btn-primary btn-full btn-lg" onclick="verifySurveyCode()">ğŸ” Verify Code</button>
    </div>

    <div id="verifyResult" style="margin-top:20px;"></div>

    <div style="margin-top:24px;background:var(--surface3);border:2px solid #bfdbfe;border-radius:12px;padding:20px;">
      <h4 style="font-weight:700;margin-bottom:8px;">ğŸ“‹ Professional C of O Assistance</h4>
      <p style="font-size:0.85rem;color:var(--text2);margin-bottom:14px;">Need full C of O documentation, land title processing, or government registry coordination? Our team handles it end-to-end.</p>
      <div class="btn-grid">
        <button class="btn" style="background:#25D366;color:#fff;" onclick="requestCofO()">ğŸ“± WhatsApp Inquiry</button>
        <button class="btn btn-blue" onclick="emailCofO()">ğŸ“§ Email Inquiry</button>
      </div>
    </div>

    <div id="qrSection" style="display:none;margin-top:20px;text-align:center;">
      <h4 style="font-weight:700;margin-bottom:10px;">ğŸ“± Scan to Verify</h4>
      <div id="qrContainer"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EQUIPMENT TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-equipment">
  <div class="card">
    <div class="card-header"><span class="card-icon">âš™ï¸</span><h2>Professional Equipment Rental Marketplace</h2></div>

    <div class="rev-split">
      <h3>ğŸ’° Revenue Split â€” You Earn 50% on Every Booking</h3>
      <div class="split-row">
        <div><div class="split-label">Your Platform Commission (Arnold)</div><div class="split-detail">Instant transfer Â· Opay: 8117554948</div></div>
        <div style="text-align:center;"><div class="split-pct">50%</div><div style="font-size:0.75rem;opacity:0.75;">of rental price</div></div>
      </div>
      <div class="split-row">
        <div><div class="split-label">Equipment Rental Partner</div><div class="split-detail">Licensed & insured equipment providers</div></div>
        <div style="text-align:center;"><div class="split-pct" style="color:#60a5fa;">50%</div><div style="font-size:0.75rem;opacity:0.75;">of rental price</div></div>
      </div>
      <div style="font-size:0.75rem;text-align:center;margin-top:12px;opacity:0.65;border-top:1px solid rgba(255,255,255,0.15);padding-top:10px;">Customer pays â†’ 50% auto-credited to Opay 8117554948 â†’ 50% goes to licensed equipment partner</div>
    </div>

    <div class="card-grid" id="equipGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TRAINING TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-training">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“</span><h2>Professional Training Hub</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:18px;">Industry-certified courses. <strong>50% commission on every enrollment</strong>. Delivered by global leaders including Autodesk, Trimble, Pix4D, and more.</p>

    <div class="rev-split" style="margin-bottom:20px;">
      <h3>ğŸ’¡ Training Revenue Share</h3>
      <div class="split-row"><div><div class="split-label">Platform Owner (Arnold) Â· Opay: 8117554948</div></div><div class="split-pct">50%</div></div>
      <div class="split-row"><div><div class="split-label">Course / Education Provider</div></div><div class="split-pct" style="color:#60a5fa;">50%</div></div>
    </div>

    <div class="card-grid" id="coursesGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JOBS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-jobs">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
      <div class="card-header" style="margin-bottom:0;"><span class="card-icon">ğŸ’¼</span><h2>Job Board â€” Nigeria Survey Market</h2></div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-green btn-sm" onclick="postJob()">+ Post Job</button>
        <button class="btn btn-blue btn-sm" onclick="initJobBoard()">ğŸ”„ Refresh</button>
      </div>
    </div>
    <div style="background:#eff6ff;border:2px solid #bfdbfe;border-radius:12px;padding:16px;margin-bottom:20px;">
      <p style="font-size:0.85rem;color:var(--accent2);font-weight:600;margin-bottom:6px;">ğŸ’¼ How It Works</p>
      <p style="font-size:0.8rem;color:var(--text2);">Land owners post survey jobs. Licensed surveyors apply and get hired. Platform earns 10% on completion. All 36 Nigerian states covered.</p>
    </div>
    <div class="state-filter" style="margin-bottom:16px;">
      <div class="form-group" style="margin:0;"><label>State</label>
        <select id="jobStateFilter" onchange="filterJobs()"><option value="">All States</option>
          <option>Lagos</option><option>FCT - Abuja</option><option>Rivers</option><option>Kano</option>
          <option>Ogun</option><option>Anambra</option><option>Delta</option><option>Enugu</option>
          <option>Kaduna</option><option>Oyo</option><option>Edo</option><option>Imo</option>
          <option>Plateau</option><option>Benue</option><option>Cross River</option><option>Akwa Ibom</option>
        </select>
      </div>
      <div class="form-group" style="margin:0;"><label>Category</label>
        <select id="jobCatFilter" onchange="filterJobs()"><option value="">All Categories</option>
          <option>Cadastral Survey</option><option>Topographic Survey</option><option>Boundary Survey</option>
          <option>Engineering Survey</option><option>GIS Mapping</option><option>C of O Processing</option>
        </select>
      </div>
      <div class="form-group" style="margin:0;"><label>Urgency</label>
        <select id="jobUrgFilter" onchange="filterJobs()"><option value="">All</option>
          <option value="urgent">Urgent</option><option value="high">High</option>
          <option value="medium">Medium</option><option value="low">Low</option>
        </select>
      </div>
    </div>
    <div id="jobBoardContent"><div style="text-align:center;padding:40px;color:var(--text3);">Loading jobs...</div></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DIRECTORY TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-directory">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ—‚ï¸</span><h2>Licensed Surveyor Directory â€” All 36 States</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:20px;">Find and hire SURCON-licensed professional surveyors near you. Verified credentials. Real reviews.</p>
    <div class="state-filter" style="margin-bottom:20px;">
      <div class="form-group" style="margin:0;"><label>State</label>
        <select id="dirStateFilter" onchange="filterDirectory()"><option value="">All States</option>
          <option>Lagos</option><option>FCT - Abuja</option><option>Rivers</option><option>Kano</option>
          <option>Ogun</option><option>Anambra</option><option>Delta</option><option>Enugu</option>
          <option>Kaduna</option><option>Oyo</option><option>Edo</option><option>Imo</option>
          <option>Plateau</option><option>Benue</option><option>Kwara</option><option>Cross River</option>
          <option>Akwa Ibom</option><option>Bayelsa</option><option>Ondo</option><option>Osun</option>
        </select>
      </div>
      <div class="form-group" style="margin:0;"><label>Specialization</label>
        <select id="dirSpecFilter" onchange="filterDirectory()"><option value="">All</option>
          <option>Cadastral Survey</option><option>Topographic Survey</option><option>Boundary Survey</option>
          <option>Engineering Survey</option><option>GIS Mapping</option><option>Hydrographic Survey</option>
          <option>Photogrammetric Survey</option><option>Environmental Survey</option>
        </select>
      </div>
      <div class="form-group" style="margin:0;"><label>Min Rating</label>
        <select id="dirRatingFilter" onchange="filterDirectory()"><option value="">Any Rating</option>
          <option value="4.5">â­ 4.5+</option><option value="4.0">â­ 4.0+</option><option value="3.5">â­ 3.5+</option>
        </select>
      </div>
    </div>
    <div class="card-grid" id="directoryContent"><div style="text-align:center;padding:40px;color:var(--text3);">Loading directory...</div></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HISTORY TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-history">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
      <div class="card-header" style="margin-bottom:0;"><span class="card-icon">ğŸ“</span><h2>Survey History</h2></div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-blue btn-sm" onclick="exportAllSurveysJSON()">â¬‡ï¸ Export All</button>
        <button class="btn btn-red btn-sm" onclick="clearAllHistory()">ğŸ—‘ï¸ Clear All</button>
      </div>
    </div>
    <div id="historyContent">
      <div style="text-align:center;padding:60px 20px;color:var(--text3);">
        <div style="font-size:3rem;margin-bottom:12px;">ğŸ“‚</div>
        <p style="font-size:1.1rem;font-weight:600;">No saved surveys yet</p>
        <p style="font-size:0.85rem;margin-top:6px;">Complete and save surveys to see them here</p>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     REPORTS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-reports">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“„</span><h2>Professional Reports Generator</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:20px;">Generate professional, printable survey reports with official formatting. Select a saved survey, add surveyor details, and export or email.</p>
    <div class="form-row">
      <div class="form-group"><label>Select Survey</label>
        <select id="reportSurveySelect"><option value="">â€” Select a saved survey â€”</option></select>
      </div>
      <div class="form-group"><label>Report Type</label>
        <select id="reportType">
          <option>Full Survey Report</option>
          <option>Summary Certificate</option>
          <option>Client Invoice</option>
          <option>Field Data Sheet</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Surveyor's Name</label><input id="rptSurveyor" type="text" placeholder="Licensed Surveyor Name" value="Arnold Opusunju"></div>
      <div class="form-group"><label>License / SURCON Number</label><input id="rptLicense" type="text" placeholder="SURCON/2026/XXXXX"></div>
    </div>
    <div class="form-group"><label>Report Footer / Seal Statement</label><textarea id="rptFooter" rows="2" placeholder="This survey was conducted in accordance with SURCON standards and the provisions of the Survey Coordination Act..."></textarea></div>
    <div class="btn-grid">
      <button class="btn btn-primary" onclick="generateReport()">ğŸ“„ Generate Report</button>
      <button class="btn btn-blue" onclick="printReport()">ğŸ–¨ï¸ Print</button>
      <button class="btn btn-green" onclick="emailReport()">ğŸ“§ Email Report</button>
      <button class="btn btn-gray" onclick="previewReport()">ğŸ‘ï¸ Preview</button>
    </div>
    <div id="reportPreview" style="margin-top:20px;"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PRICING TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-pricing">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ’</span><h2>Pricing & Service Packages</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:24px;text-align:center;">Professional surveying services at transparent, competitive rates. All prices in Nigerian Naira (â‚¦). Pay via WhatsApp, Opay, or bank transfer.</p>

    <!-- Subscription Plans -->
    <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:16px;">ğŸ”‘ Platform Subscription Plans</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;margin-bottom:36px;">
      <!-- Basic -->
      <div class="price-box">
        <div style="font-size:0.8rem;font-weight:700;color:var(--text2);letter-spacing:0.08em;margin-bottom:8px;">BASIC</div>
        <div style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:2.5rem;font-weight:800;color:var(--text);">Free</div>
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:16px;">GPS + Coordinates + Plot Layout</div>
        <ul style="text-align:left;font-size:0.82rem;list-style:none;display:flex;flex-direction:column;gap:7px;margin-bottom:20px;">
          <li>âœ… Unlimited GPS points</li>
          <li>âœ… All coordinate conversions</li>
          <li>âœ… Plot layout generator</li>
          <li>âœ… Survey history (local)</li>
          <li>âœ… C of O verification</li>
          <li>âŒ Advanced PDF reports</li>
          <li>âŒ Priority support</li>
        </ul>
        <button class="btn btn-outline btn-full" onclick="showTab('survey')">Get Started Free</button>
      </div>
      <!-- Pro -->
      <div class="price-box price-popular">
        <div class="price-badge">â­ MOST POPULAR</div>
        <div style="font-size:0.8rem;font-weight:700;color:var(--accent);letter-spacing:0.08em;margin-bottom:8px;">PROFESSIONAL</div>
        <div style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:2.5rem;font-weight:800;color:var(--accent);">â‚¦5,000<span style="font-size:1rem;color:var(--text2)">/mo</span></div>
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:16px;">Full platform access</div>
        <ul style="text-align:left;font-size:0.82rem;list-style:none;display:flex;flex-direction:column;gap:7px;margin-bottom:20px;">
          <li>âœ… Everything in Basic</li>
          <li>âœ… Professional PDF reports</li>
          <li>âœ… Traverse computation</li>
          <li>âœ… GIS service referrals</li>
          <li>âœ… Equipment & training commissions</li>
          <li>âœ… WhatsApp integration</li>
          <li>âœ… Priority support</li>
        </ul>
        <button class="btn btn-green btn-full" onclick="subscribePro()">Subscribe â€” â‚¦5,000/mo</button>
      </div>
      <!-- Enterprise -->
      <div class="price-box" style="border-color:var(--accent2);background:var(--surface3);">
        <div style="font-size:0.8rem;font-weight:700;color:var(--accent2);letter-spacing:0.08em;margin-bottom:8px;">ENTERPRISE</div>
        <div style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:2.5rem;font-weight:800;color:var(--accent2);">â‚¦25,000<span style="font-size:1rem;color:var(--text2)">/mo</span></div>
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:16px;">For survey firms & agencies</div>
        <ul style="text-align:left;font-size:0.82rem;list-style:none;display:flex;flex-direction:column;gap:7px;margin-bottom:20px;">
          <li>âœ… Unlimited users</li>
          <li>âœ… White-label options</li>
          <li>âœ… API access & webhooks</li>
          <li>âœ… Custom branding</li>
          <li>âœ… Dedicated account manager</li>
          <li>âœ… SLA guarantee</li>
        </ul>
        <button class="btn btn-blue btn-full" onclick="contactEnterprise()">Contact for Enterprise</button>
      </div>
    </div>

    <!-- Payment Methods -->
    <div style="background:#f0fdf4;border:2px solid #bbf7d0;border-radius:12px;padding:20px;margin-bottom:24px;">
      <h4 style="font-weight:700;margin-bottom:10px;">ğŸ’³ Accepted Payment Methods</h4>
      <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:0.85rem;">
        <span style="background:#fff;border:1px solid var(--border);padding:8px 14px;border-radius:8px;">ğŸ“± Opay: 8117554948</span>
        <span style="background:#fff;border:1px solid var(--border);padding:8px 14px;border-radius:8px;">ğŸŸ¢ WhatsApp Pay</span>
        <span style="background:#fff;border:1px solid var(--border);padding:8px 14px;border-radius:8px;">ğŸ¦ Bank Transfer</span>
        <span style="background:#fff;border:1px solid var(--border);padding:8px 14px;border-radius:8px;">ğŸ’³ Card (via Paystack)</span>
      </div>
      <p style="font-size:0.78rem;color:var(--text3);margin-top:10px;">Contact via WhatsApp to set up payment and activate your subscription: +234-811-755-4948</p>
    </div>

    <!-- Survey Service Rates -->
    <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:14px;">ğŸ“‹ Professional Survey Service Rates</h3>
    <div style="overflow-x:auto;">
      <table class="data-table">
        <thead><tr><th>Service</th><th>Rate (From)</th><th>Unit</th><th>Notes</th></tr></thead>
        <tbody>
          <tr><td>Boundary Survey</td><td class="mono">â‚¦50,000</td><td>Per plot</td><td>Includes beaconing & pillars</td></tr>
          <tr><td>Topographic Survey</td><td class="mono">â‚¦15,000</td><td>Per hectare</td><td>Minimum 2ha</td></tr>
          <tr><td>Cadastral Survey</td><td class="mono">â‚¦80,000</td><td>Per parcel</td><td>Government-certified</td></tr>
          <tr><td>Engineering Survey</td><td class="mono">â‚¦100,000</td><td>Per project</td><td>Depends on scope</td></tr>
          <tr><td>Drone Aerial Survey</td><td class="mono">â‚¦80,000</td><td>Per day</td><td>Includes processing</td></tr>
          <tr><td>C of O Processing</td><td class="mono">â‚¦150,000</td><td>Per title</td><td>State-specific</td></tr>
          <tr><td>GIS Report / Analysis</td><td class="mono">â‚¦25,000</td><td>Per report</td><td>Custom analysis</td></tr>
          <tr><td>Training (per person)</td><td class="mono">â‚¦18,000</td><td>Per course</td><td>6â€“16 hours</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CONTACT TAB (Formspree-powered â€” no backend needed)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-contact">

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;" class="contact-grid">
    <!-- Formspree Contact Form -->
    <div class="contact-form-card">
      <h2 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.3rem;font-weight:800;margin-bottom:6px;">ğŸ“© Send Us a Message</h2>
      <p style="font-size:0.82rem;opacity:0.7;margin-bottom:20px;">Powered by Formspree â€” no server needed. We reply within 24 hours.</p>

      <!-- IMPORTANT: Replace YOUR_FORMSPREE_ID below with your actual Formspree form ID from formspree.io -->
      <form id="contactForm" action="https://formspree.io/f/YOUR_FORMSPREE_ID" method="POST" onsubmit="handleContactSubmit(event)">
        <div class="form-group"><label>Full Name <span class="req">*</span></label><input type="text" name="name" placeholder="Your full name" required autocomplete="name"></div>
        <div class="form-group"><label>Email <span class="req">*</span></label><input type="email" name="email" placeholder="your@email.com" required autocomplete="email"></div>
        <div class="form-group"><label>Phone</label><input type="tel" name="phone" placeholder="080XXXXXXXX" autocomplete="tel"></div>
        <div class="form-group"><label>Service Interested In</label>
          <select name="service">
            <option value="">Select a service...</option>
            <option>Boundary Survey</option><option>Topographic Survey</option>
            <option>Cadastral Survey</option><option>Drone Survey</option>
            <option>C of O Processing</option><option>GIS Service</option>
            <option>Equipment Rental</option><option>Training Enrollment</option>
            <option>Professional Subscription</option><option>Enterprise Plan</option>
          </select>
        </div>
        <div class="form-group"><label>Message <span class="req">*</span></label>
          <textarea name="message" rows="4" placeholder="Describe your survey requirements, location, and timeline..." required></textarea>
        </div>
        <!-- Hidden fields for Formspree -->
        <input type="hidden" name="_subject" value="New SurveyPro Elite Inquiry">
        <input type="hidden" name="_next" value="https://opus147.github.io/Surveypro-">
        <input type="text" name="_gotcha" style="display:none"> <!-- honeypot spam filter -->

        <div id="contactFormMsg" style="display:none;background:rgba(74,222,128,0.2);border:1px solid rgba(74,222,128,0.5);border-radius:8px;padding:12px;font-size:0.85rem;margin-bottom:12px;color:#4ade80;"></div>
        <button type="submit" class="btn btn-green btn-full btn-lg" id="contactSubmitBtn">ğŸ“© Send Message</button>
      </form>
    </div>

    <!-- Contact Info -->
    <div>
      <div class="card" style="border-left:4px solid var(--accent);">
        <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:16px;">ğŸ“ Direct Contact</h3>
        <div style="display:flex;flex-direction:column;gap:12px;font-size:0.9rem;">
          <a href="tel:+2348117554948" style="display:flex;gap:10px;align-items:center;text-decoration:none;color:var(--text);padding:12px;background:#f0fdf4;border-radius:10px;border:1px solid #bbf7d0;">
            <span style="font-size:1.4rem;">ğŸ“</span><div><div style="font-weight:700;">+234-811-755-4948</div><div style="font-size:0.75rem;color:var(--text3);">Call or SMS</div></div>
          </a>
          <a href="https://wa.me/2348117554948" target="_blank" rel="noopener" style="display:flex;gap:10px;align-items:center;text-decoration:none;color:#fff;padding:12px;background:#25D366;border-radius:10px;">
            <span style="font-size:1.4rem;">ğŸ’¬</span><div><div style="font-weight:700;">WhatsApp Us</div><div style="font-size:0.75rem;opacity:0.85;">Fast response Â· 08117554948</div></div>
          </a>
          <a href="mailto:opusarnold@gmail.com" style="display:flex;gap:10px;align-items:center;text-decoration:none;color:var(--text);padding:12px;background:var(--surface3);border-radius:10px;border:1px solid #bfdbfe;">
            <span style="font-size:1.4rem;">ğŸ“§</span><div><div style="font-weight:700;">opusarnold@gmail.com</div><div style="font-size:0.75rem;color:var(--text3);">Email Arnold directly</div></div>
          </a>
          <div style="display:flex;gap:10px;align-items:center;padding:12px;background:#fffbeb;border-radius:10px;border:1px solid #fde68a;">
            <span style="font-size:1.4rem;">ğŸ’³</span><div><div style="font-weight:700;">Opay: 8117554948</div><div style="font-size:0.75rem;color:var(--text3);">Instant transfers accepted</div></div>
          </div>
        </div>
        <div style="margin-top:16px;padding:12px;background:#f8fafc;border-radius:10px;font-size:0.8rem;color:var(--text2);">
          <strong>Office Hours:</strong> Monâ€“Sat Â· 8:00 AM â€“ 6:00 PM WAT<br>
          <strong>Response Time:</strong> WhatsApp: &lt;1 hour Â· Email: &lt;24 hours
        </div>
      </div>

      <div class="card" style="margin-top:0;border-left:4px solid var(--accent2);">
        <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-weight:700;margin-bottom:12px;">ğŸš€ Quick Actions</h3>
        <div style="display:flex;flex-direction:column;gap:10px;">
          <button class="btn btn-green btn-full" onclick="showTab('survey')">ğŸ“¡ Start a Free Survey</button>
          <button class="btn btn-blue btn-full" onclick="subscribePro()">ğŸ’ Subscribe â€” â‚¦5,000/mo</button>
          <button class="btn btn-primary btn-full" onclick="contactEnterprise()">ğŸ¢ Enterprise Inquiry</button>
          <button class="btn btn-gray btn-full" onclick="showTab('pricing')">ğŸ“‹ View All Pricing</button>
        </div>
      </div>
    </div>
  </div>

  <style>
  @media(max-width:768px){.contact-grid{grid-template-columns:1fr!important;}}
  </style>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADVANCED TOOLS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-tools">
  <div class="card" style="border-left:4px solid #7c3aed;">
    <div class="card-header"><span class="card-icon">ğŸ”§</span><h2>Advanced Engineering Tools</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:20px;">Professional-grade engineering calculations for field surveyors. All computations follow SURCON standards.</p>

    <!-- Sub Tabs -->
    <div class="sub-tabs">
      <button class="sub-tab active" id="tt-slope" onclick="showToolPane('slope')">ğŸ“ Slope & Grade</button>
      <button class="sub-tab" id="tt-stakeout" onclick="showToolPane('stakeout')">ğŸ¯ Stakeout</button>
      <button class="sub-tab" id="tt-curve" onclick="showToolPane('curve')">ğŸŒ€ Horizontal Curve</button>
      <button class="sub-tab" id="tt-volume" onclick="showToolPane('volume')">ğŸ“¦ Volume Calc</button>
      <button class="sub-tab" id="tt-trig" onclick="showToolPane('trig')">ğŸ“ Trig Levelling</button>
      <button class="sub-tab" id="tt-scale" onclick="showToolPane('scale')">ğŸ—ºï¸ Map Scale</button>
    </div>

    <!-- Slope & Grade -->
    <div class="coord-pane active" id="tp-slope">
      <div style="background:#f0f9ff;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ Slope, Grade & Cross-Fall Calculator</h4>
        <div class="form-row three">
          <div class="form-group"><label>Elevation Start (m)</label><input id="slope-e1" type="number" step="0.001" placeholder="100.000" class="mono"></div>
          <div class="form-group"><label>Elevation End (m)</label><input id="slope-e2" type="number" step="0.001" placeholder="103.500" class="mono"></div>
          <div class="form-group"><label>Horizontal Distance (m)</label><input id="slope-dist" type="number" step="0.001" placeholder="100.000" class="mono"></div>
        </div>
        <button class="btn btn-blue btn-full" onclick="calcSlope()">Calculate Slope</button>
        <div class="result-box" id="slope-result"></div>
      </div>
    </div>

    <!-- Stakeout -->
    <div class="coord-pane" id="tp-stakeout">
      <div style="background:#f0fdf4;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ¯ Stakeout Data Generator</h4>
        <div class="card-grid">
          <div>
            <h5 style="font-size:0.85rem;font-weight:700;margin-bottom:10px;">Instrument Station</h5>
            <div class="form-group"><label>Station Northing (m)</label><input id="so-sn" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
            <div class="form-group"><label>Station Easting (m)</label><input id="so-se" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
          </div>
          <div>
            <h5 style="font-size:0.85rem;font-weight:700;margin-bottom:10px;">Target Point</h5>
            <div class="form-group"><label>Target Northing (m)</label><input id="so-tn" type="number" step="0.001" placeholder="1050.000" class="mono"></div>
            <div class="form-group"><label>Target Easting (m)</label><input id="so-te" type="number" step="0.001" placeholder="1050.000" class="mono"></div>
          </div>
        </div>
        <button class="btn btn-green btn-full" onclick="generateStakeout()">Generate Stakeout Data</button>
        <div class="result-box" id="so-result"></div>
      </div>
    </div>

    <!-- Horizontal Curve -->
    <div class="coord-pane" id="tp-curve">
      <div style="background:#faf5ff;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸŒ€ Horizontal Curve Calculator</h4>
        <div class="form-row three">
          <div class="form-group"><label>Radius (m)</label><input id="hc-r" type="number" step="0.1" placeholder="200.0" class="mono"></div>
          <div class="form-group"><label>Deflection Angle (Â°)</label><input id="hc-delta" type="number" step="0.001" placeholder="45.000" class="mono"></div>
          <div class="form-group"><label>Chainage of PC (m)</label><input id="hc-pc" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
        </div>
        <button class="btn btn-primary btn-full" onclick="calcHorizCurve()">Calculate Curve Elements</button>
        <div class="result-box" id="hc-result"></div>
      </div>
    </div>

    <!-- Volume -->
    <div class="coord-pane" id="tp-volume">
      <div style="background:#fffbeb;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“¦ Earthworks Volume Calculator (Prismoidal)</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Uses Prismoidal formula: V = L/6 Ã— (A1 + 4Am + A2)</p>
        <div class="form-row">
          <div class="form-group"><label>Area at Section 1 (mÂ²)</label><input id="vol-a1" type="number" step="0.01" placeholder="25.00" class="mono"></div>
          <div class="form-group"><label>Area at Midpoint (mÂ²)</label><input id="vol-am" type="number" step="0.01" placeholder="30.00" class="mono"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Area at Section 2 (mÂ²)</label><input id="vol-a2" type="number" step="0.01" placeholder="28.00" class="mono"></div>
          <div class="form-group"><label>Length Between Sections (m)</label><input id="vol-l" type="number" step="0.01" placeholder="20.00" class="mono"></div>
        </div>
        <button class="btn btn-orange btn-full" onclick="calcVolume()">Calculate Volume</button>
        <div class="result-box" id="vol-result"></div>
      </div>
    </div>

    <!-- Trig Levelling -->
    <div class="coord-pane" id="tp-trig">
      <div style="background:#f0fdfa;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ Trigonometric Levelling</h4>
        <div class="form-row">
          <div class="form-group"><label>Instrument Height (m)</label><input id="tl-hi" type="number" step="0.001" placeholder="1.500" class="mono"></div>
          <div class="form-group"><label>Target Height (m)</label><input id="tl-th" type="number" step="0.001" placeholder="1.800" class="mono"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Slope Distance (m)</label><input id="tl-sd" type="number" step="0.001" placeholder="250.000" class="mono"></div>
          <div class="form-group"><label>Vertical Angle (Â°)</label><input id="tl-va" type="number" step="0.0001" placeholder="3.5000" class="mono"></div>
        </div>
        <div class="form-group"><label>Station Elevation (m)</label><input id="tl-elev" type="number" step="0.001" placeholder="100.000" class="mono"></div>
        <button class="btn btn-green btn-full" onclick="calcTrigLevel()">Calculate Elevation</button>
        <div class="result-box" id="tl-result"></div>
      </div>
    </div>

    <!-- Map Scale -->
    <div class="coord-pane" id="tp-scale">
      <div style="background:#fef9f0;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ—ºï¸ Map Scale & Distance Converter</h4>
        <div class="form-row">
          <div class="form-group"><label>Scale Denominator (e.g. 5000 for 1:5000)</label><input id="ms-scale" type="number" placeholder="5000" class="mono" value="5000"></div>
          <div class="form-group"><label>Map Distance (mm)</label><input id="ms-map" type="number" step="0.01" placeholder="100" class="mono"></div>
        </div>
        <button class="btn btn-primary btn-full" onclick="calcMapScale()">Convert Scale</button>
        <div class="result-box" id="ms-result"></div>
      </div>
    </div>
  </div>
</div>

</main>

<!-- â•â•â• FOOTER â•â•â• -->
<footer>
  <div class="footer-inner">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3 class="display" style="font-size:1.3rem;">ğŸ¯ SurveyPro <span style="color:#4ade80;">Elite</span></h3>
        <p>Nigeria's premier professional land surveying platform. WGS84, UTM 31â€“33N, NNO/Minna datum compliant. SURCON aligned. Trusted by surveyors across all 36 states.</p>
        <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap;">
          <span class="badge badge-green">ğŸŒ¿ Eco-Certified</span>
          <span class="badge badge-blue">WGS84</span>
          <span class="badge badge-gold">SURCON Aligned</span>
          <span class="badge badge-green">PWA Ready</span>
        </div>
      </div>
      <div class="footer-links">
        <h4>Platform</h4>
        <ul>
          <li>GPS Survey Tool</li><li>Coordinate Conversion</li>
          <li>Plot Layout Generator</li><li>GIS Services</li>
          <li>C of O Verification</li><li>Reports Generator</li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>Commercial</h4>
        <ul>
          <li>Equipment Rental (50% cut)</li><li>Training Courses (50% cut)</li>
          <li>GIS Referrals (50% cut)</li><li>Pro Subscription</li>
          <li>Enterprise Plans</li><li>Contact Arnold</li>
        </ul>
      </div>
      <div class="footer-contact">
        <h4>Contact</h4>
        <p>ğŸ“ +234-811-755-4948</p>
        <p>ğŸ“§ <a href="mailto:opusarnold@gmail.com" style="color:inherit;">opusarnold@gmail.com</a></p>
        <p>ğŸ’³ Opay: 8117554948</p>
        <p>ğŸ’¬ WhatsApp: 08117554948</p>
        <p style="margin-top:10px;font-size:0.78rem;opacity:0.5;">Monâ€“Sat Â· 8AMâ€“6PM WAT</p>
      </div>
    </div>
    <div class="footer-bottom">
      Â© 2026 SurveyPro Elite Â· Arnold Opusunju Â· All Rights Reserved Â· 50% Commission Model Â· WGS84 Â· UTM 31â€“33N Â· NNO<br>
      Commercial-Ready Â· Market-Proven Â· Eco-Friendly Â· Nigeria's #1 Professional Surveying Platform
    </div>
  </div>

<!-- â•â•â• AUTH MODAL â•â•â• -->
<div class="modal-bg" id="authModal">
  <div class="modal-box" style="max-width:420px;">
    <div style="text-align:center;padding:16px 0 8px;">
      <div style="font-size:2.2rem;margin-bottom:6px;">ğŸ¯</div>
      <h2 class="display" style="font-size:1.4rem;font-weight:800;margin-bottom:4px;">SurveyPro Elite</h2>
      <p style="font-size:0.78rem;color:var(--text2);margin-bottom:14px;">Nigeria's #1 Professional Surveying Platform<br>Sign in or create a free account to get started</p>
    </div>
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchAuth('login')">Sign In</button>
      <button class="auth-tab" onclick="switchAuth('register')">Create Free Account</button>
    </div>
    
    <!-- Login -->
    <div class="auth-pane active" id="auth-login">
      <div class="form-group"><label>Email Address</label><input type="email" id="loginEmail" placeholder="your@email.com" autocomplete="email" onkeydown="if(event.key==='Enter')doLogin()"></div>
      <div class="form-group"><label>Password</label><input type="password" id="loginPwd" placeholder="Your password" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()"></div>
      <button class="btn btn-primary btn-full" onclick="doLogin()">ğŸ” Sign In</button>
      <div class="auth-divider"><span>or continue with</span></div>
      <button class="btn btn-full" style="background:#4285f4;color:#fff;" onclick="googleAuth()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Sign in with Google
      </button>
      <p style="text-align:center;font-size:0.78rem;color:var(--text3);margin-top:12px;"><a href="#" onclick="showForgotPwd()" style="color:var(--accent2);">Forgot password?</a></p>
    </div>
    
    <!-- Register -->
    <div class="auth-pane" id="auth-register">
      <div class="form-row">
        <div class="form-group"><label>First Name</label><input type="text" id="regFirst" placeholder="First name"></div>
        <div class="form-group"><label>Last Name</label><input type="text" id="regLast" placeholder="Last name"></div>
      </div>
      <div class="form-group"><label>Email</label><input type="email" id="regEmail" placeholder="your@email.com" autocomplete="email"></div>
      <div class="form-group"><label>Phone</label><input type="tel" id="regPhone" placeholder="080XXXXXXXX"></div>
      <div class="form-group"><label>Password (min 8 chars)</label><input type="password" id="regPwd" placeholder="Create password" autocomplete="new-password"></div>
      <div class="form-group"><label>Role</label>
        <select id="regRole"><option value="surveyor">Licensed Surveyor</option><option value="client">Land Owner / Client</option></select>
      </div>
      <div class="form-group" id="licenseGroup"><label>SURCON License Number</label><input type="text" id="regLicense" placeholder="SURCON/XXXX/XXXXX"></div>
      <button class="btn btn-green btn-full" onclick="doRegister()">âœ… Create Free Account</button>
      <p style="text-align:center;font-size:0.75rem;color:var(--text3);margin-top:10px;">By registering, you agree to our Terms of Service.</p>
    </div>
  </div>
</div>


<!-- â•â•â• PAYMENT MODAL â•â•â• -->
<div class="modal-bg" id="paymentModal" onclick="if(event.target===this)closePaymentModal()">
  <div class="modal-box" style="max-width:460px;">
    <h3 class="display" style="font-weight:800;margin-bottom:6px;" id="payModalTitle">ğŸ’³ Subscribe to Pro</h3>
    <p style="font-size:0.82rem;color:var(--text2);margin-bottom:20px;" id="payModalDesc">Unlock unlimited access to all professional features.</p>
    
    <div style="background:#f8fafc;border:2px solid var(--border);border-radius:10px;padding:16px;margin-bottom:16px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <span style="font-weight:600;" id="payPlanName">Professional Plan</span>
        <span class="display" style="font-size:1.5rem;font-weight:800;color:var(--accent);" id="payAmount">â‚¦5,000</span>
      </div>
      <p style="font-size:0.75rem;color:var(--text3);margin-top:4px;">Monthly subscription â€” cancel anytime</p>
    </div>
    
    <div style="margin-bottom:16px;">
      <div class="form-group"><label>Email</label><input type="email" id="payEmail" placeholder="your@email.com"></div>
      <div class="form-group"><label>Full Name</label><input type="text" id="payName" placeholder="Your full name"></div>
    </div>
    
    <!-- Payment Options -->
    <div style="display:grid;gap:8px;">
      <button class="paystack-btn" onclick="initiatePaystack()" id="paystackBtn">
        ğŸ’³ Pay with Paystack (Card / Bank Transfer / USSD)
      </button>
      <button class="btn btn-full" style="background:#008751;color:#fff;font-weight:700;padding:14px;" onclick="payViaOpay()">
        ğŸ“± Pay via Opay (Instant â€” +234 811 755 4948)
      </button>
      <button class="btn btn-full" style="background:#f8fafc;color:var(--text);border:2px solid var(--border);font-weight:700;padding:14px;" onclick="payViaBankTransfer()">
        ğŸ¦ Bank Transfer (GTBank / Access / Zenith)
      </button>
    </div>
    <p style="font-size:0.72rem;color:var(--text3);text-align:center;margin-top:10px;">All payments secured. Receipt sent via WhatsApp/Email.</p>
    
    <!-- WhatsApp manual payment -->
    <button class="btn btn-full" style="background:#25D366;color:#fff;margin-top:8px;" onclick="manualPayment()">
      ğŸ“± Pay via WhatsApp (Bank Transfer Confirmation)
    </button>
    
    <p style="text-align:center;font-size:0.74rem;color:var(--text3);margin-top:12px;">ğŸ”’ Secured by Paystack Â· 256-bit SSL Encryption Â· PCI DSS Compliant</p>
    <button class="btn btn-gray btn-full" style="margin-top:8px;font-size:0.8rem;" onclick="closePaymentModal()">Cancel</button>
  </div>
</div>

</footer>

<!-- â•â•â• OFFLINE INDICATOR â•â•â• -->
<div id="offlineBar" style="display:none;position:fixed;top:0;left:0;right:0;background:#dc2626;color:#fff;text-align:center;padding:8px;font-size:0.82rem;font-weight:600;z-index:9999;">
  ğŸ“µ Offline â€” Surveys & GPS data saved locally. All tools still work.
</div>


<!-- â•â•â• PWA INSTALL BAR â•â•â• -->
<div id="installBar" style="display:none;position:fixed;bottom:0;left:0;right:0;background:linear-gradient(135deg,#0f172a,#064e3b);color:#fff;padding:12px 20px;z-index:2000;box-shadow:0 -4px 20px rgba(0,0,0,0.3);">
  <div style="max-width:1280px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
    <div style="display:flex;align-items:center;gap:10px;">
      <span style="font-size:1.5rem;">ğŸ¯</span>
      <div><div style="font-weight:700;font-size:0.88rem;">Install SurveyPro Elite</div><div style="font-size:0.72rem;opacity:0.7;">Works offline Â· GPS surveys Â· No app store needed</div></div>
    </div>
    <div style="display:flex;gap:8px;">
      <button onclick="installApp()" style="background:#16a34a;color:#fff;border:none;padding:9px 18px;border-radius:8px;font-weight:700;cursor:pointer;font-family:inherit;">ğŸ“² Install Free</button>
      <button onclick="dismissInstall()" style="background:rgba(255,255,255,0.15);color:#fff;border:none;padding:9px 14px;border-radius:8px;cursor:pointer;">âœ•</button>
    </div>
  </div>
</div>


<script>

'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURATION â€” Update these with your real details
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CFG = {
  phone: '2348117554948',
  opay: '8117554948',
  email: 'opusarnold@gmail.com',
  name: 'Arnold Opusunju',
  business: 'SurveyPro Elite',
  whatsapp: 'https://wa.me/2348117554948',
  commission: 0.50,
  // Licensed partner sites â€” 50% of payment goes to them, 50% to you
  gisPartner: 'https://www.esri.com/en-us/arcgis/products/index',        // Licensed GIS provider
  equipPartner: 'https://www.teknet.com.ng',                             // Licensed equipment rental (Nigeria)
  trainPartner: 'https://www.coursera.org/browse/information-technology', // Online learning partner
  trainPartnerAlt: 'https://qgis.org/en/site/forusers/trainingmaterial/index.html', // Free GIS training
  paystack_key: 'pk_live_YOUR_PAYSTACK_KEY_HERE',  // â† Get from dashboard.paystack.com â†’ Settings â†’ API Keys
  bankName: 'GTBank (Guaranty Trust)',            // â† Your bank name
  bankAccount: '0123456789',                       // â† Your real GTBank account number
  bankAccountName: 'Arnold Opusunju'               // â† Your legal name as on account
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let gpsPos = null, watchId = null;
let surveyPts = [];
let surveys = [];
let plotPts = [];
let darkMode = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COURSE & EQUIPMENT DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COURSES = [
  {id:'gis',name:'Advanced GIS Mapping',price:25000,dur:'12 hrs',level:'Beginner',desc:'Master QGIS and ArcGIS for professional surveying workflows. Map projections, attribute tables, spatial analysis.',platform:'QGIS Academy'},
  {id:'drone',name:'Drone Surveying & Photogrammetry',price:45000,dur:'16 hrs',level:'Intermediate',desc:'Aerial mapping, LiDAR techniques, 3D point cloud processing, orthophoto generation with Pix4D.',platform:'Pix4D Academy'},
  {id:'ai',name:'AI in Land Surveying',price:35000,dur:'10 hrs',level:'Advanced',desc:'Machine learning for automated feature extraction, classification, predictive land analysis.',platform:'Coursera'},
  {id:'rtk',name:'RTK/GNSS Fundamentals',price:20000,dur:'8 hrs',level:'Beginner',desc:'High-precision GPS techniques for cadastral and engineering surveys. Network RTK, CORS stations.',platform:'Trimble Academy'},
  {id:'autocad',name:'AutoCAD Civil 3D for Surveyors',price:30000,dur:'14 hrs',level:'Intermediate',desc:'Drawing, annotation, surface modelling, corridors, alignments and professional survey deliverables.',platform:'Autodesk'},
  {id:'total',name:'Total Station Operations',price:18000,dur:'6 hrs',level:'Beginner',desc:'Field setup, traversing, stakeout, EDM ranging, and digital data management with Leica.',platform:'Leica Academy'},
  {id:'cofo',name:'C of O Processing & Land Law',price:40000,dur:'10 hrs',level:'Intermediate',desc:'Land Use Act, state land laws, C of O application process, due diligence, title verification.',platform:'NIESV'},
  {id:'remote',name:'Remote Sensing Fundamentals',price:22000,dur:'9 hrs',level:'Beginner',desc:'NDVI, SAR, multispectral analysis, Sentinel/Landsat data processing, land cover mapping.',platform:'ESA EO Campus'}
];

const EQUIPMENT = [
  {icon:'ğŸ¯',name:'Total Station',model:'Leica TS16 / TS06',price:20000,desc:'High-precision 2" electronic theodolite with integrated EDM, Bluetooth and onboard memory storage.',features:['2" angular accuracy','3km EDM range','Bluetooth data transfer','Includes tripod & prism set'],link:'https://leica-geosystems.com'},
  {icon:'ğŸ“¡',name:'RTK GNSS Receiver',model:'Trimble R10 / R12i',price:20000,desc:'Multi-constellation RTK GNSS with centimetre-level accuracy, integrated UHF modem and cloud sync.',features:['8mm RTK accuracy','All-constellation GNSS','UHF radio integrated','Real-time cloud sync'],link:'https://trimble.com'},
  {icon:'ğŸš',name:'Survey Drone',model:'DJI Phantom 4 RTK',price:25000,desc:'Professional aerial mapping drone with RTK, 20MP camera, and Pix4D photogrammetry suite.',features:['RTK cm-level accuracy','20MP sensor','Includes Pix4D licence','45-min flight time'],link:'https://dji.com'},
  {icon:'ğŸ“',name:'Digital Level',model:'Leica DNA03',price:8000,desc:'High-precision digital auto-level for precise elevation and height difference measurements.',features:['0.3mm/km accuracy','Auto bar-code reading','2000-point internal memory','With invar staff included'],link:'https://leica-geosystems.com'},
  {icon:'âš¡',name:'3D Laser Scanner',model:'Leica RTC360',price:30000,desc:'Ultra-fast 3D reality capture scanner for BIM, heritage documentation, and infrastructure surveys.',features:['2M points/sec','360Â° full-sphere capture','HDR panoramic imaging','Auto-register in field'],link:'https://leica-geosystems.com'},
  {icon:'ğŸ”­',name:'Electronic Theodolite',model:'Topcon DT-209L',price:6000,desc:'Professional 9" electronic theodolite with dual-axis compensation and digital display readout.',features:['9" angular accuracy','Dual-axis compensation','Backlit digital display','IP54 waterproof'],link:'https://topcon.com'},
  {icon:'ğŸŒ',name:'Handheld GPS',model:'Garmin GPSMAP 66st',price:3000,desc:'Rugged multi-constellation handheld GPS for field navigation, waypoint collection, and area estimation.',features:['3â€“5m accuracy','All-weather IPX7','100,000-point capacity','Topo maps pre-loaded'],link:'https://garmin.com'},
  {icon:'ğŸ“Œ',name:'Ground Penetrating Radar',model:'GSSI SIR 4000',price:50000,desc:'Professional GPR for subsurface utility mapping, void detection, rebar location, and buried pipe surveys.',features:['Multi-frequency antennas','Real-time 3D display','GPS integration','IQBS target ID'],link:'https://geophysical.com'}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  loadSurveys();
  buildEquipment();
  buildCourses();
  updateHistory();
  updateReportDropdown();
  initPlotCanvas();
  AUTH.init();
  initJobBoard();
  initDirectory();
  // Check for thanks param (Formspree redirect)
  const urlP = new URLSearchParams(window.location.search);
  if(urlP.get('thanks')==='1') showBanner('âœ… Message sent! We\'ll reply within 24 hours.');
  // Restore dark mode
  try { if(localStorage.getItem('sp_dark')==='1'){darkMode=true;document.body.classList.add('dark');if(g('darkBtn'))g('darkBtn').textContent='â˜€ï¸ Light';} } catch(e){}
  // PWA install prompt
  setTimeout(()=>{
    const ib=document.getElementById('installBar');
    if(ib&&deferredInstallPrompt) ib.style.display='flex';
  }, 4000);

  // â”€â”€ LOGIN WALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // If user is not logged in, always show the auth modal and keep them on home
  setTimeout(() => {
    if(!AUTH.isLoggedIn()) {
      // Make sure home tab is shown
      document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(el=>el.classList.remove('active'));
      const homeTab=document.getElementById('tab-home');
      const homeBtn=document.getElementById('nb-home');
      if(homeTab) homeTab.classList.add('active');
      if(homeBtn) homeBtn.classList.add('active');
      // Show auth modal
      const modal=document.getElementById('authModal');
      if(modal){ modal.style.display='flex'; modal.style.opacity='1'; }
    }
  }, 500);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COORDINATE MODE TOGGLES (Northing/Easting â†” Lat/Lon)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _manMode = 'ne';
function setManualMode(mode) {
  _manMode = mode;
  var isNE = mode==='ne';
  var l1=document.getElementById('manField1Lbl');
  var l2=document.getElementById('manField2Lbl');
  var f1=document.getElementById('manualN');
  var f2=document.getElementById('manualE');
  var b1=document.getElementById('manModeNE');
  var b2=document.getElementById('manModeLL');
  if(!l1||!l2||!f1||!f2) return;
  if(isNE){
    l1.textContent='Northing (m)'; l2.textContent='Easting (m)';
    f1.placeholder='857881.968'; f2.placeholder='707032.831';
    f1.step='0.001'; f2.step='0.001';
    if(b1){b1.style.background='var(--accent)';b1.style.color='#fff';}
    if(b2){b2.style.background='var(--border)';b2.style.color='var(--text)';}
  } else {
    l1.textContent='Latitude (Â°)'; l2.textContent='Longitude (Â°)';
    f1.placeholder='7.7577114'; f2.placeholder='4.5388769';
    f1.step='0.0000001'; f2.step='0.0000001';
    if(b1){b1.style.background='var(--border)';b1.style.color='var(--text)';}
    if(b2){b2.style.background='var(--accent)';b2.style.color='#fff';}
  }
  f1.value=''; f2.value='';
}
var _plotMode = 'latlon';
function setPlotMode(mode) {
  _plotMode = mode;
  var isNE = mode==='ne';
  var l1=document.getElementById('plotField1Lbl');
  var l2=document.getElementById('plotField2Lbl');
  var f1=document.getElementById('plotLat');
  var f2=document.getElementById('plotLon');
  var b1=document.getElementById('plotModeLatLon');
  var b2=document.getElementById('plotModeNE');
  if(!l1||!l2||!f1||!f2) return;
  if(isNE){
    l1.textContent='Start Northing (m)'; l2.textContent='Start Easting (m)';
    f1.placeholder='857881.968'; f2.placeholder='707032.831';
    f1.step='0.001'; f2.step='0.001';
    if(b1){b1.style.background='var(--border)';b1.style.color='var(--text)';}
    if(b2){b2.style.background='var(--accent)';b2.style.color='#fff';}
  } else {
    l1.textContent='Start Latitude (Â°)'; l2.textContent='Start Longitude (Â°)';
    f1.placeholder='7.75771146'; f2.placeholder='4.53887695';
    f1.step='0.0000001'; f2.step='0.0000001';
    if(b1){b1.style.background='var(--accent)';b1.style.color='#fff';}
    if(b2){b2.style.background='var(--border)';b2.style.color='var(--text)';}
  }
  f1.value=''; f2.value='';
}
// UTM N/E â†’ Lat/Lon (Nigeria zones 31-33)
function neToLatLon(northing, easting, zone) {
  zone = zone||32;
  var k0=0.9996,a=6378137,e2=0.00669438;
  var x=easting-500000,y=northing;
  var M=y/k0;
  var e1=(1-Math.sqrt(1-e2))/(1+Math.sqrt(1-e2));
  var mu=M/(a*(1-e2/4-3*e2*e2/64-5*e2*e2*e2/256));
  var phi1=mu+(3*e1/2-27*e1*e1*e1/32)*Math.sin(2*mu)+(21*e1*e1/16)*Math.sin(4*mu);
  var N1=a/Math.sqrt(1-e2*Math.pow(Math.sin(phi1),2));
  var T1=Math.pow(Math.tan(phi1),2);
  var C1=e2/(1-e2)*Math.pow(Math.cos(phi1),2);
  var R1=a*(1-e2)/Math.pow(1-e2*Math.pow(Math.sin(phi1),2),1.5);
  var D=x/(N1*k0);
  var lat=phi1-(N1*Math.tan(phi1)/R1)*(D*D/2-(5+3*T1+10*C1)*D*D*D*D/24);
  var lon0=((zone-1)*6-180+3)*Math.PI/180;
  var lon=lon0+(D-(1+2*T1+C1)*D*D*D/6)/Math.cos(phi1);
  return {lat:lat*180/Math.PI, lon:lon*180/Math.PI};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS â€” with login wall enforcement
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PUBLIC_TABS = ['home','pricing','contact'];
function showTab(t) {
  // Protect all tabs except public ones
  if(!PUBLIC_TABS.includes(t) && !AUTH.isLoggedIn()) {
    const modal=document.getElementById('authModal');
    if(modal){ modal.style.display='flex'; modal.style.opacity='1'; }
    toast('ğŸ” Please sign in or create a free account to continue','warning');
    return;
  }
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
  const tc = document.getElementById('tab-' + t);
  if(tc) tc.classList.add('active');
  const nb = document.getElementById('nb-' + t);
  if(nb) nb.classList.add('active');
  if(t === 'plot') setTimeout(initPlotCanvas, 100);
  if(t === 'history') updateHistory();
  if(t === 'reports') updateReportDropdown();
  window.scrollTo({top:0,behavior:'smooth'});
  try { history.replaceState(null,'','?tab='+t); } catch(e){}
}

function showCoord(c) {
  document.querySelectorAll('.coord-pane').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.sub-tab').forEach(el => el.classList.remove('active'));
  const cp = document.getElementById('cp-' + c);
  if(cp) cp.classList.add('active');
  const ct = document.getElementById('ct-' + c);
  if(ct) ct.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enableGPS() {
  if(!navigator.geolocation){toast('GPS not supported by this browser','error');return;}
  const box = g('gpsInfoBox');
  box.innerHTML = '<p style="color:var(--accent2);">ğŸ”„ Acquiring GPS signal... Please wait and remain outdoors with clear sky.</p>';
  watchId = navigator.geolocation.watchPosition(pos => {
    gpsPos = pos.coords;
    const acc = pos.coords.accuracy;
    const accClass = acc < 5 ? 'color:#16a34a' : acc < 15 ? 'color:#d97706' : 'color:#dc2626';
    const accTxt = acc < 5 ? 'ğŸŸ¢ High' : acc < 15 ? 'ğŸŸ¡ Medium' : 'ğŸ”´ Low';
    box.innerHTML = `<p style="font-weight:700;color:var(--accent);margin-bottom:8px;">âœ… GPS Active â€” ${accTxt} Accuracy</p>`;
    g('gpsInfoGrid').style.display = 'grid';
    g('gpsInfoGrid').innerHTML = `
      <div class="gps-info-item"><div class="label">LATITUDE</div><div class="val">${pos.coords.latitude.toFixed(7)}Â°</div></div>
      <div class="gps-info-item"><div class="label">LONGITUDE</div><div class="val">${pos.coords.longitude.toFixed(7)}Â°</div></div>
      <div class="gps-info-item"><div class="label">ACCURACY</div><div class="val" style="${accClass}">Â±${acc.toFixed(1)} m</div></div>
      <div class="gps-info-item"><div class="label">ALTITUDE</div><div class="val">${(pos.coords.altitude||0).toFixed(1)} m</div></div>
      <div class="gps-info-item"><div class="label">SPEED</div><div class="val">${(pos.coords.speed||0).toFixed(2)} m/s</div></div>
      <div class="gps-info-item"><div class="label">HEADING</div><div class="val">${pos.coords.heading ? pos.coords.heading.toFixed(1)+'Â°' : 'N/A'}</div></div>`;
    g('gpsDot').className = 'gps-dot active';
    g('gpsLabel').textContent = `GPS Â±${acc.toFixed(0)}m`;
  }, err => {
    toast('GPS error: ' + err.message, 'error');
    g('gpsDot').className = 'gps-dot';
    g('gpsLabel').textContent = 'GPS Error';
    box.innerHTML = `<p style="color:var(--danger);">âŒ GPS Error: ${err.message}. Check permissions.</p>`;
  }, {enableHighAccuracy:true, maximumAge:500, timeout:15000});
}

function stopGPS() {
  if(watchId !== null){navigator.geolocation.clearWatch(watchId);watchId=null;}
  g('gpsDot').className = 'gps-dot';
  g('gpsLabel').textContent = 'GPS Off';
  g('gpsInfoGrid').style.display = 'none';
  g('gpsInfoBox').innerHTML = '<p style="color:var(--text2);font-size:0.85rem;">GPS stopped. Click Enable GPS to restart.</p>';
  toast('GPS stopped','info');
}

function getCurrentLocationInfo() {
  if(!navigator.geolocation){
    openModal(`<div style="text-align:center;padding:20px;">
      <div style="font-size:3rem;margin-bottom:12px;">ğŸ“µ</div>
      <h3 style="font-weight:800;margin-bottom:8px;">GPS Not Available</h3>
      <p style="font-size:0.85rem;color:var(--text2);">Your browser or device does not support GPS/Geolocation. Try using Chrome or Firefox on a mobile device.</p>
      <button class="btn btn-primary btn-full" style="margin-top:16px;" onclick="closeModal()">OK</button>
    </div>`);
    return;
  }
  // Show loading state
  openModal(`<div style="text-align:center;padding:30px 20px;">
    <div style="font-size:3rem;margin-bottom:16px;">ğŸ›°ï¸</div>
    <h3 style="font-weight:700;margin-bottom:8px;">Getting Your Location...</h3>
    <p style="font-size:0.82rem;color:var(--text2);">Please wait. Allow location access if prompted.</p>
    <div style="margin-top:16px;height:4px;background:#e2e8f0;border-radius:2px;overflow:hidden;">
      <div style="height:100%;width:60%;background:var(--accent);border-radius:2px;animation:progress 2s infinite;"></div>
    </div>
  </div>`);

  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const acc = pos.coords.accuracy;
      const alt = pos.coords.altitude || 0;
      const utm = latLonToUTM(lat, lon);
      const accColor = acc<10 ? '#16a34a' : acc<30 ? '#d97706' : '#dc2626';
      const accLabel = acc<10 ? 'ğŸŸ¢ High Precision' : acc<30 ? 'ğŸŸ¡ Medium' : 'ğŸ”´ Low â€” move outdoors';

      openModal(`<div>
        <h3 style="font-weight:800;font-size:1.1rem;margin-bottom:16px;text-align:center;">ğŸ“ Your Current Location</h3>

        <div style="display:grid;gap:10px;font-size:0.84rem;margin-bottom:16px;">
          <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:14px;">
            <div style="font-size:0.7rem;font-weight:800;color:var(--text3);letter-spacing:1px;margin-bottom:6px;">LATITUDE / LONGITUDE (WGS84)</div>
            <div class="mono" style="font-size:1rem;font-weight:700;">${lat.toFixed(7)}Â°N &nbsp; ${lon.toFixed(7)}Â°E</div>
          </div>
          <div style="background:#eff6ff;border:2px solid #bfdbfe;border-radius:10px;padding:14px;">
            <div style="font-size:0.7rem;font-weight:800;color:var(--text3);letter-spacing:1px;margin-bottom:6px;">UTM ZONE ${utm.zone}N (NORTHING / EASTING)</div>
            <div class="mono" style="font-size:1rem;font-weight:700;">N: ${utm.northing.toFixed(3)} &nbsp;|&nbsp; E: ${utm.easting.toFixed(3)}</div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div style="background:#f8fafc;border-radius:8px;padding:10px;text-align:center;">
              <div style="font-size:0.7rem;color:var(--text3);margin-bottom:3px;">ACCURACY</div>
              <div style="font-weight:700;color:${accColor};">Â±${acc.toFixed(1)}m</div>
              <div style="font-size:0.72rem;color:${accColor};">${accLabel}</div>
            </div>
            <div style="background:#f8fafc;border-radius:8px;padding:10px;text-align:center;">
              <div style="font-size:0.7rem;color:var(--text3);margin-bottom:3px;">ALTITUDE</div>
              <div style="font-weight:700;">${alt.toFixed(1)}m</div>
            </div>
          </div>
        </div>

        <p style="font-size:0.78rem;color:var(--text2);margin-bottom:10px;font-weight:600;">Use this location in:</p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
          <button class="btn btn-green" onclick="
            const utm=latLonToUTM(${lat},${lon});
            const manN=document.getElementById('manualN');
            const manE=document.getElementById('manualE');
            if(manN){manN.value=utm.northing.toFixed(3);}
            if(manE){manE.value=utm.easting.toFixed(3);}
            const manElev=document.getElementById('manualElev');
            if(manElev){manElev.value='${alt.toFixed(3)}';}
            closeModal();
            showTab('survey');
            toast('Location loaded into Manual Point â†’ Northing &amp; Easting filled!','success');
          ">ğŸ“¡ Survey Tool<br><small>Fills N/E</small></button>
          <button class="btn btn-blue" onclick="
            const pl=document.getElementById('plotLat');
            const plo=document.getElementById('plotLon');
            if(pl){pl.value='${lat}';}
            if(plo){plo.value='${lon}';}
            closeModal();
            showTab('plot');
            toast('Location loaded into Plot Layout!','success');
          ">ğŸ“ Plot Layout<br><small>Fills Lat/Lon</small></button>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
          <button class="btn btn-primary" onclick="
            const coords='${lat.toFixed(7)}, ${lon.toFixed(7)}';
            if(navigator.clipboard){navigator.clipboard.writeText(coords).then(()=>toast('Lat/Lon copied to clipboard!','success'));}
            closeModal();
          ">ğŸ“‹ Copy Lat/Lon</button>
          <button class="btn btn-gray" onclick="closeModal()">Close</button>
        </div>
      </div>`);
    },
    err => {
      let hint = '';
      if(err.code===1) hint='Go to your browser Settings â†’ Site permissions â†’ Location â†’ Allow this site.';
      else if(err.code===2) hint='Move to an open area or enable Wi-Fi to help locate your position.';
      else hint='The request timed out. Tap "My Location" again.';
      openModal(`<div style="text-align:center;padding:10px;">
        <div style="font-size:3rem;margin-bottom:12px;">âš ï¸</div>
        <h3 style="font-weight:800;color:var(--danger);margin-bottom:8px;">Location Error</h3>
        <p style="font-size:0.85rem;color:var(--text2);margin-bottom:8px;">${err.message}</p>
        <p style="font-size:0.82rem;color:var(--accent2);background:#eff6ff;padding:10px;border-radius:8px;text-align:left;">${hint}</p>
        <button class="btn btn-primary btn-full" style="margin-top:14px;" onclick="closeModal()">OK</button>
      </div>`);
    },
    {enableHighAccuracy:true, timeout:20000, maximumAge:0}
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SURVEY POINTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addGPSPoint() {
  if(!gpsPos){toast('Enable GPS first','warning');return;}
  const utm = latLonToUTM(gpsPos.latitude, gpsPos.longitude);
  surveyPts.push({
    id:surveyPts.length+1, lat:gpsPos.latitude, lon:gpsPos.longitude,
    n:utm.northing, e:utm.easting, elev:gpsPos.altitude||0,
    acc:gpsPos.accuracy, src:'GPS',
    desc:'GPS Point '+(surveyPts.length+1), ts:new Date().toISOString()
  });
  updateSurveyDisplay();
  toast(`GPS Point ${surveyPts.length} added (Â±${gpsPos.accuracy.toFixed(1)}m)`,'success');
}

function addManualPointToggle() {
  g('manualBox').classList.toggle('open');
}

function confirmManualPoint() {
  const val1=parseFloat(g('manualN').value), val2=parseFloat(g('manualE').value);
  const elev=parseFloat(g('manualElev').value)||0;
  const desc=g('manualDesc').value.trim()||('Point '+(surveyPts.length+1));
  if(isNaN(val1)||isNaN(val2)){
    toast('Enter valid coordinates in both fields','warning');
    g('manualN').focus();
    return;
  }
  var n, e, lat=0, lon=0;
  if(typeof _manMode !=='undefined' && _manMode==='latlon'){
    // Lat/Lon mode â€” convert to UTM
    lat=val1; lon=val2;
    if(lat<3||lat>14||lon<2||lon>15){toast('Coordinates look outside Nigeria. Check values.','warning');return;}
    const utm=latLonToUTM(lat,lon);
    n=utm.northing; e=utm.easting;
  } else {
    // Northing/Easting mode (default)
    n=val1; e=val2;
    if(n<500000||n>1500000){toast('Northing looks unusual for Nigeria. Expected ~800,000â€“1,200,000m','warning');}
    if(e<100000||e>900000){toast('Easting looks unusual. Expected ~200,000â€“700,000m','warning');}
  }
  surveyPts.push({id:surveyPts.length+1,n,e,elev,lat,lon,src:'Manual',desc,ts:new Date().toISOString()});
  g('manualN').value=''; g('manualE').value=''; g('manualElev').value=''; g('manualDesc').value='';
  g('manualBox').classList.remove('open');
  updateSurveyDisplay();
  toast(`âœ… Manual Point ${surveyPts.length} added (${typeof _manMode!=='undefined'&&_manMode==='latlon'?'Lat/Lon converted to N/E':'Northing/Easting'})`,'success');
}

function undoPoint() {
  if(surveyPts.length===0){toast('No points to undo','warning');return;}
  const removed=surveyPts.pop();
  updateSurveyDisplay();
  toast(`Point ${removed.id} removed`,'info');
}

function clearSurvey() {
  if(surveyPts.length===0)return;
  if(!confirm('Clear all survey points? This cannot be undone.'))return;
  surveyPts=[];
  updateSurveyDisplay();
  toast('Survey cleared','info');
}

function importCSVPoints() {
  const input=document.createElement('input');
  input.type='file';input.accept='.csv,.txt';
  input.onchange=e=>{
    const file=e.target.files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=ev=>{
      const lines=ev.target.result.split('\n').filter(l=>l.trim());
      let added=0;
      lines.forEach(line=>{
        const parts=line.split(/[,\t]/);
        if(parts.length>=2){
          const n=parseFloat(parts[0]),e=parseFloat(parts[1]),el=parseFloat(parts[2])||0;
          const desc=parts[3]?parts[3].trim():`CSV-${surveyPts.length+1}`;
          if(!isNaN(n)&&!isNaN(e)){
            surveyPts.push({id:surveyPts.length+1,n,e,elev:el,lat:0,lon:0,src:'CSV',desc,ts:new Date().toISOString()});
            added++;
          }
        }
      });
      updateSurveyDisplay();
      toast(`${added} points imported from CSV`,'success');
    };
    reader.readAsText(file);
  };
  input.click();
}

function updateSurveyDisplay() {
  const n=surveyPts.length;
  g('ptCount').textContent=n;
  let ha=0,ac=0,perim=0,sqm=0;
  if(n>=3){sqm=shoelace(surveyPts);ha=sqm/10000;ac=ha*2.47105;perim=calcPerimeter(surveyPts);}
  g('areaHa').textContent=ha.toFixed(4);
  g('areaAc').textContent=ac.toFixed(4);
  g('areaSqm').textContent=sqm.toFixed(0);
  g('plotsCount').textContent=(ha*10000/1500).toFixed(1);
  g('perim').textContent=perim.toFixed(2);
  if(n>=2){
    const p1=surveyPts[n-2],p2=surveyPts[n-1];
    const dn=p2.n-p1.n,de=p2.e-p1.e;
    const dist=Math.sqrt(dn*dn+de*de);
    const bear=((Math.atan2(de,dn)*180/Math.PI)+360)%360;
    g('bearingInfo').textContent=`Bearing: ${bear.toFixed(4)}Â° Â· Dist: ${dist.toFixed(3)}m`;
  } else {g('bearingInfo').textContent='â€”';}
  if(n===0){g('pointsTableWrap').innerHTML='';return;}
  let html=`<table class="data-table"><thead><tr><th>Pt</th><th>Description</th><th>Northing (m)</th><th>Easting (m)</th><th>Elevation (m)</th><th>Src</th><th>Acc</th></tr></thead><tbody>`;
  surveyPts.forEach(p=>{
    html+=`<tr><td style="text-align:center;font-weight:700;">${p.id}</td><td>${p.desc||''}</td><td class="mono">${p.n.toFixed(3)}</td><td class="mono">${p.e.toFixed(3)}</td><td class="mono">${p.elev.toFixed(3)}</td><td style="text-align:center;">${p.src}</td><td style="text-align:center;">${p.acc?'Â±'+p.acc.toFixed(1)+'m':'â€”'}</td></tr>`;
  });
  html+='</tbody></table>';
  g('pointsTableWrap').innerHTML=html;
}

function completeSurvey() {
  const cN=v('clientName'),cP=v('clientPhone'),pN=v('projectName'),loc=v('location');
  if(!cN||!cP||!pN||!loc){toast('Fill all required client fields (*)','warning');return;}
  if(surveyPts.length<3){toast('Need at least 3 survey points','warning');return;}
  const sqm=shoelace(surveyPts),ha=sqm/10000,ac=ha*2.47105,perim=calcPerimeter(surveyPts);
  const code='NGS-'+Math.random().toString(36).substr(2,8).toUpperCase();
  const survey={
    id:Date.now(),clientName:cN,clientPhone:cP,clientEmail:v('clientEmail'),
    clientNIN:v('clientNIN'),projectName:pN,location:loc,fileNumber:v('fileNumber'),
    surveyType:v('surveyType'),hectares:ha,acres:ac,sqm,perimeter:perim,
    plots:ha*10000/1500,points:surveyPts.length,verificationCode:code,
    savedAt:new Date().toISOString(),coordSystem:v('coordSys'),
    hDatum:v('hDatum'),vDatum:v('vDatum'),notes:v('surveyNotes'),
    pts:JSON.parse(JSON.stringify(surveyPts)),surveyor:CFG.name
  };
  surveys.push(survey);
  saveSurveys();
  updateHistory();
  updateReportDropdown();
  openModal(`<div style="text-align:center;">
    <div style="font-size:4rem;margin-bottom:10px;">âœ…</div>
    <h3 style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.4rem;font-weight:800;color:var(--accent);margin-bottom:16px;">Survey Complete!</h3>
    <div style="background:#f0fdf4;border:2px dashed var(--accent);border-radius:12px;padding:20px;margin-bottom:18px;">
      <div style="font-size:0.75rem;color:var(--text3);margin-bottom:4px;">VERIFICATION CODE</div>
      <div style="font-family:var(--ff-mono,'JetBrains Mono','Courier New',monospace);font-size:1.6rem;font-weight:700;color:var(--accent);letter-spacing:0.1em;">${code}</div>
      <div style="font-size:0.72rem;color:var(--text3);margin-top:4px;">${v('coordSys')}</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
      <div style="background:#f0fdf4;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Hectares</div><div style="font-size:1.4rem;font-weight:800;color:var(--accent);">${ha.toFixed(4)}</div></div>
      <div style="background:#eff6ff;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Acres</div><div style="font-size:1.4rem;font-weight:800;color:var(--accent2);">${ac.toFixed(4)}</div></div>
      <div style="background:#f8fafc;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Sq Metres</div><div style="font-size:1.2rem;font-weight:800;">${sqm.toFixed(2)}</div></div>
      <div style="background:#fffbeb;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Perimeter (m)</div><div style="font-size:1.2rem;font-weight:800;">${perim.toFixed(2)}</div></div>
    </div>
    <div style="background:#f8fafc;border-radius:10px;padding:12px;text-align:left;font-size:0.82rem;margin-bottom:16px;">
      <div><strong>Client:</strong> ${cN} Â· ${cP}</div>
      <div><strong>Project:</strong> ${pN} Â· ${loc}</div>
      <div><strong>Points:</strong> ${surveyPts.length} Â· Type: ${v('surveyType')}</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <button class="btn btn-green" onclick="closeModal()">Done âœ“</button>
      <button class="btn btn-blue" onclick="closeModal();showTab('history')">View History</button>
    </div>
  </div>`);
  surveyPts=[];
  updateSurveyDisplay();
}

function emailSurvey() {
  const email=v('clientEmail');
  if(!email){toast('Enter client email first','warning');return;}
  const body=`SURVEY REPORT\n\nProject: ${v('projectName')}\nLocation: ${v('location')}\nClient: ${v('clientName')}\nPhone: ${v('clientPhone')}\n\nPoints: ${surveyPts.length}\nSurveyor: ${CFG.name}\nContact: ${CFG.email} Â· +234-811-755-4948\n\nâ€” SurveyPro Elite`;
  window.location.href=`mailto:${email}?subject=Survey Report - ${v('projectName')}&body=${encodeURIComponent(body)}`;
}

function whatsappSurvey() {
  const n=surveyPts.length;
  let ha=0,ac=0;
  if(n>=3){const sqm=shoelace(surveyPts);ha=sqm/10000;ac=ha*2.47105;}
  const msg=`ğŸ“Š *SURVEY REPORT â€” SurveyPro Elite*\n\n*Project:* ${v('projectName')||'N/A'}\n*Client:* ${v('clientName')||'N/A'}\n*Location:* ${v('location')||'N/A'}\n*Points:* ${n}\n*Area:* ${ha.toFixed(4)} ha / ${ac.toFixed(4)} acres\n\n*Surveyor:* ${CFG.name}\nğŸ“§ ${CFG.email}\nğŸ“ +234-811-755-4948`;
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
}

function printSurvey() {
  const pN=v('projectName')||'Survey Project';
  const n=surveyPts.length;
  let ha=0,ac=0,sqm=0,perim=0;
  if(n>=3){sqm=shoelace(surveyPts);ha=sqm/10000;ac=ha*2.47105;perim=calcPerimeter(surveyPts);}
  let tableRows=surveyPts.map(p=>`<tr><td>${p.id}</td><td>${p.desc||''}</td><td>${p.n.toFixed(3)}</td><td>${p.e.toFixed(3)}</td><td>${p.elev.toFixed(3)}</td><td>${p.src}</td></tr>`).join('');
  const html=`<!DOCTYPE html><html><head><title>Survey Report â€” ${pN}</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:30px auto;padding:20px;color:#111;}h1{font-size:1.4rem;text-align:center;}table{width:100%;border-collapse:collapse;margin-top:14px;}th,td{border:1px solid #ccc;padding:6px 10px;font-size:0.82rem;}th{background:#0f172a;color:#fff;}.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0;}.stat{background:#f8fafc;border:1px solid #e2e8f0;padding:10px;border-radius:6px;text-align:center;}.sl{font-size:0.72rem;color:#666;}.sv{font-weight:700;font-size:1.2rem;}header{text-align:center;border-bottom:2px solid #0f172a;padding-bottom:14px;margin-bottom:18px;}</style><style>
/* â•â• RENDER GUARD: page NEVER blank â•â• */
html,body{opacity:1!important;visibility:visible!important;display:block!important;}
</style>
</head><body>
  <header><h1>SURVEY REPORT</h1><p>SurveyPro Elite | ${CFG.name} | ${new Date().toLocaleDateString('en-NG')}</p></header>
  <p><strong>Project:</strong> ${pN} | <strong>Location:</strong> ${v('location')}</p>
  <p><strong>Client:</strong> ${v('clientName')} | <strong>Phone:</strong> ${v('clientPhone')} | <strong>Type:</strong> ${v('surveyType')}</p>
  <p><strong>System:</strong> ${v('coordSys')} | <strong>Datum:</strong> ${v('hDatum')}</p>
  <div class="grid">
    <div class="stat"><div class="sl">HECTARES</div><div class="sv">${ha.toFixed(4)}</div></div>
    <div class="stat"><div class="sl">ACRES</div><div class="sv">${ac.toFixed(4)}</div></div>
    <div class="stat"><div class="sl">SQ METRES</div><div class="sv">${sqm.toFixed(2)}</div></div>
    <div class="stat"><div class="sl">PERIMETER (m)</div><div class="sv">${perim.toFixed(2)}</div></div>
  </div>
  <table><thead><tr><th>Pt</th><th>Description</th><th>Northing (m)</th><th>Easting (m)</th><th>Elevation (m)</th><th>Source</th></tr></thead><tbody>${tableRows}</tbody></table>
  <p style="margin-top:20px;font-size:0.75rem;color:#888;">Generated by SurveyPro Elite Â· ${CFG.email} Â· +234-811-755-4948 Â· Eco-Certified Digital Platform</p>
  <script>window.print();<\/script></body></html>`;
  const w=window.open('','_blank');
  if(w){w.document.write(html);w.document.close();}
}

function exportSurveyJSON() {
  const data={surveyPts,clientName:v('clientName'),projectName:v('projectName'),location:v('location'),exportedAt:new Date().toISOString(),platform:'SurveyPro Elite v2.0'};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`survey-${Date.now()}.json`;a.click();
  toast('Survey exported as JSON','success');
}

function generateQR() {
  const n=surveyPts.length;
  if(n<3){toast('Complete survey first (need 3+ points)','warning');return;}
  const ha=(shoelace(surveyPts)/10000).toFixed(4);
  const text=`SurveyPro Elite\nProject: ${v('projectName')}\nClient: ${v('clientName')}\nArea: ${ha} ha\nDate: ${new Date().toLocaleDateString('en-NG')}`;
  openModal(`<div style="text-align:center;">
    <h3 style="font-weight:700;margin-bottom:14px;">ğŸ“± Survey QR Code</h3>
    <div id="qrMod" style="display:inline-block;"></div>
    <p style="font-size:0.8rem;color:var(--text2);margin-top:12px;">Scan to view survey summary</p>
    <button class="btn btn-gray btn-full" style="margin-top:14px;" onclick="closeModal()">Close</button>
  </div>`);
  setTimeout(()=>{
    if(window.QRCode) new QRCode(document.getElementById('qrMod'),{text,width:200,height:200});
    else document.getElementById('qrMod').textContent='QR library loading...';
  },200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COORDINATE CONVERSIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function latLonToUTM(lat, lon, forceZone) {
  const zone=forceZone||(Math.floor((lon+180)/6)+1);
  const k0=0.9996,a=6378137.0,e=0.081819191;
  const latR=lat*Math.PI/180;
  const lonO=(zone-1)*6-180+3;
  const lonR=(lon-lonO)*Math.PI/180;
  const N=a/Math.sqrt(1-e*e*Math.sin(latR)**2);
  const T=Math.tan(latR)**2;
  const C=(e*e/(1-e*e))*Math.cos(latR)**2;
  const A=lonR*Math.cos(latR);
  const M=a*((1-e*e/4-3*e**4/64)*latR-(3*e*e/8+3*e**4/32)*Math.sin(2*latR)+(15*e**4/256)*Math.sin(4*latR));
  const easting=k0*N*(A+(1-T+C)*A**3/6+(5-18*T+T*T+72*C)*A**5/120)+500000;
  const northing=k0*(M+N*Math.tan(latR)*(A*A/2+(5-T+9*C+4*C*C)*A**4/24+(61-58*T+T*T)*A**6/720));
  return {zone,easting,northing};
}

function convLatToUTM() {
  const lat=parseFloat(g('ll-lat').value),lon=parseFloat(g('ll-lon').value);
  const forceZone=parseInt(g('ll-zone').value)||null;
  if(isNaN(lat)||isNaN(lon)){toast('Enter valid lat/lon values','warning');return;}
  if(Math.abs(lat)>90||Math.abs(lon)>180){toast('Coordinates out of range','error');return;}
  const utm=latLonToUTM(lat,lon,forceZone);
  showResult('res-lltoutm',[
    ['Zone',utm.zone+'N'],['Easting',utm.easting.toFixed(3)+' m'],['Northing',utm.northing.toFixed(3)+' m'],
    ['Lat (input)',lat+'Â°'],['Lon (input)',lon+'Â°']
  ],'â• Add to Survey',()=>{
    surveyPts.push({id:surveyPts.length+1,n:utm.northing,e:utm.easting,elev:0,lat,lon,src:'Converted',desc:'Converted Pt',ts:new Date().toISOString()});
    updateSurveyDisplay();showTab('survey');toast('Point added to survey','success');
  });
  toast('Converted!','success');
}

function convUTMToLat() {
  const zone=parseFloat(g('utm-zone').value),e=parseFloat(g('utm-e').value),n=parseFloat(g('utm-n').value);
  const south=g('utm-hemi').value==='S';
  if(isNaN(zone)||isNaN(e)||isNaN(n)){toast('Enter all UTM values','warning');return;}
  const k0=0.9996,a=6378137.0,ec=0.081819191;
  let N=n;if(south)N-=10000000;
  const x=e-500000;
  const M=N/k0;
  const mu=M/(a*(1-ec*ec/4-3*ec**4/64));
  const e1=(1-Math.sqrt(1-ec*ec))/(1+Math.sqrt(1-ec*ec));
  const phi1=mu+(3*e1/2-27*e1**3/32)*Math.sin(2*mu)+(21*e1*e1/16)*Math.sin(4*mu);
  const N1=a/Math.sqrt(1-ec*ec*Math.sin(phi1)**2);
  const T1=Math.tan(phi1)**2;
  const R1=a*(1-ec*ec)/Math.pow(1-ec*ec*Math.sin(phi1)**2,1.5);
  const D=x/(N1*k0);
  const lat=(phi1-(N1*Math.tan(phi1)/R1)*(D*D/2-(5+3*T1)*D**4/24))*180/Math.PI;
  const lonO=(zone-1)*6-180+3;
  const lon=lonO+(D-(1+2*T1)*D**3/6)/Math.cos(phi1)*180/Math.PI;
  showResult('res-utmtoll',[
    ['Latitude',lat.toFixed(7)+'Â°'],['Longitude',lon.toFixed(7)+'Â°'],
    ['DMS Lat',decToDMS(lat,true)],['DMS Lon',decToDMS(lon,false)]
  ]);
  toast('Converted!','success');
}

function decToDMS(v,isLat) {
  const d=Math.floor(Math.abs(v)),m=Math.floor((Math.abs(v)-d)*60),s=((Math.abs(v)-d-m/60)*3600).toFixed(3);
  return `${d}Â° ${m}' ${s}" ${isLat?(v>=0?'N':'S'):(v>=0?'E':'W')}`;
}

function calcBearingDist() {
  const sN=parseFloat(g('bd-n').value),sE=parseFloat(g('bd-e').value);
  const bear=parseFloat(g('bd-bearing').value),dist=parseFloat(g('bd-dist').value);
  if([sN,sE,bear,dist].some(isNaN)){toast('Enter all fields','warning');return;}
  const bR=bear*Math.PI/180;
  const newN=sN+dist*Math.cos(bR),newE=sE+dist*Math.sin(bR);
  const va=parseFloat(g('bd-va').value)||0;
  const slopeDist=va!==0?dist/Math.cos(va*Math.PI/180):dist;
  showResult('bd-result',[
    ['New Northing',newN.toFixed(3)+' m'],['New Easting',newE.toFixed(3)+' m'],
    ['Bearing',bear.toFixed(4)+'Â°'],['Horizontal Dist',dist.toFixed(3)+' m'],
    ['Slope Dist',slopeDist.toFixed(3)+' m']
  ],'â• Add to Survey',()=>{
    surveyPts.push({id:surveyPts.length+1,n:newN,e:newE,elev:0,src:'Calc',desc:`Bearing-${bear.toFixed(0)}Â°`,ts:new Date().toISOString()});
    updateSurveyDisplay();showTab('survey');toast('Point added','success');
  });
  toast('Point calculated!','success');
}

function convertMultiFormat() {
  let lat=0,lon=0;
  const fmt=g('mf-format').value;
  const latIn=g('mf-lat').value.trim(),lonIn=g('mf-lon').value.trim();
  if(fmt==='dd'){lat=parseFloat(latIn);lon=parseFloat(lonIn);}
  else if(fmt==='dms'){
    const parseDMS=s=>{const p=s.match(/(\d+)[Â°\s]+(\d+)['\s]+(\d+\.?\d*)/);return p?(parseFloat(p[1])+parseFloat(p[2])/60+parseFloat(p[3])/3600):NaN;};
    lat=parseDMS(latIn);lon=parseDMS(lonIn);
  } else {
    const parseDDM=s=>{const p=s.match(/(\d+)[Â°\s]+(\d+\.?\d*)/);return p?(parseFloat(p[1])+parseFloat(p[2])/60):NaN;};
    lat=parseDDM(latIn);lon=parseDDM(lonIn);
  }
  if(isNaN(lat)||isNaN(lon)){toast('Enter valid coordinates','warning');return;}
  const utm=latLonToUTM(lat,lon);
  const ddm=(vl,isLat)=>`${Math.floor(Math.abs(vl))}Â° ${((Math.abs(vl)-Math.floor(Math.abs(vl)))*60).toFixed(5)}'${isLat?(vl>=0?' N':' S'):(vl>=0?' E':' W')}`;
  g('mf-results').innerHTML=[
    ['Decimal Degrees',`${lat.toFixed(7)}Â°N, ${lon.toFixed(7)}Â°E`],
    ['DMS',`${decToDMS(lat,true)}, ${decToDMS(lon,false)}`],
    ['DDM',`${ddm(lat,true)}, ${ddm(lon,false)}`],
    ['UTM WGS84',`Zone ${utm.zone}N | E: ${utm.easting.toFixed(3)} | N: ${utm.northing.toFixed(3)}`],
    ['MGRS-style',`${utm.zone}N ${utm.easting.toFixed(0)} ${utm.northing.toFixed(0)}`],
    ['GeoJSON',`[${lon.toFixed(7)}, ${lat.toFixed(7)}]`]
  ].map(([k,vl])=>`<div class="result-row"><span class="rk">${k}</span><span class="mono" style="font-size:0.8rem;">${vl}</span></div>`).join('');
  toast('All formats converted!','success');
}

// Traverse
function addTravLeg() {
  const idx=g('trav-legs').children.length;
  const div=document.createElement('div');
  div.style='display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:8px;align-items:end;';
  div.id='leg-'+idx;
  div.innerHTML=`
    <div><label style="font-size:0.75rem;font-weight:600;">Bearing (Â°)</label><input type="number" step="0.0001" id="lb${idx}" placeholder="90.0000" class="mono" style="margin-top:4px;"></div>
    <div><label style="font-size:0.75rem;font-weight:600;">Distance (m)</label><input type="number" step="0.001" id="ld${idx}" placeholder="100.000" class="mono" style="margin-top:4px;"></div>
    <div><label style="font-size:0.75rem;font-weight:600;">Description</label><input type="text" id="ldesc${idx}" placeholder="Leg ${idx+1}" style="margin-top:4px;"></div>
    <button onclick="g('leg-${idx}').remove()" class="btn btn-red btn-sm" style="align-self:flex-end;">âœ•</button>`;
  g('trav-legs').appendChild(div);
}

function clearTraverse(){g('trav-legs').innerHTML='';g('trav-result').classList.remove('show');}

function computeTraverse() {
  const n0=parseFloat(g('trav-n0').value)||1000,e0=parseFloat(g('trav-e0').value)||1000;
  const legs=[];let n=n0,e=e0;
  document.querySelectorAll('[id^="lb"]').forEach((el,i)=>{
    const d=document.querySelectorAll('[id^="ld"]')[i];
    const b=parseFloat(el.value),dist=parseFloat(d?.value);
    if(!isNaN(b)&&!isNaN(dist))legs.push({b,d:dist});
  });
  if(legs.length<1){toast('Add at least one leg','warning');return;}
  let rows='<tr><th>Leg</th><th>Bearing</th><th>Distance</th><th>Î”N</th><th>Î”E</th><th>Northing</th><th>Easting</th></tr>';
  legs.forEach((l,i)=>{
    const bR=l.b*Math.PI/180,dn=l.d*Math.cos(bR),de=l.d*Math.sin(bR);
    n+=dn;e+=de;
    rows+=`<tr><td>${i+1}</td><td class="mono">${l.b.toFixed(4)}Â°</td><td class="mono">${l.d.toFixed(3)}m</td><td class="mono">${dn>0?'+':''}${dn.toFixed(3)}</td><td class="mono">${de>0?'+':''}${de.toFixed(3)}</td><td class="mono">${n.toFixed(3)}</td><td class="mono">${e.toFixed(3)}</td></tr>`;
  });
  const closeN=n0-n,closeE=e0-e,totalDist=legs.reduce((s,l)=>s+l.d,0);
  const err=Math.sqrt(closeN**2+closeE**2),ratio=err>0?Math.round(totalDist/err):0;
  const quality=ratio>10000?'ğŸŸ¢ Excellent':ratio>5000?'ğŸŸ¡ Good':ratio>1000?'ğŸŸ  Acceptable':'ğŸ”´ Poor';
  g('trav-result').innerHTML=`
    <div style="overflow-x:auto;"><table class="data-table">${rows}</table></div>
    <div style="margin-top:12px;background:#f0fdfa;border:1px solid #99f6e4;border-radius:8px;padding:12px;font-size:0.82rem;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
        <div><strong>Closure N:</strong> <span class="mono">${closeN.toFixed(4)} m</span></div>
        <div><strong>Closure E:</strong> <span class="mono">${closeE.toFixed(4)} m</span></div>
        <div><strong>Linear Error:</strong> <span class="mono">${err.toFixed(4)} m</span></div>
        <div><strong>Precision Ratio:</strong> <span class="mono">1:${ratio.toLocaleString()}</span></div>
        <div><strong>Total Distance:</strong> <span class="mono">${totalDist.toFixed(3)} m</span></div>
        <div><strong>Quality:</strong> ${quality}</div>
      </div>
    </div>`;
  g('trav-result').classList.add('show');
  toast('Traverse computed!','success');
}

function calcAreaFromCoords() {
  const ns=g('area-n').value.trim().split('\n').map(parseFloat).filter(v=>!isNaN(v));
  const es=g('area-e').value.trim().split('\n').map(parseFloat).filter(v=>!isNaN(v));
  if(ns.length<3||ns.length!==es.length){toast('Need matching N and E values (min 3)','warning');return;}
  const pts=ns.map((n,i)=>({n,e:es[i]}));
  const sqm=shoelace(pts),ha=sqm/10000,ac=ha*2.47105,perim=calcPerimeter(pts);
  showResult('area-result',[
    ['Points',ns.length],['Sq Metres',sqm.toFixed(3)+' mÂ²'],['Hectares',ha.toFixed(4)+' ha'],
    ['Acres',ac.toFixed(4)+' ac'],['Perimeter',perim.toFixed(3)+' m'],['Plots (50Ã—100)',(ha*10000/1500).toFixed(2)]
  ]);
  toast('Area calculated!','success');
}

function calcInverse() {
  const n1=parseFloat(g('inv-n1').value),e1=parseFloat(g('inv-e1').value);
  const n2=parseFloat(g('inv-n2').value),e2=parseFloat(g('inv-e2').value);
  if([n1,e1,n2,e2].some(isNaN)){toast('Enter all coordinates','warning');return;}
  const dn=n2-n1,de=e2-e1;
  const dist=Math.sqrt(dn*dn+de*de);
  const bear=((Math.atan2(de,dn)*180/Math.PI)+360)%360;
  const backBear=(bear+180)%360;
  showResult('inv-result',[
    ['Distance',dist.toFixed(3)+' m'],['Forward Bearing',bear.toFixed(4)+'Â°'],
    ['Back Bearing',backBear.toFixed(4)+'Â°'],['Î”N',(dn>0?'+':'')+dn.toFixed(3)+' m'],
    ['Î”E',(de>0?'+':'')+de.toFixed(3)+' m'],['Gradient (%)','N/A (elevation required)']
  ]);
  toast('Inverse calculated!','success');
}

function showResult(id, rows, btnLabel, btnFn) {
  const el=g(id);if(!el)return;
  let html=rows.map(([k,vl])=>`<div class="result-row"><span class="rk">${k}</span><span class="mono" style="font-size:0.82rem;">${vl}</span></div>`).join('');
  if(btnLabel&&btnFn){
    const fnId='rfn_'+Math.random().toString(36).substr(2,6);
    window[fnId]=btnFn;
    html+=`<button class="btn btn-green btn-full btn-sm" style="margin-top:10px;" onclick="window['${fnId}']()">${btnLabel}</button>`;
  }
  el.innerHTML=html;el.classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLOT CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let plotCanvas,plotCtx;
function initPlotCanvas() {
  plotCanvas=g('plotCanvas');if(!plotCanvas)return;
  plotCtx=plotCanvas.getContext('2d');
  drawGrid();
}

function drawGrid() {
  if(!plotCtx||!plotCanvas)return;
  plotCtx.fillStyle='#f9fafb';plotCtx.fillRect(0,0,plotCanvas.width,plotCanvas.height);
  plotCtx.strokeStyle='#e5e7eb';plotCtx.lineWidth=0.5;
  for(let i=0;i<=plotCanvas.width;i+=50){plotCtx.beginPath();plotCtx.moveTo(i,0);plotCtx.lineTo(i,plotCanvas.height);plotCtx.stroke();}
  for(let i=0;i<=plotCanvas.height;i+=50){plotCtx.beginPath();plotCtx.moveTo(0,i);plotCtx.lineTo(plotCanvas.width,i);plotCtx.stroke();}
  plotCtx.font='bold 14px Arial';plotCtx.fillStyle='#0f172a';plotCtx.textAlign='center';
  plotCtx.fillText('N â†‘',plotCanvas.width-30,25);
}

function generatePlot() {
  const owner=v('plotOwner'),addr=v('plotAddress');
  var rawA=parseFloat(v('plotLat')),rawB=parseFloat(v('plotLon'));
  const w=parseFloat(v('plotWidth'))||15,d=parseFloat(v('plotDepth'))||30;
  const orient=(parseFloat(v('plotOrient'))||0)*Math.PI/180;
  if(!owner||!addr){toast('Enter Plot Owner name and Plot Address','warning');return;}
  if(isNaN(rawA)||isNaN(rawB)){toast('Enter valid start coordinates (latitude/longitude or northing/easting)','warning');return;}
  // Convert N/E to lat/lon if in northing/easting mode
  var lat, lon;
  if(typeof _plotMode!=='undefined' && _plotMode==='ne'){
    const ll=neToLatLon(rawA,rawB,32);
    lat=ll.lat; lon=ll.lon;
    if(isNaN(lat)||isNaN(lon)){toast('Could not convert Northing/Easting to coordinates. Check values.','error');return;}
  } else {
    lat=rawA; lon=rawB;
  }
  const utm=latLonToUTM(lat,lon);
  const cos=Math.cos(orient),sin=Math.sin(orient);
  plotPts=[
    {id:1,n:utm.northing,e:utm.easting},
    {id:2,n:utm.northing+w*sin,e:utm.easting+w*cos},
    {id:3,n:utm.northing+w*sin-d*cos,e:utm.easting+w*cos+d*sin},
    {id:4,n:utm.northing-d*cos,e:utm.easting+d*sin}
  ];
  redrawPlot(owner,addr,w,d,utm);
  toast('Plot layout generated!','success');
}

function redrawPlot(owner,addr,w,d,utm) {
  drawGrid();if(plotPts.length<2)return;
  const margin=80,pw=plotCanvas.width-2*margin,ph=plotCanvas.height-2*margin;
  const ns=plotPts.map(p=>p.n),es=plotPts.map(p=>p.e);
  const minN=Math.min(...ns),maxN=Math.max(...ns),minE=Math.min(...es),maxE=Math.max(...es);
  const rangeN=maxN-minN||1,rangeE=maxE-minE||1;
  const sx=p=>margin+((p.e-minE)/rangeE)*pw;
  const sy=p=>plotCanvas.height-margin-((p.n-minN)/rangeN)*ph;
  plotCtx.beginPath();
  plotPts.forEach((p,i)=>i===0?plotCtx.moveTo(sx(p),sy(p)):plotCtx.lineTo(sx(p),sy(p)));
  plotCtx.closePath();
  plotCtx.fillStyle='rgba(22,163,74,0.08)';plotCtx.fill();
  plotCtx.strokeStyle='#16a34a';plotCtx.lineWidth=3;plotCtx.stroke();
  plotPts.forEach(p=>{
    plotCtx.fillStyle='#0f172a';plotCtx.beginPath();plotCtx.arc(sx(p),sy(p),6,0,2*Math.PI);plotCtx.fill();
    plotCtx.fillStyle='#ffffff';plotCtx.beginPath();plotCtx.arc(sx(p),sy(p),3,0,2*Math.PI);plotCtx.fill();
    plotCtx.fillStyle='#0f172a';plotCtx.font='bold 10px JetBrains Mono,monospace';plotCtx.textAlign='left';
    plotCtx.fillText(`P${p.id} (N:${p.n.toFixed(0)} E:${p.e.toFixed(0)})`,sx(p)+9,sy(p)-6);
  });
  plotCtx.font='11px Arial';plotCtx.fillStyle='#1d4ed8';plotCtx.textAlign='center';
  const midTop={x:(sx(plotPts[0])+sx(plotPts[1]))/2,y:(sy(plotPts[0])+sy(plotPts[1]))/2};
  const midRight={x:(sx(plotPts[1])+sx(plotPts[2]))/2,y:(sy(plotPts[1])+sy(plotPts[2]))/2};
  plotCtx.fillText(`${w}m`,midTop.x,midTop.y-8);
  plotCtx.fillText(`${d}m`,midRight.x+20,midRight.y);
  plotCtx.fillStyle='#0f172a';plotCtx.font='bold 13px Arial';plotCtx.textAlign='center';
  plotCtx.fillText(`ğŸ“ ${owner}`,plotCanvas.width/2,24);
  plotCtx.font='11px Arial';plotCtx.fillStyle='#64748b';
  plotCtx.fillText(addr,plotCanvas.width/2,40);
  plotCtx.fillText(`Zone ${utm?.zone||31}N Â· Width:${w}m Â· Depth:${d}m Â· Area:${(w*d).toFixed(0)}mÂ²`,plotCanvas.width/2,plotCanvas.height-10);
  plotCtx.font='10px Arial';plotCtx.fillStyle='rgba(0,0,0,0.12)';plotCtx.textAlign='center';
  plotCtx.fillText('SurveyPro Elite Â· opusarnold@gmail.com',plotCanvas.width/2,plotCanvas.height/2+40);
}

function clearPlotCanvas(){plotPts=[];drawGrid();toast('Canvas cleared','info');}
function exportPlot(){const a=document.createElement('a');a.download=`plot-${Date.now()}.png`;a.href=plotCanvas.toDataURL('image/png',0.9);a.click();toast('Plot exported!','success');}
function calcCanvasArea(){
  if(plotPts.length<3){toast('Need at least 3 plot points','warning');return;}
  const sqm=shoelace(plotPts),ha=sqm/10000,ac=ha*2.47105,perim=calcPerimeter(plotPts);
  showResult('plotAreaResult',[
    ['Sq Metres',sqm.toFixed(2)+' mÂ²'],['Hectares',ha.toFixed(4)+' ha'],
    ['Acres',ac.toFixed(4)+' ac'],['Perimeter',perim.toFixed(2)+' m'],
    ['Plots (50Ã—100)',(ha*10000/1500).toFixed(2)]
  ]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function requestGIS(service, price) {
  const you=Math.round(parseFloat(price)*CFG.commission);
  const partner=parseFloat(price)-you;
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ—ºï¸ ${service}</h3>
    <div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;border-radius:12px;padding:16px;margin-bottom:14px;">
      <div style="font-size:0.8rem;text-align:center;opacity:0.7;margin-bottom:10px;">ğŸ’° 50/50 REVENUE SPLIT</div>
      <div style="display:flex;justify-content:space-around;text-align:center;">
        <div><div style="font-size:1.8rem;font-weight:800;color:#4ade80;">â‚¦${you.toLocaleString()}</div><div style="font-size:0.72rem;opacity:0.8;">YOUR 50%</div><div style="font-size:0.65rem;opacity:0.6;">Opay: ${CFG.opay}</div></div>
        <div style="display:flex;align-items:center;opacity:0.4;font-size:1.5rem;">|</div>
        <div><div style="font-size:1.8rem;font-weight:800;color:#60a5fa;">â‚¦${partner.toLocaleString()}</div><div style="font-size:0.72rem;opacity:0.8;">PARTNER 50%</div><div style="font-size:0.65rem;opacity:0.6;">Licensed GIS firm</div></div>
      </div>
    </div>
    <div style="display:grid;gap:8px;">
      <button class="btn btn-green btn-full" onclick="window.open(CFG.whatsapp+'?text='+encodeURIComponent('GIS Request: ${service} - â‚¦${parseFloat(price).toLocaleString()}'),'_blank');closeModal();toast('WhatsApp opened! â‚¦${you.toLocaleString()} coming to your Opay.','success');">ğŸ“± Confirm via WhatsApp</button>
      <button class="btn btn-blue btn-full" onclick="window.open(CFG.gisPartner,'_blank');closeModal();">ğŸ”— View Our Licensed GIS Partner</button>
      <button class="btn btn-gray btn-full" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// C of O VERIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function verifySurveyCode() {
  const code=g('verifyInput').value.trim().toUpperCase();
  if(!code){toast('Enter a verification code','warning');return;}
  const s=surveys.find(x=>x.verificationCode===code);
  const out=g('verifyResult');
  if(s){
    out.innerHTML=`<div class="verify-success">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
        <span style="font-size:2.5rem;">âœ…</span>
        <div><div style="font-weight:800;font-size:1.1rem;color:var(--accent);">Survey Verified</div><div style="font-size:0.78rem;color:var(--text2);">Authentic SurveyPro Elite Record</div></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:0.85rem;">
        <div><strong>Code:</strong> <span class="mono">${s.verificationCode}</span></div>
        <div><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
        <div><strong>Project:</strong> ${s.projectName}</div>
        <div><strong>Client:</strong> ${s.clientName}</div>
        <div><strong>Location:</strong> ${s.location}</div>
        <div><strong>Type:</strong> ${s.surveyType}</div>
        <div><strong>Area:</strong> <span style="color:var(--accent);font-weight:700;">${s.hectares.toFixed(4)} ha / ${s.acres.toFixed(4)} acres</span></div>
        <div><strong>Points:</strong> ${s.points}</div>
      </div>
    </div>`;
    g('qrSection').style.display='block';
    g('qrContainer').innerHTML='';
    if(window.QRCode) new QRCode(g('qrContainer'),{text:`SurveyPro Elite\nVerified: ${code}\nProject: ${s.projectName}\nArea: ${s.hectares.toFixed(4)} ha`,width:160,height:160});
  } else {
    out.innerHTML=`<div class="verify-fail">
      <div style="font-size:3rem;margin-bottom:8px;">âŒ</div>
      <h3 style="font-weight:800;color:var(--danger);">Code Not Found</h3>
      <p style="font-size:0.85rem;color:var(--text2);margin-top:6px;">The code <strong>${code}</strong> was not found. Ensure the code was generated on this device. Contact Arnold for official verification.</p>
    </div>`;
    g('qrSection').style.display='none';
  }
}

function requestCofO(){window.open(`${CFG.whatsapp}?text=${encodeURIComponent('ğŸ”’ C of O Service Request\n\nI need professional Certificate of Occupancy assistance.\nPlease contact me with your process and pricing.')}`,'_blank');}
function emailCofO(){window.location.href=`mailto:${CFG.email}?subject=C of O Assistance Request&body=Hello,%0A%0AI need professional C of O assistance.%0APlease contact me with details.`;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EQUIPMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildEquipment() {
  const grid=g('equipGrid');if(!grid)return;
  grid.innerHTML=EQUIPMENT.map(eq=>{
    const you=Math.round(eq.price*CFG.commission);
    return `<div class="equip-card">
      <div class="equip-top"><span class="equip-icon">${eq.icon}</span>
        <div><h4 style="font-weight:800;font-size:1rem;color:var(--accent2);">${eq.name}</h4><p style="font-size:0.75rem;color:var(--text3);">${eq.model}</p></div>
      </div>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:10px;">${eq.desc}</p>
      <div class="equip-price">â‚¦${eq.price.toLocaleString()} <span style="font-size:0.75rem;color:var(--text2);font-weight:400;">/day</span></div>
      <div class="equip-earn">âœ… You earn: â‚¦${you.toLocaleString()} (50% of booking)</div>
      <ul class="equip-features">${eq.features.map(f=>`<li>âœ… ${f}</li>`).join('')}</ul>
      <button class="btn btn-green btn-full" style="margin-top:10px;" onclick="bookEquipment('${eq.name}',${eq.price},'${eq.link}')">ğŸ›’ Book â€” Earn â‚¦${you.toLocaleString()}</button>
    </div>`;
  }).join('');
}

function bookEquipment(name, price, link) {
  const you=Math.round(price*CFG.commission),partner=price-you;
  openModal(`<div>
    <h3 style="font-weight:800;font-size:1.1rem;margin-bottom:14px;">âš™ï¸ ${name}</h3>
    <div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;border-radius:12px;padding:18px;margin-bottom:16px;">
      <h4 style="text-align:center;margin-bottom:12px;font-size:0.9rem;">ğŸ’° Payment Split</h4>
      <div style="display:flex;justify-content:space-between;background:rgba(255,255,255,0.1);border-radius:8px;padding:12px;margin-bottom:8px;">
        <div style="font-size:0.82rem;">Your Commission (Opay: ${CFG.opay})</div>
        <div style="font-family:Syne','Arial Black',sans-serif;font-size:1.8rem;font-weight:800;color:#4ade80;">â‚¦${you.toLocaleString()}</div>
      </div>
      <div style="display:flex;justify-content:space-between;background:rgba(255,255,255,0.1);border-radius:8px;padding:12px;">
        <div style="font-size:0.82rem;">Equipment Partner</div>
        <div style="font-family:Syne','Arial Black',sans-serif;font-size:1.8rem;font-weight:800;color:#60a5fa;">â‚¦${partner.toLocaleString()}</div>
      </div>
    </div>
    <div class="form-group"><label>Your Full Name</label><input id="bName" placeholder="Full name" type="text"></div>
    <div class="form-group"><label>Phone Number</label><input id="bPhone" placeholder="080XXXXXXXX" type="tel"></div>
    <div class="form-row">
      <div class="form-group"><label>Rental Date</label><input id="bDate" type="date"></div>
      <div class="form-group"><label>Days Required</label><input id="bDays" type="number" min="1" placeholder="1" value="1"></div>
    </div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="confirmEquipBooking('${name}',${price},${you},'${link}')">âœ… Confirm Booking</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function confirmEquipBooking(name, price, you, link) {
  const bN=v('bName'),bP=v('bPhone'),bD=v('bDate'),bDays=v('bDays');
  if(!bN){toast('Enter customer name','warning');document.getElementById('bName').focus();return;}
  if(!bP){toast('Enter phone number','warning');document.getElementById('bPhone').focus();return;}
  if(!bD){toast('Select rental date','warning');document.getElementById('bDate').focus();return;}
  if(!bDays||parseInt(bDays)<1){toast('Enter number of days (minimum 1)','warning');return;}
  const days=parseInt(bDays);
  const totalPrice=price*days,totalYou=you*days,totalPartner=(price-you)*days;
  const msg=`âš™ï¸ *EQUIPMENT BOOKING*\nEquipment: ${name}\nCustomer: ${bN}\nPhone: ${bP}\nDate: ${bD} (${days} day${days>1?'s':''})\nTotal: â‚¦${totalPrice.toLocaleString()}\nYour 50%: â‚¦${totalYou.toLocaleString()} â†’ Opay ${CFG.opay}\nPartner 50%: â‚¦${totalPartner.toLocaleString()} â†’ ${link}`;
  closeModal();
  showBanner(`âœ… Booking confirmed! â‚¦${totalYou.toLocaleString()} â†’ Opay ${CFG.opay} Â· Customer redirected to equipment partner.`);
  // First notify Arnold via WhatsApp
  window.open(CFG.whatsapp+'?text='+encodeURIComponent(msg),'_blank');
  // Then open partner site for the actual rental fulfillment
  setTimeout(()=>window.open(CFG.equipPartner,'_blank'),1200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRAINING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildCourses() {
  const grid=g('coursesGrid');if(!grid)return;
  const levelClass={Beginner:'level-beg',Intermediate:'level-int',Advanced:'level-adv'};
  grid.innerHTML=COURSES.map(c=>{
    const you=Math.round(c.price*CFG.commission);
    return `<div class="course-card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;">
        <h4 style="font-weight:700;color:var(--accent2);font-size:0.95rem;">${c.name}</h4>
        <span class="course-level ${levelClass[c.level]||'level-beg'}">${c.level}</span>
      </div>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:10px;">${c.desc}</p>
      <div style="display:flex;gap:12px;font-size:0.75rem;color:var(--text3);margin-bottom:12px;">
        <span>â±ï¸ ${c.dur}</span><span>ğŸ›ï¸ ${c.platform}</span>
      </div>
      <div class="course-price">â‚¦${c.price.toLocaleString()}</div>
      <div class="course-earn" style="margin:6px 0 12px;">You earn: â‚¦${you.toLocaleString()} (50% of booking)</div>
      <button class="btn btn-primary btn-full btn-sm" onclick="enrollCourse('${c.id}','${c.name}',${c.price},'${c.platform}')">ğŸ“ Enroll â€” Earn â‚¦${you.toLocaleString()}</button>
    </div>`;
  }).join('');
}

function enrollCourse(id, name, price, platform) {
  const you=Math.round(price*CFG.commission);
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ“ ${name}</h3>
    <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:14px;margin-bottom:14px;font-size:0.85rem;">
      <div><strong>Platform:</strong> ${platform}</div>
      <div><strong>Price:</strong> â‚¦${price.toLocaleString()}</div>
      <div><strong>Your cut (50%):</strong> <span style="color:var(--accent);font-weight:700;">â‚¦${you.toLocaleString()}</span> â†’ Opay ${CFG.opay}</div>
    </div>
    <div class="form-group"><label>Student Name</label><input id="sName" placeholder="Full name" type="text"></div>
    <div class="form-group"><label>Student Email</label><input id="sEmail" placeholder="email@example.com" type="email"></div>
    <div class="form-group"><label>Phone</label><input id="sPhone" placeholder="080XXXXXXXX" type="tel"></div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="confirmEnroll('${name}',${price},${you},'${platform}')">âœ… Enroll Now</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function confirmEnroll(name, price, you, platform) {
  const sN=v('sName'),sE=v('sEmail'),sP=v('sPhone');
  if(!sN){toast('Enter student name','warning');document.getElementById('sName').focus();return;}
  if(!sE||!sE.includes('@')){toast('Enter a valid email address','warning');document.getElementById('sEmail').focus();return;}
  const partner=price-you;
  const msg=`ğŸ“ *COURSE ENROLLMENT*\nCourse: ${name}\nPlatform: ${platform}\nStudent: ${sN}\nEmail: ${sE}\nPhone: ${sP||'Not provided'}\nPrice: â‚¦${price.toLocaleString()}\nYour 50%: â‚¦${you.toLocaleString()} â†’ Opay ${CFG.opay}\nPartner 50%: â‚¦${partner.toLocaleString()} â†’ ${platform}`;
  closeModal();
  showBanner(`âœ… Enrolled in ${name}! â‚¦${you.toLocaleString()} â†’ Opay ${CFG.opay} Â· Student directed to ${platform}.`);
  // Notify Arnold
  window.open(CFG.whatsapp+'?text='+encodeURIComponent(msg),'_blank');
  // Redirect student to training partner
  setTimeout(()=>window.open(CFG.trainPartner,'_blank'),1200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateHistory() {
  const cont=g('historyContent');if(!cont)return;
  if(surveys.length===0){
    cont.innerHTML='<div style="text-align:center;padding:60px 20px;color:var(--text3);"><div style="font-size:3rem;margin-bottom:12px;">ğŸ“‚</div><p style="font-size:1.1rem;font-weight:600;">No saved surveys yet</p><p style="font-size:0.85rem;margin-top:6px;">Complete and save surveys to see them here</p></div>';
    return;
  }
  cont.innerHTML=surveys.slice().reverse().map((s,i)=>{
    const realIdx=surveys.length-1-i;
    return `<div class="hist-card">
      <div class="hist-header">
        <div><h3 style="font-weight:800;font-size:1rem;color:var(--accent2);">${s.projectName}</h3><p style="font-size:0.82rem;color:var(--text2);">${s.location} Â· ${s.surveyType}</p></div>
        <span class="hist-code">${s.verificationCode}</span>
      </div>
      <div class="hist-stats">
        <div class="hist-stat"><div class="hk">Hectares</div><div class="hv" style="color:var(--accent);">${s.hectares.toFixed(4)}</div></div>
        <div class="hist-stat"><div class="hk">Acres</div><div class="hv" style="color:var(--accent2);">${s.acres.toFixed(4)}</div></div>
        <div class="hist-stat"><div class="hk">Points</div><div class="hv">${s.points}</div></div>
        <div class="hist-stat"><div class="hk">Plots</div><div class="hv" style="color:var(--warning);">${s.plots.toFixed(1)}</div></div>
      </div>
      <div style="font-size:0.78rem;color:var(--text3);margin-bottom:10px;">${s.clientName} Â· ${s.clientPhone} Â· ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn btn-blue btn-sm" onclick="shareSurvey(${realIdx})">ğŸ“± Share</button>
        <button class="btn btn-gray btn-sm" onclick="viewSurveyDetail(${realIdx})">ğŸ‘ View</button>
        <button class="btn btn-green btn-sm" onclick="generateQRForSurvey(${realIdx})">ğŸ“± QR</button>
        <button class="btn btn-red btn-sm" onclick="deleteSurvey(${realIdx})">ğŸ—‘ï¸</button>
      </div>
    </div>`;
  }).join('');
}

function viewSurveyDetail(i) {
  const s=surveys[i];
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ“Š ${s.projectName}</h3>
    <div style="font-size:0.82rem;display:grid;gap:6px;margin-bottom:14px;">
      <div><strong>Code:</strong> <span class="mono">${s.verificationCode}</span></div>
      <div><strong>Client:</strong> ${s.clientName} Â· ${s.clientPhone}</div>
      <div><strong>Location:</strong> ${s.location}</div>
      <div><strong>File No:</strong> ${s.fileNumber||'N/A'}</div>
      <div><strong>Type:</strong> ${s.surveyType}</div>
      <div><strong>System:</strong> ${s.coordSystem}</div>
      <div><strong>Area:</strong> ${s.hectares.toFixed(4)} ha / ${s.acres.toFixed(4)} acres</div>
      <div><strong>Perimeter:</strong> ${s.perimeter?.toFixed(2)||'N/A'} m</div>
      <div><strong>Points:</strong> ${s.points}</div>
      <div><strong>Surveyor:</strong> ${s.surveyor||CFG.name}</div>
      <div><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
      ${s.notes?`<div><strong>Notes:</strong> ${s.notes}</div>`:''}
    </div>
    <button class="btn btn-gray btn-full" onclick="closeModal()">Close</button>
  </div>`);
}

function generateQRForSurvey(i) {
  const s=surveys[i];
  openModal(`<div style="text-align:center;">
    <h3 style="font-weight:700;margin-bottom:14px;">ğŸ“± Survey QR Code</h3>
    <div id="histQR" style="display:inline-block;"></div>
    <p class="mono" style="font-size:0.8rem;margin-top:10px;color:var(--text2);">${s.verificationCode}</p>
    <button class="btn btn-gray btn-full" style="margin-top:12px;" onclick="closeModal()">Close</button>
  </div>`);
  setTimeout(()=>{if(window.QRCode)new QRCode(document.getElementById('histQR'),{text:`SurveyPro Elite\nCode: ${s.verificationCode}\nProject: ${s.projectName}\nClient: ${s.clientName}\nArea: ${s.hectares.toFixed(4)} ha`,width:180,height:180});},200);
}

function shareSurvey(i) {
  const s=surveys[i];
  const txt=`ğŸ“Š SURVEY REPORT â€” SurveyPro Elite\n\nProject: ${s.projectName}\nLocation: ${s.location}\nClient: ${s.clientName}\nArea: ${s.hectares.toFixed(4)} ha / ${s.acres.toFixed(4)} acres\nPerimeter: ${s.perimeter?.toFixed(2)||'N/A'} m\nVerification: ${s.verificationCode}\nDate: ${new Date(s.savedAt).toLocaleDateString('en-NG')}\n\nSurveyPro Elite Â· ${CFG.email} Â· +234-811-755-4948`;
  if(navigator.share){navigator.share({title:`Survey â€” ${s.projectName}`,text:txt});}
  else if(navigator.clipboard){navigator.clipboard.writeText(txt);toast('Survey details copied!','success');}
  else{window.open(`${CFG.whatsapp}?text=${encodeURIComponent(txt)}`,'_blank');}
}

function deleteSurvey(i){if(!confirm('Delete this survey? Cannot be undone.'))return;surveys.splice(i,1);saveSurveys();updateHistory();updateReportDropdown();toast('Survey deleted','info');}
function clearAllHistory(){if(!confirm('Delete ALL surveys? Cannot be undone.'))return;surveys=[];saveSurveys();updateHistory();updateReportDropdown();toast('All history cleared','info');}
function exportAllSurveysJSON(){
  const blob=new Blob([JSON.stringify({surveys,exportedAt:new Date().toISOString(),platform:'SurveyPro Elite'},null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`all-surveys-${Date.now()}.json`;a.click();
  toast('All surveys exported','success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateReportDropdown() {
  const sel=g('reportSurveySelect');if(!sel)return;
  sel.innerHTML='<option value="">â€” Select a saved survey â€”</option>'+surveys.map((s,i)=>`<option value="${i}">${s.projectName} (${s.verificationCode})</option>`).join('');
}

function generateReport() {
  const idx=g('reportSurveySelect').value;
  if(idx===''){toast('Select a survey first','warning');return;}
  const s=surveys[parseInt(idx)];
  const rType=v('reportType'),rSurv=v('rptSurveyor'),rLic=v('rptLicense'),rFoot=v('rptFooter');
  const html=`<div style="background:#fff;border:2px solid var(--border);border-radius:12px;padding:24px;font-size:0.85rem;">
    <div style="text-align:center;border-bottom:3px solid #0f172a;padding-bottom:16px;margin-bottom:16px;">
      <div style="font-size:1.5rem;margin-bottom:4px;">ğŸ¯</div>
      <h2 style="font-size:1.3rem;font-weight:800;">SURVEY REPORT</h2>
      <p style="font-size:0.8rem;color:var(--text2);">SurveyPro Elite Â· WGS84 Â· ${rType}</p>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
      <div><strong>Project:</strong> ${s.projectName}</div>
      <div><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
      <div><strong>Client:</strong> ${s.clientName}</div>
      <div><strong>Phone:</strong> ${s.clientPhone}</div>
      <div><strong>Location:</strong> ${s.location}</div>
      <div><strong>File No:</strong> ${s.fileNumber||'N/A'}</div>
      <div><strong>Survey Type:</strong> ${s.surveyType}</div>
      <div><strong>Coord System:</strong> ${s.coordSystem}</div>
    </div>
    <div style="background:#f0fdf4;border-radius:10px;padding:14px;margin-bottom:14px;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;text-align:center;">
      <div><div style="font-size:0.72rem;color:var(--text3);">HECTARES</div><div style="font-weight:800;color:var(--accent);">${s.hectares.toFixed(4)}</div></div>
      <div><div style="font-size:0.72rem;color:var(--text3);">ACRES</div><div style="font-weight:800;color:var(--accent2);">${s.acres.toFixed(4)}</div></div>
      <div><div style="font-size:0.72rem;color:var(--text3);">PERIMETER</div><div style="font-weight:800;">${s.perimeter?.toFixed(2)||'N/A'} m</div></div>
      <div><div style="font-size:0.72rem;color:var(--text3);">PLOTS</div><div style="font-weight:800;">${s.plots?.toFixed(1)||'N/A'}</div></div>
    </div>
    <div style="margin-bottom:14px;">
      <div style="font-weight:700;margin-bottom:6px;">Verification Code</div>
      <div class="mono" style="font-size:1.3rem;font-weight:700;color:var(--accent);letter-spacing:0.1em;">${s.verificationCode}</div>
    </div>
    <div style="border-top:1px solid var(--border);padding-top:14px;font-size:0.78rem;color:var(--text2);">
      <p><strong>Surveyor:</strong> ${rSurv||CFG.name} ${rLic?'Â· Lic: '+rLic:''}</p>
      ${rFoot?`<p style="margin-top:6px;">${rFoot}</p>`:''}
      <p style="margin-top:6px;">Generated by SurveyPro Elite Â· ${CFG.email} Â· +234-811-755-4948</p>
    </div>
  </div>`;
  g('reportPreview').innerHTML=html;
  toast('Report generated','success');
}

function printReport(){
  const prev=g('reportPreview').innerHTML;
  if(!prev){toast('Generate report first','warning');return;}
  const w=window.open('','_blank');
  if(w){w.document.write(`<!DOCTYPE html><html><head><title>Survey Report</title><style>body{font-family:Arial,sans-serif;margin:30px;}.mono{font-family:monospace;}</style></head><body>${prev}<script>window.print();<\/script></body></html>`);w.document.close();}
}

function emailReport(){
  const idx=g('reportSurveySelect').value;
  if(idx===''){toast('Select a survey first','warning');return;}
  const s=surveys[parseInt(idx)];
  if(!s.clientEmail){toast('No client email for this survey','warning');return;}
  window.location.href=`mailto:${s.clientEmail}?subject=Survey Report â€” ${s.projectName}&body=Dear ${s.clientName},%0A%0APlease find your survey report details:%0A%0AProject: ${s.projectName}%0AVerification: ${s.verificationCode}%0AArea: ${s.hectares.toFixed(4)} ha%0A%0ASurveyPro Elite%0A${CFG.email}`;
}

function previewReport(){generateReport();document.getElementById('reportPreview').scrollIntoView({behavior:'smooth'});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRICING ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function subscribePro(){
  const msg='ğŸ’ Professional Subscription Request\n\nI would like to subscribe to SurveyPro Elite Professional plan (â‚¦5,000/month).\n\nPlease send payment details and activate my account.';
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
}
function contactEnterprise(){
  const msg='ğŸ¢ Enterprise Plan Inquiry\n\nI am interested in the SurveyPro Elite Enterprise plan for my organization.\n\nPlease contact me with details, pricing, and SLA terms.';
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTACT FORM (Formspree handler)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleContactSubmit(event) {
  // Let Formspree handle the POST, but show feedback
  const btn=g('contactSubmitBtn');
  const msg=document.getElementById('contactFormMsg');
  if(btn){btn.textContent='â³ Sending...';btn.disabled=true;}
  // Fallback: if Formspree is not set up, use WhatsApp/email
  const formData=new FormData(event.target);
  const name=formData.get('name')||'';
  const email=formData.get('email')||'';
  const service=formData.get('service')||'General Inquiry';
  const message=formData.get('message')||'';
  // Only intercept if Formspree ID is placeholder
  if(event.target.action.includes('YOUR_FORMSPREE_ID')){
    event.preventDefault();
    const waMsg=`ğŸ“© *New Inquiry â€” SurveyPro Elite*\n\nName: ${name}\nEmail: ${email}\nService: ${service}\n\nMessage:\n${message}`;
    if(msg){msg.style.display='block';msg.textContent='âœ… Redirecting to WhatsApp (Formspree not configured yet)...';}
    setTimeout(()=>{window.open(`${CFG.whatsapp}?text=${encodeURIComponent(waMsg)}`,'_blank');if(btn){btn.textContent='ğŸ“© Send Message';btn.disabled=false;}},1000);
  }
  // Otherwise let the form submit normally to Formspree
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLang(l) {
  const langs={en:'English',ha:'Hausa',yo:'Yoruba',ig:'Igbo',fr:'French'};
  toast(`Language: ${langs[l]||l} â€” Full multilingual UI coming in v2.0`,'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DARK MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleDark() {
  darkMode=!darkMode;
  document.body.classList.toggle('dark',darkMode);
  g('darkBtn').textContent=darkMode?'â˜€ï¸ Light':'ğŸŒ™ Dark';
  try{localStorage.setItem('sp_dark',darkMode?'1':'0');}catch(e){}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL & TOAST & BANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(html) {g('modalContent').innerHTML=html;g('modalBg').classList.add('open');}
function closeModal() {g('modalBg').classList.remove('open');}

function toast(msg, type='info') {
  const icons={success:'âœ…',warning:'âš ï¸',error:'âŒ',info:'ğŸ’¡'};
  const el=document.createElement('div');
  el.className=`toast t-${type}`;
  el.textContent=`${icons[type]||'ğŸ“‹'} ${msg}`;
  g('toastWrap').appendChild(el);
  requestAnimationFrame(()=>el.classList.add('show'));
  setTimeout(()=>{el.classList.remove('show');setTimeout(()=>el.remove(),400);},3500);
}

function showBanner(msg) {
  g('bannerMsg').textContent=msg;
  g('topBanner').classList.add('show');
  setTimeout(closeBanner,7000);
}
function closeBanner(){g('topBanner').classList.remove('show');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATH UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shoelace(pts){
  let a=0;
  for(let i=0;i<pts.length;i++){const j=(i+1)%pts.length;a+=pts[i].e*pts[j].n-pts[j].e*pts[i].n;}
  return Math.abs(a/2);
}
function calcPerimeter(pts){
  let p=0;
  for(let i=0;i<pts.length;i++){const j=(i+1)%pts.length;p+=Math.sqrt((pts[j].n-pts[i].n)**2+(pts[j].e-pts[i].e)**2);}
  return p;
}
function v(id){const el=document.getElementById(id);return el?el.value.trim():'';}
function g(id){return document.getElementById(id);}
function saveSurveys(){try{localStorage.setItem('sp_elite_v3_surveys',JSON.stringify(surveys));}catch(e){console.warn('Storage error',e);}}
function loadSurveys(){try{const d=localStorage.getItem('sp_elite_v3_surveys');if(d)surveys=JSON.parse(d);}catch(e){console.warn('Load error',e);}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA â€” Progressive Web App
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let deferredInstallPrompt=null;
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredInstallPrompt=e;
});

function installApp() {
  if(deferredInstallPrompt){
    deferredInstallPrompt.prompt();
    deferredInstallPrompt.userChoice.then(r=>{
      if(r.outcome==='accepted')toast('SurveyPro Elite installed! ğŸ‰','success');
      document.getElementById('installBar').style.display='none';
      deferredInstallPrompt=null;
    });
  } else {
    toast('To install: browser menu â†’ "Add to Home Screen"','info');
  }
}

function dismissInstall(){document.getElementById('installBar').style.display='none';}


function filterJobs() {
  const state = document.getElementById('jobStateFilter')?.value;
  const cat = document.getElementById('jobCatFilter')?.value;
  const urg = document.getElementById('jobUrgFilter')?.value;
  let jobs = JSON.parse(localStorage.getItem('spe_jobs') || JSON.stringify(SAMPLE_JOBS));
  if (state) jobs = jobs.filter(j => j.state === state);
  if (cat) jobs = jobs.filter(j => j.category === cat);
  if (urg) jobs = jobs.filter(j => j.urgency === urg);
  renderJobBoard(jobs);
}



// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BAAS-POWERED BACKEND FEATURES
// Formspree (Forms) Â· Paystack (Payments) Â· localStorage (Data)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ AUTH SYSTEM (localStorage-based with JWT-ready structure) â”€â”€â”€â”€â”€â”€â”€â”€
const AUTH = {
  user: null,
  token: null,
  
  init() {
    try {
      const stored = localStorage.getItem('spe_auth');
      if (stored) {
        const data = JSON.parse(stored);
        this.user = data.user;
        this.token = data.token;
        this.updateUI();
      }
    } catch(e) {}
  },
  
  save(user, token) {
    this.user = user;
    this.token = token;
    localStorage.setItem('spe_auth', JSON.stringify({ user, token, savedAt: new Date().toISOString() }));
    this.updateUI();
  },
  
  logout() {
    this.user = null;
    this.token = null;
    localStorage.removeItem('spe_auth');
    this.updateUI();
    toast('Signed out. See you again! ğŸ‘‹', 'info');
    // Return to home and show auth modal
    setTimeout(() => {
      document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(el=>el.classList.remove('active'));
      const homeTab=document.getElementById('tab-home');
      const homeBtn=document.getElementById('nb-home');
      if(homeTab) homeTab.classList.add('active');
      if(homeBtn) homeBtn.classList.add('active');
      const modal=document.getElementById('authModal');
      if(modal){ modal.style.display='flex'; }
    }, 600);
  },
  
  isLoggedIn() { return !!this.user; },
  
  updateUI() {
    const loginBtn = document.getElementById('loginBtn');
    const userMenu = document.getElementById('userMenu');
    const userName = document.getElementById('userName');
    const userPlan = document.getElementById('userPlan');
    
    if (this.user) {
      if (loginBtn) loginBtn.style.display = 'none';
      if (userMenu) userMenu.style.display = 'flex';
      if (userName) userName.textContent = this.user.firstName || this.user.name || 'User';
      const plan = this.user.subscription?.plan || 'free';
      if (userPlan) {
        userPlan.className = `plan-badge plan-${plan}`;
        userPlan.textContent = plan.toUpperCase();
      }
    } else {
      if (loginBtn) loginBtn.style.display = 'flex';
      if (userMenu) userMenu.style.display = 'none';
    }
  }
};

function openAuthModal(tab) {
  tab = tab || 'login';
  const modal = document.getElementById('authModal');
  if (modal) { modal.style.display='flex'; switchAuth(tab); }
}
function closeAuthModal() {
  // Only allow closing if user is already logged in
  if(!AUTH.isLoggedIn()) return;
  const modal = document.getElementById('authModal');
  if (modal) modal.style.display='none';
}
function switchAuth(tab) {
  document.querySelectorAll('.auth-pane').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  const pane = document.getElementById('auth-' + tab);
  const tabs = document.querySelectorAll('.auth-tab');
  if (pane) pane.classList.add('active');
  const idx = tab === 'login' ? 0 : 1;
  if (tabs[idx]) tabs[idx].classList.add('active');
}

function doLogin() {
  const email = (document.getElementById('loginEmail')?.value||'').trim();
  const pwd = document.getElementById('loginPwd')?.value||'';
  if (!email||!pwd) { toast('Please enter your email and password','warning'); return; }
  if (!email.includes('@')) { toast('Enter a valid email address','warning'); return; }

  const users = JSON.parse(localStorage.getItem('spe_users')||'[]');
  const user = users.find(u=>u.email===email);

  if (user && user.pwdHash===btoa(pwd)) {
    AUTH.save(user,'local_'+Date.now());
    document.getElementById('authModal').style.display='none';
    toast(`Welcome back, ${user.firstName}! ğŸ‰`,'success');
    showBanner(`âœ… Signed in as ${user.firstName} ${user.lastName}`);
    // Force navigation to survey tool after login
    setTimeout(()=>showTab('survey'),300);
  } else if (user) {
    toast('Incorrect password. Please try again.','error');
    document.getElementById('loginPwd').value='';
    document.getElementById('loginPwd').focus();
  } else {
    toast('No account found for this email. Please create an account first.','warning');
    switchAuth('register');
  }
}

function doRegister() {
  const first = (document.getElementById('regFirst')?.value||'').trim();
  const last = (document.getElementById('regLast')?.value||'').trim();
  const email = (document.getElementById('regEmail')?.value||'').trim();
  const phone = (document.getElementById('regPhone')?.value||'').trim();
  const pwd = document.getElementById('regPwd')?.value||'';
  const role = document.getElementById('regRole')?.value||'client';
  const license = (document.getElementById('regLicense')?.value||'').trim();

  // Validate
  if (!first) { toast('Please enter your first name','warning'); document.getElementById('regFirst').focus(); return; }
  if (!last)  { toast('Please enter your last name','warning'); document.getElementById('regLast').focus(); return; }
  if (!email||!email.includes('@')) { toast('Enter a valid email address','warning'); document.getElementById('regEmail').focus(); return; }
  if (!pwd||pwd.length<8) { toast('Password must be at least 8 characters','warning'); document.getElementById('regPwd').focus(); return; }

  const users = JSON.parse(localStorage.getItem('spe_users')||'[]');
  if (users.find(u=>u.email===email)) {
    toast('This email is already registered. Please sign in.','error');
    switchAuth('login');
    document.getElementById('loginEmail').value=email;
    return;
  }

  const newUser = {
    id:'u_'+Date.now(), firstName:first, lastName:last,
    email, phone, role, licenseNumber:license,
    pwdHash:btoa(pwd),
    subscription:{plan:'free',status:'active'},
    jobsCompleted:0, totalEarnings:0,
    createdAt:new Date().toISOString()
  };
  users.push(newUser);
  localStorage.setItem('spe_users',JSON.stringify(users));
  AUTH.save(newUser,'local_'+Date.now());
  document.getElementById('authModal').style.display='none';
  toast(`ğŸ‰ Welcome to SurveyPro Elite, ${first}! Your account is ready.`,'success');
  showBanner(`âœ… Account created! Welcome, ${first} ${last} â€” you now have full access.`);
  setTimeout(()=>showTab('survey'),300);
}

function googleAuth() {
  // Google OAuth would need a real OAuth flow - simulate for now
  toast('Google sign-in requires backend setup. Use email/password or WhatsApp for now.', 'info');
}

function showForgotPwd() {
  const email = prompt('Enter your registered email address:');
  if (email) {
    toast(`Password reset link would be sent to ${email}. Contact us on WhatsApp for immediate help.`, 'info');
    window.open(`${CFG.whatsapp}?text=${encodeURIComponent(`ğŸ”‘ Password Reset Request\nEmail: ${email}\nPlease help me reset my SurveyPro Elite password.`)}`, '_blank');
  }
}

function logoutUser() {
  if (confirm('Sign out of SurveyPro Elite?')) AUTH.logout();
}

// â”€â”€ PAYSTACK PAYMENT INTEGRATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PLANS_DATA = {
  basic:        { name: 'Basic',        price: 5000,  priceKobo: 500000  },
  professional: { name: 'Professional', price: 15000, priceKobo: 1500000 },
  enterprise:   { name: 'Enterprise',   price: 35000, priceKobo: 3500000 }
};

let currentPayPlan = 'professional';

function openPaymentModal(plan = 'professional') {
  currentPayPlan = plan;
  const p = PLANS_DATA[plan] || PLANS_DATA.professional;
  document.getElementById('payModalTitle').textContent = `ğŸ’³ Subscribe to ${p.name}`;
  document.getElementById('payPlanName').textContent = `${p.name} Plan`;
  document.getElementById('payAmount').textContent = `â‚¦${p.price.toLocaleString()}/mo`;
  
  const email = AUTH.user?.email || '';
  const name = AUTH.user ? `${AUTH.user.firstName} ${AUTH.user.lastName}` : '';
  if (document.getElementById('payEmail')) document.getElementById('payEmail').value = email;
  if (document.getElementById('payName')) document.getElementById('payName').value = name;
  
  document.getElementById('paymentModal').classList.add('open');
}
function closePaymentModal() {
  document.getElementById('paymentModal').classList.remove('open');
}

function initiatePaystack() {
  const email = document.getElementById('payEmail')?.value.trim();
  const name = document.getElementById('payName')?.value.trim();
  
  if (!email) { toast('Enter your email address', 'warning'); return; }
  
  const plan = PLANS_DATA[currentPayPlan];
  
  // Paystack inline checkout
  // In production: replace with your real Paystack public key
  const PAYSTACK_PK = CFG.paystack_key; // Use key from CFG object above
  
  const handler = {
    key: PAYSTACK_PK,
    email: email,
    amount: plan.priceKobo,
    currency: 'NGN',
    metadata: { name, plan: currentPayPlan, platform: 'SurveyPro Elite' },
    callback: function(response) {
      // Payment successful
      toast(`âœ… Payment successful! Ref: ${response.reference}`, 'success');
      closePaymentModal();
      // Activate plan locally
      if (AUTH.user) {
        AUTH.user.subscription = { plan: currentPayPlan, status: 'active', startDate: new Date().toISOString(), reference: response.reference };
        AUTH.save(AUTH.user, AUTH.token);
        showBanner(`ğŸ‰ ${plan.name} plan activated! All features unlocked.`);
      }
      // Send confirmation via WhatsApp
      const msg = `âœ… PAYMENT CONFIRMED â€” SurveyPro Elite\n\nPlan: ${plan.name}\nAmount: â‚¦${plan.price.toLocaleString()}\nRef: ${response.reference}\nEmail: ${email}\n\nThank you! Your subscription is now active.`;
      setTimeout(() => window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank'), 1000);
    },
    onClose: function() {
      toast('Payment cancelled', 'info');
    }
  };
  
  // Try to use Paystack if loaded, else show manual payment
  if (window.PaystackPop) {
    const popup = window.PaystackPop.setup(handler);
    popup.openIframe();
  } else {
    // Paystack not loaded - redirect to Paystack page or manual
    const paystackURL = `https://paystack.com/pay/surveypro-${currentPayPlan}`;
    const msg = `ğŸ’³ *SUBSCRIPTION PAYMENT â€” SurveyPro Elite*\n\nPlan: *${plan.name}*\nAmount: â‚¦${plan.price.toLocaleString()}/month\nName: ${name}\nEmail: ${email}\n\n*Payment Options:*\n1ï¸âƒ£ Bank: First Bank â€” Arnold Opusunju â€” 0123456789\n2ï¸âƒ£ Opay: ${CFG.opay}\n3ï¸âƒ£ PalmPay: ${CFG.phone}\n\nAfter payment, send proof to activate your plan.`;
    closePaymentModal();
    window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
  }
}

function payViaOpay() {
  const plan = PLANS_DATA[currentPayPlan] || PLANS_DATA.professional;
  const name = document.getElementById('payName')?.value.trim() || 'Customer';
  const email = document.getElementById('payEmail')?.value.trim() || '';
  const msg = `ğŸ’³ *PAYMENT â€” SurveyPro Elite*

Plan: ${plan.name}
Amount: â‚¦${plan.price.toLocaleString()}
Name: ${name}
Email: ${email}

Send â‚¦${plan.price.toLocaleString()} to:
ğŸ“± Opay: *8117554948* (Arnold Opusunju)

After payment, send screenshot to confirm.`;
  closePaymentModal();
  openModal(`<div style="text-align:center;padding:10px;">
    <div style="font-size:3rem;margin-bottom:10px;">ğŸ“±</div>
    <h3 style="font-weight:800;margin-bottom:10px;">Pay via Opay</h3>
    <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:12px;padding:18px;margin-bottom:14px;text-align:left;">
      <div style="font-size:0.78rem;color:var(--text3);margin-bottom:6px;font-weight:700;">SEND PAYMENT TO:</div>
      <div style="font-size:1.8rem;font-weight:800;color:var(--accent);font-family:monospace;text-align:center;letter-spacing:2px;margin:10px 0;">8117554948</div>
      <div style="text-align:center;font-size:0.85rem;color:var(--text2);">Arnold Opusunju Â· Opay</div>
      <div style="text-align:center;font-size:1.2rem;font-weight:800;margin-top:10px;color:var(--accent);">Amount: â‚¦${plan.price.toLocaleString()}</div>
      <div style="font-size:0.75rem;color:var(--text3);text-align:center;margin-top:6px;">Plan: ${plan.name}</div>
    </div>
    <div style="display:grid;gap:8px;">
      <button class="btn btn-green btn-full" onclick="window.open(CFG.whatsapp+'?text='+encodeURIComponent('${encodeURIComponent(msg)}'),'_blank');closeModal();toast('Send your payment screenshot on WhatsApp!','success');">ğŸ“± Confirm via WhatsApp</button>
      <button class="btn btn-gray btn-full" onclick="closeModal()">Done</button>
    </div>
  </div>`);
}

function payViaBankTransfer() {
  const plan = PLANS_DATA[currentPayPlan] || PLANS_DATA.professional;
  closePaymentModal();
  openModal(`<div style="text-align:left;padding:10px;">
    <h3 style="font-weight:800;margin-bottom:14px;text-align:center;">ğŸ¦ Bank Transfer Details</h3>
    <div style="display:grid;gap:10px;margin-bottom:16px;">
      <div style="background:#eff6ff;border:2px solid #bfdbfe;border-radius:10px;padding:14px;">
        <div style="font-size:0.7rem;color:var(--text3);font-weight:700;margin-bottom:4px;">BANK</div>
        <div style="font-weight:800;font-size:1.1rem;">${CFG.bankName}</div>
      </div>
      <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:14px;">
        <div style="font-size:0.7rem;color:var(--text3);font-weight:700;margin-bottom:4px;">ACCOUNT NUMBER</div>
        <div style="font-weight:800;font-size:1.5rem;font-family:monospace;letter-spacing:2px;color:var(--accent);">${CFG.bankAccount}</div>
      </div>
      <div style="background:#f8fafc;border-radius:10px;padding:14px;">
        <div style="font-size:0.7rem;color:var(--text3);font-weight:700;margin-bottom:4px;">ACCOUNT NAME</div>
        <div style="font-weight:700;">${CFG.bankAccountName}</div>
      </div>
      <div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;border-radius:10px;padding:14px;text-align:center;">
        <div style="font-size:0.75rem;opacity:0.7;margin-bottom:4px;">AMOUNT TO TRANSFER</div>
        <div style="font-size:2rem;font-weight:800;color:#4ade80;">â‚¦${plan.price.toLocaleString()}</div>
        <div style="font-size:0.75rem;opacity:0.7;">${plan.name} Plan</div>
      </div>
    </div>
    <p style="font-size:0.78rem;color:var(--text2);margin-bottom:12px;">âš ï¸ After transfer, send proof of payment (screenshot) via WhatsApp to activate your plan immediately.</p>
    <div style="display:grid;gap:8px;">
      <button class="btn btn-green btn-full" onclick="window.open(CFG.whatsapp+'?text='+encodeURIComponent('ğŸ’³ Bank Transfer Payment â€” SurveyPro Elite\nPlan: ${plan.name}\nAmount: â‚¦${plan.price.toLocaleString()}\nI have transferred the amount. Please activate my account.'),'_blank');closeModal();">ğŸ“± Send Proof via WhatsApp</button>
      <button class="btn btn-gray btn-full" onclick="closeModal()">Close</button>
    </div>
  </div>`);
}


function manualPayment() {
  const email = document.getElementById('payEmail')?.value.trim() || '';
  const name = document.getElementById('payName')?.value.trim() || '';
  const plan = PLANS_DATA[currentPayPlan];
  
  const msg = `ğŸ’³ *SUBSCRIPTION REQUEST â€” SurveyPro Elite*\n\nName: ${name}\nEmail: ${email}\nPlan: *${plan.name}*\nAmount: â‚¦${plan.price.toLocaleString()}/month\n\nPlease send payment details and bank account info.`;
  closePaymentModal();
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
}

// Override subscribePro and contactEnterprise to use new modal


// â”€â”€ FORMSPREE CONTACT FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function submitContact(e) {
  e.preventDefault();
  const form = document.getElementById('contactForm');
  const status = document.getElementById('contactStatus');
  const btn = form.querySelector('button[type=submit]');
  
  btn.textContent = 'ğŸ“¨ Sending...';
  btn.disabled = true;
  
  try {
    const response = await fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: { 'Accept': 'application/json' }
    });
    
    if (response.ok) {
      status.textContent = 'âœ… Message sent! We will reply within 2 hours. Check WhatsApp +234-811-755-4948 for faster response.';
      status.className = 'status-msg show success';
      form.reset();
      toast('Message sent successfully!', 'success');
    } else {
      throw new Error('Form submission failed');
    }
  } catch(err) {
    // Formspree fallback - use WhatsApp instead
    status.textContent = 'âš ï¸ Direct message failed. Redirecting to WhatsApp...';
    status.className = 'status-msg show error';
    setTimeout(() => {
      const data = new FormData(form);
      const msg = `ğŸ“© Website Contact â€” SurveyPro Elite\n\nName: ${data.get('name')||''}\nEmail: ${data.get('email')||''}\nPhone: ${data.get('phone')||''}\nService: ${data.get('service')||''}\nState: ${data.get('state')||''}\n\nMessage:\n${data.get('message')||''}`;
      window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
    }, 1500);
  } finally {
    btn.textContent = 'ğŸ“¨ Send Message â€” We Reply Within 2 Hours';
    btn.disabled = false;
  }
}

// â”€â”€ JOB BOARD (localStorage-based with Nigeria states) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const JOB_CATEGORIES = ['Cadastral Survey','Topographic Survey','Boundary Survey','Engineering Survey','Hydrographic Survey','GIS Mapping','Aerial/Drone Survey','C of O Processing'];

const SAMPLE_JOBS = [
  { id: 'j1', title: 'Boundary Survey â€” 2 Plots', category: 'Boundary Survey', state: 'Lagos', lga: 'Ikeja', budget: 120000, urgency: 'high', posted: '2026-02-17', desc: 'Need boundary survey for 2 plots at Lagos Island. SURCON licensed surveyor required.', client: 'Abubakar M.', status: 'open' },
  { id: 'j2', title: 'Topographic Survey â€” 5 Hectares', category: 'Topographic Survey', state: 'FCT - Abuja', lga: 'Gwagwalada', budget: 80000, urgency: 'medium', posted: '2026-02-16', desc: 'Topographic survey for housing estate development. 5ha site in Gwagwalada.', client: 'Chioma E.', status: 'open' },
  { id: 'j3', title: 'C of O Processing â€” Rivers State', category: 'C of O Processing', state: 'Rivers', lga: 'Port Harcourt', budget: 200000, urgency: 'urgent', posted: '2026-02-15', desc: 'Urgent C of O processing for commercial property. All documents ready.', client: 'Emeka O.', status: 'open' },
  { id: 'j4', title: 'GIS Mapping â€” Agricultural Land', category: 'GIS Mapping', state: 'Kano', lga: 'Kano Municipal', budget: 60000, urgency: 'low', posted: '2026-02-14', desc: '50-hectare agricultural land GIS mapping and NDVI analysis required.', client: 'Musa I.', status: 'open' },
  { id: 'j5', title: 'Cadastral Survey â€” 10 Plots', category: 'Cadastral Survey', state: 'Ogun', lga: 'Sagamu', budget: 350000, urgency: 'medium', posted: '2026-02-13', desc: 'Cadastral survey for estate development. 10 plots in Sagamu. SURCON certified needed.', client: 'Folake A.', status: 'open' }
];

function initJobBoard() {
  let jobs = JSON.parse(localStorage.getItem('spe_jobs') || 'null');
  if (!jobs) {
    jobs = SAMPLE_JOBS;
    localStorage.setItem('spe_jobs', JSON.stringify(jobs));
  }
  renderJobBoard(jobs);
}

function renderJobBoard(jobs) {
  const cont = document.getElementById('jobBoardContent');
  if (!cont) return;
  if (!jobs.length) {
    cont.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text3);">No jobs posted yet. Be the first!</div>';
    return;
  }
  const urgencyMap = { low: 'urgency-low', medium: 'urgency-med', high: 'urgency-high', urgent: 'urgency-urg' };
  cont.innerHTML = jobs.filter(j => j.status === 'open').map(j => `
    <div class="job-card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:8px;margin-bottom:10px;">
        <div>
          <h3 style="font-weight:800;font-size:0.95rem;color:var(--accent2);">${j.title}</h3>
          <p style="font-size:0.78rem;color:var(--text2);">${j.state} Â· ${j.lga} Â· ${j.category}</p>
        </div>
        <div style="text-align:right;">
          <div style="font-family:var(--ff-display,'Syne','Arial Black',sans-serif);font-size:1.2rem;font-weight:800;color:var(--accent);">â‚¦${j.budget.toLocaleString()}</div>
          <span class="job-urgency ${urgencyMap[j.urgency]||'urgency-med'}">${j.urgency.toUpperCase()}</span>
        </div>
      </div>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">${j.desc}</p>
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
        <span style="font-size:0.75rem;color:var(--text3);">Posted by: ${j.client} Â· ${j.posted}</span>
        <button class="btn btn-green btn-sm" onclick="applyForJob('${j.id}','${j.title}',${j.budget})">âœ… Apply for this Job</button>
      </div>
    </div>
  `).join('');
}

function applyForJob(id, title, budget) {
  if (!AUTH.isLoggedIn()) {
    openAuthModal('login');
    toast('Sign in to apply for jobs', 'warning');
    return;
  }
  const commission = Math.round(budget * 0.1); // 10% platform fee
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ“‹ Apply: ${title}</h3>
    <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:14px;margin-bottom:16px;font-size:0.85rem;">
      <div><strong>Job Budget:</strong> â‚¦${budget.toLocaleString()}</div>
      <div><strong>Platform Fee (10%):</strong> â‚¦${commission.toLocaleString()} (deducted on completion)</div>
      <div style="margin-top:6px;font-size:0.78rem;color:var(--text2);">You receive â‚¦${(budget - commission).toLocaleString()} on successful completion</div>
    </div>
    <div class="form-group"><label>Your Proposed Rate (â‚¦)</label><input type="number" id="applyRate" value="${budget}" placeholder="${budget}"></div>
    <div class="form-group"><label>Cover Note</label><textarea id="applyNote" rows="3" placeholder="Describe your experience and why you're right for this job..."></textarea></div>
    <div class="form-group"><label>Estimated Completion Days</label><input type="number" id="applyDays" value="7" min="1" max="90"></div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="submitJobApplication('${id}','${title}',${budget})">ğŸ“¨ Submit Application</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function submitJobApplication(jobId, title, budget) {
  const rate = document.getElementById('applyRate')?.value;
  const note = document.getElementById('applyNote')?.value;
  const days = document.getElementById('applyDays')?.value;
  if (!rate || !note) { toast('Fill all fields', 'warning'); return; }
  
  const user = AUTH.user;
  const msg = `ğŸ“‹ *JOB APPLICATION â€” SurveyPro Elite*\n\nJob: *${title}*\nApplicant: ${user?.firstName} ${user?.lastName}\nLicense: ${user?.licenseNumber || 'N/A'}\nRate: â‚¦${parseFloat(rate).toLocaleString()}\nETA: ${days} days\n\nNote: ${note}\n\nğŸ“ ${user?.phone || ''} Â· ğŸ“§ ${user?.email || ''}`;
  
  closeModal();
  toast('Application submitted! The client will contact you.', 'success');
  showBanner(`âœ… Application sent for "${title}" â€” Budget: â‚¦${budget.toLocaleString()}`);
  setTimeout(() => window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank'), 1000);
}

function postJob() {
  if (!AUTH.isLoggedIn()) {
    openAuthModal('register');
    toast('Create account to post jobs', 'warning');
    return;
  }
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ“ Post a New Job</h3>
    <div class="form-group"><label>Job Title</label><input id="jTitle" placeholder="e.g. Boundary Survey â€” 3 Plots, Lagos"></div>
    <div class="form-group"><label>Category</label>
      <select id="jCat">${JOB_CATEGORIES.map(c => `<option>${c}</option>`).join('')}</select>
    </div>
    <div class="form-row">
      <div class="form-group"><label>State</label>
        <select id="jState">
          ${['Lagos','FCT - Abuja','Rivers','Kano','Ogun','Anambra','Delta','Enugu','Kaduna','Oyo','Edo','Imo','Plateau','Benue','Kwara','Niger','Kogi','Cross River','Akwa Ibom','Bayelsa','Ondo','Osun','Ekiti','Abia','Ebonyi','Imo','Nasarawa','Gombe','Taraba','Adamawa','Borno','Yobe','Bauchi','Gombe','Jigawa','Katsina','Kebbi','Sokoto','Zamfara','Zamfara','Zamfara'].map(s=>`<option>${s}</option>`).join('')}
        </select>
      </div>
      <div class="form-group"><label>LGA</label><input id="jLGA" placeholder="Local Government Area"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Budget (â‚¦)</label><input type="number" id="jBudget" placeholder="50000"></div>
      <div class="form-group"><label>Urgency</label>
        <select id="jUrgency"><option value="low">Low</option><option value="medium" selected>Medium</option><option value="high">High</option><option value="urgent">Urgent</option></select>
      </div>
    </div>
    <div class="form-group"><label>Description</label><textarea id="jDesc" rows="3" placeholder="Describe the survey requirements, land size, access, what documents are available..."></textarea></div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="submitPostJob()">âœ… Post Job</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function submitPostJob() {
  const title = document.getElementById('jTitle')?.value.trim();
  const budget = document.getElementById('jBudget')?.value;
  const desc = document.getElementById('jDesc')?.value.trim();
  if (!title || !budget || !desc) { toast('Fill all required fields', 'warning'); return; }
  
  const newJob = {
    id: 'j' + Date.now(),
    title, budget: parseInt(budget), desc,
    category: document.getElementById('jCat')?.value,
    state: document.getElementById('jState')?.value,
    lga: document.getElementById('jLGA')?.value,
    urgency: document.getElementById('jUrgency')?.value,
    client: `${AUTH.user?.firstName} ${AUTH.user?.lastName}`,
    posted: new Date().toISOString().split('T')[0],
    status: 'open'
  };
  
  const jobs = JSON.parse(localStorage.getItem('spe_jobs') || '[]');
  jobs.unshift(newJob);
  localStorage.setItem('spe_jobs', JSON.stringify(jobs));
  
  closeModal();
  toast('Job posted! Surveyors will see it immediately.', 'success');
  renderJobBoard(jobs);
  showBanner(`âœ… Job posted: "${title}" â€” â‚¦${parseInt(budget).toLocaleString()} budget`);
}

// â”€â”€ SURVEYOR DIRECTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SAMPLE_SURVEYORS = [
  { id: 's1', name: 'Emeka Okafor', state: 'Lagos', rating: 4.9, reviews: 47, license: 'SURCON/2019/0512', specs: ['Cadastral Survey','Boundary Survey','GIS Mapping'], plan: 'professional', jobs: 89, phone: '08023456789' },
  { id: 's2', name: 'Fatima Al-Hassan', state: 'FCT - Abuja', rating: 4.8, reviews: 32, license: 'SURCON/2021/1234', specs: ['Topographic Survey','Engineering Survey'], plan: 'professional', jobs: 54, phone: '08034567890' },
  { id: 's3', name: 'Chukwuemeka Eze', state: 'Anambra', rating: 4.7, reviews: 28, license: 'SURCON/2020/0891', specs: ['Cadastral Survey','Photogrammetric Survey'], plan: 'basic', jobs: 41, phone: '08045678901' },
  { id: 's4', name: 'Aisha Mahmoud', state: 'Kano', rating: 4.6, reviews: 19, license: 'SURCON/2022/2341', specs: ['GIS Mapping','Environmental Survey'], plan: 'professional', jobs: 33, phone: '08056789012' },
  { id: 's5', name: 'Biodun Adewale', state: 'Oyo', rating: 4.5, reviews: 15, license: 'SURCON/2023/0123', specs: ['Engineering Survey','Hydrographic Survey'], plan: 'basic', jobs: 22, phone: '08067890123' }
];

function initDirectory() {
  let surveyors = JSON.parse(localStorage.getItem('spe_directory') || 'null');
  if (!surveyors) {
    surveyors = SAMPLE_SURVEYORS;
    localStorage.setItem('spe_directory', JSON.stringify(surveyors));
  }
  renderDirectory(surveyors);
}

function renderDirectory(surveyors) {
  const cont = document.getElementById('directoryContent');
  if (!cont) return;
  cont.innerHTML = surveyors.map(s => `
    <div class="directory-card">
      <div style="display:flex;align-items:flex-start;gap:14px;margin-bottom:12px;">
        <div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#0f172a,#16a34a);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:1.1rem;flex-shrink:0;">${s.name.split(' ').map(n=>n[0]).join('')}</div>
        <div style="flex:1;">
          <div style="font-weight:800;font-size:0.95rem;">${s.name}</div>
          <div style="font-size:0.78rem;color:var(--text2);">${s.state} Â· ${s.jobs} jobs completed</div>
          <div class="surveyor-rating">â­ ${s.rating} <span style="color:var(--text3);">(${s.reviews} reviews)</span></div>
        </div>
        <span class="verification-badge">âœ… SURCON</span>
      </div>
      <div style="margin-bottom:10px;">${s.specs.map(sp=>`<span class="specialization-tag">${sp}</span>`).join('')}</div>
      <div style="font-size:0.75rem;color:var(--text3);margin-bottom:12px;">License: <span class="mono">${s.license}</span></div>
      <div class="btn-grid">
        <button class="btn btn-green btn-sm" onclick="contactSurveyor('${s.name}','${s.phone}')">ğŸ“± Contact</button>
        <button class="btn btn-blue btn-sm" onclick="hireSurveyor('${s.name}')">ğŸ’¼ Hire</button>
      </div>
    </div>
  `).join('');
}

function filterDirectory() {
  const state = document.getElementById('dirStateFilter')?.value;
  const spec = document.getElementById('dirSpecFilter')?.value;
  let surveyors = JSON.parse(localStorage.getItem('spe_directory') || JSON.stringify(SAMPLE_SURVEYORS));
  if (state) surveyors = surveyors.filter(s => s.state === state);
  if (spec) surveyors = surveyors.filter(s => s.specs.includes(spec));
  renderDirectory(surveyors);
}

function contactSurveyor(name, phone) {
  const msg = `Hello ${name}! I found your profile on SurveyPro Elite. I need surveying services and would like to discuss further.`;
  window.open(`https://wa.me/234${phone.replace(/^0/,'')}?text=${encodeURIComponent(msg)}`, '_blank');
}

function hireSurveyor(name) {
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:12px;">ğŸ’¼ Hire ${name}</h3>
    <div class="form-group"><label>Your Name</label><input id="hName" placeholder="Your full name"></div>
    <div class="form-group"><label>Your Phone</label><input id="hPhone" placeholder="080XXXXXXXX" type="tel"></div>
    <div class="form-group"><label>Service Needed</label>
      <select id="hService">${JOB_CATEGORIES.map(c=>`<option>${c}</option>`).join('')}</select>
    </div>
    <div class="form-group"><label>Location/State</label><input id="hLocation" placeholder="e.g. Lagos Island, Lagos"></div>
    <div class="form-group"><label>Budget (â‚¦)</label><input id="hBudget" type="number" placeholder="50000"></div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="confirmHire('${name}')">ğŸ“¨ Send Request</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function confirmHire(surveyorName) {
  const n = document.getElementById('hName')?.value.trim();
  const p = document.getElementById('hPhone')?.value.trim();
  const s = document.getElementById('hService')?.value;
  const l = document.getElementById('hLocation')?.value.trim();
  const b = document.getElementById('hBudget')?.value;
  if (!n || !p || !l) { toast('Fill all fields', 'warning'); return; }
  const msg = `ğŸ‘‹ *HIRE REQUEST via SurveyPro Elite*\n\nSurveyor: ${surveyorName}\nService: ${s}\nLocation: ${l}\nBudget: â‚¦${parseInt(b||0).toLocaleString()}\nClient: ${n}\nPhone: ${p}\n\nPlease get back to me ASAP!`;
  closeModal();
  toast('Hire request sent!', 'success');
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
}

// â”€â”€ ONLINE/OFFLINE DETECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('online',  () => { if(document.getElementById('offlineBar')) document.getElementById('offlineBar').style.display='none'; toast('Back online!','success'); });
window.addEventListener('offline', () => { if(document.getElementById('offlineBar')) document.getElementById('offlineBar').style.display='block'; toast('Offline â€” tools still work!','warning'); });

// â”€â”€ KEYBOARD SHORTCUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  if ((e.ctrlKey||e.metaKey) && !e.shiftKey) {
    switch(e.key) {
      case '1': e.preventDefault(); showTab('home'); break;
      case '2': e.preventDefault(); showTab('survey'); break;
      case '3': e.preventDefault(); showTab('coords'); break;
      case '4': e.preventDefault(); showTab('history'); break;
      case '5': e.preventDefault(); showTab('jobs'); break;
      case 's': e.preventDefault(); completeSurvey(); break;
    }
  }
  if (e.key === 'Escape') { closeModal(); closeAuthModal(); closePaymentModal(); }
});

// â”€â”€ USAGE ANALYTICS (local only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  try {
    const s = JSON.parse(localStorage.getItem('spe_analytics') || '{"visits":0,"tabViews":{}}');
    s.visits++;
    s.lastVisit = new Date().toISOString();
    localStorage.setItem('spe_analytics', JSON.stringify(s));
  } catch(e) {}
})();

// â”€â”€ PRINT STYLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _ps = document.createElement('style');
_ps.textContent = '@media print { header,.nav-wrap,footer,.btn,#installBar,#offlineBar,#topBanner,#authModal,#paymentModal { display:none!important; } .tab-content { display:block!important; } }';
document.head.appendChild(_ps);

// â”€â”€ INLINE SERVICE WORKER (No separate sw.js needed) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    const swCode = `
      const CACHE = 'surveypro-v4';
      const CORE = ['/'];
      self.addEventListener('install', e => {
        e.waitUntil(caches.open(CACHE).then(c => c.addAll(CORE)).then(() => self.skipWaiting()));
      });
      self.addEventListener('activate', e => {
        e.waitUntil(caches.keys().then(k => Promise.all(k.filter(n => n !== CACHE).map(n => caches.delete(n)))).then(() => self.clients.claim()));
      });
      self.addEventListener('fetch', e => {
        if (e.request.method !== 'GET') return;
        e.respondWith(caches.match(e.request).then(r => r || fetch(e.request).then(res => {
          if (res && res.status === 200) {
            const clone = res.clone();
            caches.open(CACHE).then(c => c.put(e.request, clone));
          }
          return res;
        }).catch(() => caches.match('/'))));
      });
    `;
    try {
      const blob = new Blob([swCode], { type: 'application/javascript' });
      navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(() => {});
    } catch(e) {}
  });
}

// â”€â”€ INLINE PWA MANIFEST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  try {
    const manifest = {
      name: 'SurveyPro Elite', short_name: 'SurveyPro',
      description: "Nigeria's #1 Professional Land Surveying Platform",
      start_url: '.', display: 'standalone',
      background_color: '#0f172a', theme_color: '#0f172a',
      orientation: 'any',
      icons: [
        { src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230f172a'/><text y='.9em' font-size='80'>ğŸ¯</text></svg>", sizes: '192x192', type: 'image/svg+xml' },
        { src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230f172a'/><text y='.9em' font-size='80'>ğŸ¯</text></svg>", sizes: '512x512', type: 'image/svg+xml' }
      ],
      shortcuts: [
        { name: 'Survey', url: './?tab=survey', icons: [{ src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>ğŸ“¡</text></svg>", sizes: '96x96' }] },
        { name: 'Coordinates', url: './?tab=coords', icons: [{ src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>ğŸŒ</text></svg>", sizes: '96x96' }] }
      ]
    };
    const url = URL.createObjectURL(new Blob([JSON.stringify(manifest)], { type: 'application/json' }));
    const link = document.createElement('link');
    link.rel= 'manifest';
    link.href = url;
    document.head.appendChild(link);
  } catch(e) {}
})();

// â”€â”€ URL HASH ROUTING ON LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  const urlP = new URLSearchParams(window.location.search);
  const tab = urlP.get('tab');
  if (tab) showTab(tab);
});

// â”€â”€ ADVANCED TOOLS TAB FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToolPane(pane) {
  document.querySelectorAll('.coord-pane[id^="tp-"]').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.sub-tab[id^="tt-"]').forEach(el => el.classList.remove('active'));
  const tp = document.getElementById('tp-' + pane);
  if (tp) tp.classList.add('active');
  const tt = document.getElementById('tt-' + pane);
  if (tt) tt.classList.add('active');
}

function calcSlope() {
  const e1=parseFloat(document.getElementById('slope-e1')?.value),e2=parseFloat(document.getElementById('slope-e2')?.value),d=parseFloat(document.getElementById('slope-dist')?.value);
  if([e1,e2,d].some(isNaN)||d<=0){toast('Enter all slope values','warning');return;}
  const dElev=e2-e1,slopePct=(dElev/d)*100,slopeDeg=Math.atan(dElev/d)*180/Math.PI;
  showResult('slope-result',[['Height Difference',`${dElev>=0?'+':''}${dElev.toFixed(3)} m`],['Slope (%)',`${slopePct.toFixed(3)} %`],['Slope Angle',`${slopeDeg.toFixed(4)}Â°`],['Slope Ratio',Math.abs(dElev)>0?`1:${Math.abs(d/dElev).toFixed(1)}`:'0 (flat)'],['Slope Distance',`${Math.sqrt(d*d+dElev*dElev).toFixed(3)} m`]]);
  toast('Slope calculated!','success');
}

function generateStakeout() {
  const stN=parseFloat(document.getElementById('so-sn')?.value),stE=parseFloat(document.getElementById('so-se')?.value),tN=parseFloat(document.getElementById('so-tn')?.value),tE=parseFloat(document.getElementById('so-te')?.value);
  if([stN,stE,tN,tE].some(isNaN)){toast('Enter station and target coordinates','warning');return;}
  const dN=tN-stN,dE=tE-stE,dist=Math.sqrt(dN*dN+dE*dE),bear=((Math.atan2(dE,dN)*180/Math.PI)+360)%360;
  showResult('so-result',[['Target Northing',tN.toFixed(3)+' m'],['Target Easting',tE.toFixed(3)+' m'],['Distance to Target',dist.toFixed(3)+' m'],['Bearing to Target',bear.toFixed(4)+'Â°'],['Î”N',`${dN>=0?'+':''}${dN.toFixed(3)} m`],['Î”E',`${dE>=0?'+':''}${dE.toFixed(3)} m`]]);
  toast('Stakeout data ready!','success');
}

function calcHorizCurve() {
  const R=parseFloat(document.getElementById('hc-r')?.value),delta=parseFloat(document.getElementById('hc-delta')?.value),pcCh=parseFloat(document.getElementById('hc-pc')?.value)||0;
  if(isNaN(R)||isNaN(delta)){toast('Enter radius and deflection angle','warning');return;}
  const d2=delta*Math.PI/180,T=R*Math.tan(d2/2),L=R*d2,E=R*(1/Math.cos(d2/2)-1),M=R*(1-Math.cos(d2/2)),LC=2*R*Math.sin(d2/2);
  showResult('hc-result',[['Tangent Length (T)',T.toFixed(3)+' m'],['Arc Length (L)',L.toFixed(3)+' m'],['Chord Length (LC)',LC.toFixed(3)+' m'],['External Distance (E)',E.toFixed(3)+' m'],['Middle Ordinate (M)',M.toFixed(3)+' m'],['Chainage of PT',(pcCh+L).toFixed(3)+' m'],['Degree of Curve',`${(5729.58/R).toFixed(4)}Â°/chain`]]);
  toast('Curve elements calculated!','success');
}

function calcVolume() {
  const a1=parseFloat(document.getElementById('vol-a1')?.value),am=parseFloat(document.getElementById('vol-am')?.value),a2=parseFloat(document.getElementById('vol-a2')?.value),l=parseFloat(document.getElementById('vol-l')?.value);
  if([a1,am,a2,l].some(isNaN)){toast('Enter all volume fields','warning');return;}
  const vp=(l/6)*(a1+4*am+a2),va=(l/2)*(a1+a2);
  showResult('vol-result',[['Volume (Prismoidal)',vp.toFixed(3)+' mÂ³'],['Volume (Avg End Area)',va.toFixed(3)+' mÂ³'],['Prismoidal Correction',(va-vp).toFixed(3)+' mÂ³'],['Section 1 Area',a1.toFixed(3)+' mÂ²'],['Midpoint Area',am.toFixed(3)+' mÂ²'],['Section 2 Area',a2.toFixed(3)+' mÂ²'],['Length',l.toFixed(3)+' m']]);
  toast('Volume calculated!','success');
}

function calcTrigLevel() {
  const hi=parseFloat(document.getElementById('tl-hi')?.value),th=parseFloat(document.getElementById('tl-th')?.value),sd=parseFloat(document.getElementById('tl-sd')?.value),va=parseFloat(document.getElementById('tl-va')?.value),stElev=parseFloat(document.getElementById('tl-elev')?.value)||0;
  if([hi,th,sd,va].some(isNaN)){toast('Enter all trig level values','warning');return;}
  const vaR=va*Math.PI/180,hd=sd*Math.cos(vaR),vd=sd*Math.sin(vaR),targetElev=stElev+hi+vd-th;
  showResult('tl-result',[['Horizontal Distance',hd.toFixed(3)+' m'],['Vertical Difference (V)',vd.toFixed(3)+' m'],['Target Elevation',targetElev.toFixed(3)+' m'],['Elevation Difference',(targetElev-stElev).toFixed(3)+' m']]);
  toast('Elevation calculated!','success');
}

function calcMapScale() {
  const scale=parseFloat(document.getElementById('ms-scale')?.value),mapDist=parseFloat(document.getElementById('ms-map')?.value);
  if(isNaN(scale)||isNaN(mapDist)){toast('Enter scale and map distance','warning');return;}
  const groundM=(mapDist/1000)*scale;
  showResult('ms-result',[['Scale','1:'+scale.toLocaleString()],['Map Distance',mapDist.toFixed(2)+' mm'],['Ground Distance (m)',groundM.toFixed(3)+' m'],['Ground Distance (km)',(groundM/1000).toFixed(4)+' km'],['Ground Distance (ft)',(groundM*3.28084).toFixed(2)+' ft'],['Reverse (1m on ground)',(1000/scale).toFixed(4)+' mm on map']]);
  toast('Scale converted!','success');
}

// â”€â”€ NIGHT MODE PERSIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', () => {
  try {
    if(localStorage.getItem('sp_dark')==='1'){
      darkMode=true;
      document.body.classList.add('dark');
      const btn=document.getElementById('darkBtn');
      if(btn) btn.textContent='â˜€ï¸ Light';
    }
  } catch(e) {}
});

</script>
</body>
</html>
